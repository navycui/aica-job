{"ast":null,"code":"import { fetchRefreshToken } from '~/fetches';\nimport authentication from 'shared/authentication';\nimport axios from 'shared/libs/axios';\nimport dayjs from 'shared/libs/dayjs';\nexport default (async req => {\n  // 토큰이 있다면..\n  const certificate = authentication.get();\n  const left = dayjs(certificate.accessTokenExpiresAt).diff(+new Date(), 's');\n\n  if ( //* 토큰이 유효하고,\n  certificate.accessToken && //* 남은 시간이 1초 이상이고,\n  left > 0 && //* 업데이트 한지 2초 이상이면,\n  dayjs().diff(certificate.updateAt, 's') > 1) {\n    //* 토큰 갱신\n    try {\n      const res = await fetchRefreshToken();\n      authentication.set(res.data);\n    } catch (e) {}\n  }\n\n  return req.responseType === 'blob' ? axios(req) : axios(req).then(res => res.data);\n});","map":{"version":3,"names":["fetchRefreshToken","authentication","axios","dayjs","req","certificate","get","left","accessTokenExpiresAt","diff","Date","accessToken","updateAt","res","set","data","e","responseType","then"],"sources":["/Users/choi/react-workspace/front-admin-cmm-def/packages/usp/src/api/index.ts"],"sourcesContent":["import { fetchRefreshToken } from '~/fetches';\nimport authentication from 'shared/authentication';\nimport axios from 'shared/libs/axios';\nimport dayjs from 'shared/libs/dayjs';\n\nexport default async (req: any) => {\n  // 토큰이 있다면..\n  const certificate = authentication.get();\n  const left = dayjs(certificate.accessTokenExpiresAt).diff(+new Date(), 's');\n\n  if (\n    //* 토큰이 유효하고,\n    certificate.accessToken &&\n    //* 남은 시간이 1초 이상이고,\n    left > 0 &&\n    //* 업데이트 한지 2초 이상이면,\n    dayjs().diff(certificate.updateAt, 's') > 1\n  ) {\n    //* 토큰 갱신\n    try {\n      const res = await fetchRefreshToken();\n      authentication.set(res.data);\n    } catch (e) {}\n  }\n\n  return req.responseType === 'blob'\n    ? axios(req)\n    : axios(req).then((res) => res.data);\n};\n"],"mappings":"AAAA,SAASA,iBAAT,QAAkC,WAAlC;AACA,OAAOC,cAAP,MAA2B,uBAA3B;AACA,OAAOC,KAAP,MAAkB,mBAAlB;AACA,OAAOC,KAAP,MAAkB,mBAAlB;AAEA,gBAAe,MAAOC,GAAP,IAAoB;EACjC;EACA,MAAMC,WAAW,GAAGJ,cAAc,CAACK,GAAf,EAApB;EACA,MAAMC,IAAI,GAAGJ,KAAK,CAACE,WAAW,CAACG,oBAAb,CAAL,CAAwCC,IAAxC,CAA6C,CAAC,IAAIC,IAAJ,EAA9C,EAA0D,GAA1D,CAAb;;EAEA,KACE;EACAL,WAAW,CAACM,WAAZ,IACA;EACAJ,IAAI,GAAG,CAFP,IAGA;EACAJ,KAAK,GAAGM,IAAR,CAAaJ,WAAW,CAACO,QAAzB,EAAmC,GAAnC,IAA0C,CAN5C,EAOE;IACA;IACA,IAAI;MACF,MAAMC,GAAG,GAAG,MAAMb,iBAAiB,EAAnC;MACAC,cAAc,CAACa,GAAf,CAAmBD,GAAG,CAACE,IAAvB;IACD,CAHD,CAGE,OAAOC,CAAP,EAAU,CAAE;EACf;;EAED,OAAOZ,GAAG,CAACa,YAAJ,KAAqB,MAArB,GACHf,KAAK,CAACE,GAAD,CADF,GAEHF,KAAK,CAACE,GAAD,CAAL,CAAWc,IAAX,CAAiBL,GAAD,IAASA,GAAG,CAACE,IAA7B,CAFJ;AAGD,CAvBD"},"metadata":{},"sourceType":"module"}