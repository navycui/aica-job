{"ast":null,"code":"var _jsxFileName = \"/Users/choi/react-workspace/front-admin-cmm-def/packages/shared/src/DynamicRouter.tsx\",\n    _s = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nimport * as R from 'ramda';\nimport React, { useEffect, useState } from 'react';\nimport { useRoutes } from 'react-router-dom';\nimport NotFound from 'shared/NotFound';\nimport { Loader, middleware } from \"./utils/RouteUtiles\";\nimport { useRouteStore } from \"./Store/RouteConfig\";\nimport { useQueryClient } from \"react-query\";\nimport { GetQuery } from \"./libs/axios\";\nimport { jsx as ___EmotionJSX } from \"@emotion/react\";\nexport function DynamicRouter(_ref) {\n  _s();\n\n  let {\n    addRoutes,\n    portalType\n  } = _ref;\n  const url = `/member/api/auth/menus/${portalType}/me`; // const memberUrl = portalType == \"PORTAL_TAM\"?  \"http://3.38.179.210:8082\" :\n  //   `${process.env.REACT_APP_DOMAIN_MEMBER_BNET}`\n\n  const memberUrl = `${process.env.REACT_APP_DOMAIN_MEMBER_BNET}`;\n  const client = useQueryClient();\n  const portal = GetQuery(url, undefined, {\n    baseURL: memberUrl\n  }, {\n    cacheTime: Infinity\n  });\n  const [isLoading, setIsLoading] = useState(true);\n  const routeStore = useRouteStore();\n  useEffect(() => {\n    if (!portal.isLoading && !portal.isFetching) {\n      if (!!portal.data) {\n        const record = R.pipe(JSON.stringify, JSON.parse)(portal.data.list);\n        const routes = hierarchy(portal.data.list);\n        routeStore.setRecord(record);\n        routeStore.setRoutes(routes);\n        if (isLoading) setIsLoading(false);\n      }\n    }\n  }, [portal.data, portal.isLoading, portal.isFetching]);\n  if (isLoading) return ___EmotionJSX(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 27\n    }\n  });\n  return ___EmotionJSX(Routes, {\n    addRoutes: addRoutes,\n    routes: routeStore.routes,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 10\n    }\n  });\n}\n\n_s(DynamicRouter, \"Fh8m5TCMZY+4NUjMEeHk6qWU1wo=\", false, function () {\n  return [useQueryClient, useRouteStore];\n});\n\n_c = DynamicRouter;\n\nconst flatten = routes => {\n  const res = routes.reduce((a, b) => {\n    const {\n      children = []\n    } = b;\n    const c = R.omit(['children'])(b);\n    const d = flatten(children);\n    return [...a, c, ...d];\n  }, []);\n  return res;\n};\n\nconst adaptor = routes => {\n  var _s2 = $RefreshSig$();\n\n  return _s2(routes.map(_s2(route => {\n    _s2();\n\n    const {\n      label,\n      path\n    } = route;\n    const config = useRouteStore();\n    const tspPath = \"/tsp-admin\" + path;\n    return {\n      label,\n      path: `${tspPath}`,\n      element: ___EmotionJSX(Loader, {\n        route: middleware({\n          layout: config.defaultLayout,\n          //* path 컴포넌트\n          element: /*#__PURE__*/React.lazy(() => import(`~/pages${path}`))\n        }, []),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 9\n        }\n      })\n    };\n  }, \"Z5FtaWUXE5Fn5kNBJL0tSJTJusA=\", false, function () {\n    return [useRouteStore];\n  })), \"Z5FtaWUXE5Fn5kNBJL0tSJTJusA=\", false, function () {\n    return [useRouteStore];\n  });\n};\n\nfunction Routes(_ref2) {\n  _s3();\n\n  let {\n    routes,\n    addRoutes\n  } = _ref2;\n  const menus = R.pipe(flatten, adaptor)(routes);\n  const nav = useRoutes([...addRoutes, ...menus, {\n    path: '*',\n    element: ___EmotionJSX(NotFound, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 16\n      }\n    })\n  }]);\n  return nav;\n} //* 1차원 배열을 계층 구조로 변환\n\n\n_s3(Routes, \"lCp9jEmGiKVw3WcriGpzocP4y8I=\", false, function () {\n  return [useRoutes];\n});\n\n_c2 = Routes;\n\nfunction hierarchy(list) {\n  //* 객체 복사\n  const record = R.pipe(JSON.stringify, JSON.parse)(list); // mutate('route://record', record);\n\n  let map = record.reduce((a, b, i) => ({ ...a,\n    [b.menuId]: i\n  }), {});\n  let root = {\n    children: []\n  }; //* 계층 생성\n\n  record.forEach(item => {\n    item.path = `${item.url}`.replace(/\\/\\//g, '/');\n    item.label = item.menuNm;\n\n    if (item.parentMenuId === \"ROOT\") {\n      root.children.push(item);\n    } else if (!R.isNil(item.parentMenuId)) {\n      // @ts-ignore\n      const el = record[map[item.parentMenuId]];\n      if (R.isNil(el.children)) el.children = [];\n      el.children.push(item);\n    }\n  });\n  return root.children;\n}\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"DynamicRouter\");\n$RefreshReg$(_c2, \"Routes\");","map":{"version":3,"names":["R","React","useEffect","useState","useRoutes","NotFound","Loader","middleware","useRouteStore","useQueryClient","GetQuery","DynamicRouter","addRoutes","portalType","url","memberUrl","process","env","REACT_APP_DOMAIN_MEMBER_BNET","client","portal","undefined","baseURL","cacheTime","Infinity","isLoading","setIsLoading","routeStore","isFetching","data","record","pipe","JSON","stringify","parse","list","routes","hierarchy","setRecord","setRoutes","flatten","res","reduce","a","b","children","c","omit","d","adaptor","map","route","label","path","config","tspPath","element","layout","defaultLayout","lazy","Routes","menus","nav","i","menuId","root","forEach","item","replace","menuNm","parentMenuId","push","isNil","el"],"sources":["/Users/choi/react-workspace/front-admin-cmm-def/packages/shared/src/DynamicRouter.tsx"],"sourcesContent":["import * as R from 'ramda';\nimport React, {Suspense, useEffect, useState} from 'react';\nimport {useRoutes, useLocation} from 'react-router-dom';\nimport NotFound from 'shared/NotFound';\nimport useSWR, {mutate} from 'swr';\nimport api from \"./api\";\nimport {Loader, middleware, RouteData, RouteType} from \"./utils/RouteUtiles\";\nimport {useRouteStore} from \"./Store/RouteConfig\";\nimport {useQuery, useQueryClient} from \"react-query\";\nimport axios, {AxiosGet, GetQuery, TokenUpdate} from \"./libs/axios\";\nimport authentication from \"./authentication\";\nimport dayjs from \"./libs/dayjs\";\nimport fetchRefreshToken from \"./fetches\";\n\ntype PortalType = \"PORTAL_UAM\" | \"PORTAL_TSP\" | \"PORTAL_TAM\";\n\ninterface IDynamicRouter {\n  addRoutes?: RouteType[],\n  portalType: PortalType,\n}\n\ninterface Root {\n  children: RouteData[]\n}\n\nexport function DynamicRouter({addRoutes, portalType}: IDynamicRouter) {\n  const url = `/member/api/auth/menus/${portalType}/me`\n  // const memberUrl = portalType == \"PORTAL_TAM\"?  \"http://3.38.179.210:8082\" :\n  //   `${process.env.REACT_APP_DOMAIN_MEMBER_BNET}`\n  const memberUrl = `${process.env.REACT_APP_DOMAIN_MEMBER_BNET}`\n  const client = useQueryClient()\n  const portal = GetQuery(url, undefined, {\n    baseURL: memberUrl\n  },{\n    cacheTime: Infinity\n  })\n  const [isLoading, setIsLoading] = useState(true)\n  const routeStore = useRouteStore()\n\n  useEffect(() => {\n    if (!portal.isLoading && !portal.isFetching){\n      if (!!portal.data){\n        const record: RouteData[] = R.pipe(JSON.stringify, JSON.parse)(portal.data.list);\n        const routes = hierarchy(portal.data.list);\n        routeStore.setRecord(record)\n        routeStore.setRoutes(routes)\n        if (isLoading) setIsLoading(false)\n      }\n    }\n  }, [portal.data, portal.isLoading, portal.isFetching])\n\n\n\n  if (isLoading ) return  <div/>\n  return <Routes addRoutes={addRoutes} routes={routeStore.routes}/>;\n}\n\nconst flatten = (routes: any) => {\n  const res = routes.reduce((a: any, b: any) => {\n    const {children = []} = b;\n    const c = R.omit(['children'])(b);\n\n    const d = flatten(children);\n\n    return [...a, c, ...d];\n  }, []);\n  return res;\n};\n\nconst adaptor = (routes: any) => {\n  return routes.map((route: any) => {\n    const {label, path} = route;\n    const config = useRouteStore();\n    const tspPath = \"/tsp-admin\"+path;\n\n    return {\n      label,\n      path: `${tspPath}`,\n      element: (\n        <Loader\n          route={middleware({\n            layout: config.defaultLayout,\n\n            //* path 컴포넌트\n            element: React.lazy(() => import(`~/pages${path}`)),\n          }, [])}\n        />\n      ),\n    };\n  });\n};\n\n\nfunction Routes({routes, addRoutes}: any) {\n  const menus = R.pipe(flatten, adaptor)(routes);\n\n  const nav = useRoutes([\n    ...addRoutes,\n    ...menus,\n    {\n      path: '*',\n      element: <NotFound/>,\n    },\n  ]);\n\n  return nav;\n}\n\n//* 1차원 배열을 계층 구조로 변환\nfunction hierarchy(list: any) {\n  //* 객체 복사\n  const record: RouteData[] = R.pipe(JSON.stringify, JSON.parse)(list);\n\n  // mutate('route://record', record);\n  let map = record.reduce((a, b, i) => ({...a, [b.menuId]: i}), {});\n  let root: Root = { children: []};\n\n  //* 계층 생성\n  record.forEach((item) => {\n    item.path = `${item.url}`.replace(/\\/\\//g, '/');\n    item.label = item.menuNm;\n    if (item.parentMenuId === \"ROOT\") {\n      root.children.push(item)\n    } else if (!R.isNil(item.parentMenuId)){\n      // @ts-ignore\n      const el = record[map[item.parentMenuId]];\n\n      if (R.isNil(el.children)) el.children = [];\n\n      el.children.push(item);\n    }\n  });\n\n  return root.children;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}