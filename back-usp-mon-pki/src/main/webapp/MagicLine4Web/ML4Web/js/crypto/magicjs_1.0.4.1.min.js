/*! MagicJS-v1.0.4.1-2017.08.24-(c) 2014~2017, Dreamsecurity co.,ltd. All rights reserved. Some or all of MagicJS module, reproduced without the consent of DreamSecurity, modify, decompile, conversion into other languages is forbidden to use and distribute . MagicJS module is developed based on 'The forge software' of Digital Bazaar.*/!function(){var a="dreamsecurity";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return void("undefined"==typeof dreamsecurity&&(dreamsecurity={disableNativeCode:!0}));var b=!0;define=function(a,b){b(require,module)}}var c,d=function(b,d){d.exports=function(d){var e=c.map(function(a){return b(a)});if(d=d||{},d.defined=d.defined||{},d.defined[a])return d[a];d.defined[a]=!0;for(var f=0;f<e.length;++f)e[f](d);return d},d.exports.disableNativeCode=!1,d.exports(d.exports)},e=define;define=function(a,d){return c="string"==typeof a?d.slice(2):a.slice(2),b?(delete define,e.apply(null,Array.prototype.slice.call(arguments,0))):(define=e,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./aesCipherSuites","./asn1","./cipher","./cipherModes","./debug","./des","./hmac","./kem","./log","./md","./mgf1","./pbkdf2","./pem","./pkcs7","./pkcs1","./pkcs12","./pki","./prime","./prng","./pss","./random","./rc2","./ssh","./task","./tls","./util"],function(){d.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(a){function b(a,b,c,e,f,g){for(var h,i,j,k,l,m,n,o,p,q,r,s,t;f>=64;){for(h=b[0],i=b[1],j=b[2],k=b[3],l=b[4],m=b[5],n=b[6],o=b[7],q=0;16>q;q++)r=e+4*q,g?a[q]=(255&c.charCodeAt(r))<<24|(255&c.charCodeAt(r+1))<<16|(255&c.charCodeAt(r+2))<<8|255&c.charCodeAt(r+3):a[q]=(255&c[r])<<24|(255&c[r+1])<<16|(255&c[r+2])<<8|255&c[r+3];for(q=16;64>q;q++)p=a[q-2],s=(p>>>17|p<<15)^(p>>>19|p<<13)^p>>>10,p=a[q-15],t=(p>>>7|p<<25)^(p>>>18|p<<14)^p>>>3,a[q]=(s+a[q-7]|0)+(t+a[q-16]|0);for(q=0;64>q;q++)s=(((l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7))+(l&m^~l&n)|0)+(o+(d[q]+a[q]|0)|0)|0,t=((h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10))+(h&i^h&j^i&j)|0,o=n,n=m,m=l,l=k+s|0,k=j,j=i,i=h,h=s+t|0;b[0]+=h,b[1]+=i,b[2]+=j,b[3]+=k,b[4]+=l,b[5]+=m,b[6]+=n,b[7]+=o,e+=64,f-=64}return e}var c=a.intg=a.intg||{};c.digestLength=32,c.blockSize=64;var d=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],e=function(){function a(){this.digestLength=c.digestLength,this.blockSize=c.blockSize,this.state=new Array(8),this.temp=new Array(64),this.buffer=new Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return a.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},a.prototype.clean=function(){for(var a=0;a<this.buffer.length;a++)this.buffer[a]=0;for(var a=0;a<this.temp.length;a++)this.temp[a]=0;this.reset()},a.prototype.update=function(a,c){if(void 0===c&&(c=a.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var d=0;if(this.bytesHashed+=c,this.bufferLength>0){for(;this.bufferLength<64&&c>0;)this.buffer[this.bufferLength++]=a.charCodeAt(d++),c--;64===this.bufferLength&&(b(this.temp,this.state,this.buffer,0,64,!1),this.bufferLength=0)}for(c>=64&&(d=b(this.temp,this.state,a,d,c,!0),c%=64);c>0;)this.buffer[this.bufferLength++]=a.charCodeAt(d++),c--;return this},a.prototype.finish=function(a){if(!this.finished){var c=this.bytesHashed,d=this.bufferLength,e=c/536870912|0,f=c<<3,g=56>c%64?64:128;this.buffer[d]=128;for(var h=d+1;g-8>h;h++)this.buffer[h]=0;this.buffer[g-8]=e>>>24&255,this.buffer[g-7]=e>>>16&255,this.buffer[g-6]=e>>>8&255,this.buffer[g-5]=e>>>0&255,this.buffer[g-4]=f>>>24&255,this.buffer[g-3]=f>>>16&255,this.buffer[g-2]=f>>>8&255,this.buffer[g-1]=f>>>0&255,b(this.temp,this.state,this.buffer,0,g,!1),this.finished=!0}for(var h=0;8>h;h++)a[4*h+0]=this.state[h]>>>24&255,a[4*h+1]=this.state[h]>>>16&255,a[4*h+2]=this.state[h]>>>8&255,a[4*h+3]=this.state[h]>>>0&255;return this},a.prototype.digest=function(){var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return this.finish(a),String.fromCharCode.apply(null,a)},a.prototype._saveState=function(a){for(var b=0;b<this.state.length;b++)a[b]=this.state[b]},a.prototype._restoreState=function(a,b){for(var c=0;c<this.state.length;c++)this.state[c]=a[c];this.bytesHashed=b,this.finished=!1,this.bufferLength=0},a}();c.create=function(a){var b=(new e).update(a),c=b.digest();return b.clean(),c}}var b="intg";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){if(void 0==b)return void("function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"asn1"));var c=b.asn1=b.asn1||{};c.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},c.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},c.create=function(a,c,d,e){if(b.util.isArray(e)){for(var f=[],g=0;g<e.length;++g)void 0!==e[g]&&f.push(e[g]);e=f}return{tagClass:a,type:c,constructed:d,composed:d||b.util.isArray(e),value:e}};var d=function(a){var b=a.getByte();if(128!==b){var c,d=128&b;return c=d?a.getInt((127&b)<<3):b}};c.fromDer=function(e,f){if(arguments.length<3&&a(),void 0===f&&(f=!0),"string"==typeof e&&(e=b.util.createBuffer(e)),e.length()<2){var g=new Error("Too few bytes to parse DER.");throw g.bytes=e.length(),g}var h=e.getByte(),i=192&h,j=31&h,k=d(e);if(e.length()<k){if(f){var g=new Error("Too few bytes to read ASN.1 value.");throw g.detail=e.length()+" < "+k,g}k=e.length()}var l,m=32===(32&h),n=m;if(!n&&i===c.Class.UNIVERSAL&&j===c.Type.BITSTRING&&k>1){var o=e.read,p=e.getByte();if(0===p){h=e.getByte();var q=192&h;if(q===c.Class.UNIVERSAL||q===c.Class.CONTEXT_SPECIFIC)try{var r=d(e);n=r===k-(e.read-o),n&&(++o,--k)}catch(s){throw new Error("Error in asn1.fromDer()")}}e.read=o}if(n)if(l=[],void 0===k)for(;;){if(e.bytes(2)===String.fromCharCode(0,0)){e.getBytes(2);break}l.push(c.fromDer(e,f,!0))}else for(var t=e.length();k>0;)l.push(c.fromDer(e,f,!0)),k-=t-e.length(),t=e.length();else{if(void 0===k){if(f)throw new Error("Non-constructed ASN.1 object of indefinite length.");k=e.length()}if(j===c.Type.BMPSTRING){l="";for(var u=0;k>u;u+=2)l+=String.fromCharCode(e.getInt16())}else l=e.getBytes(k)}return c.create(i,j,m,l)},c.toDer=function(d){1==arguments.length&&a();var e=b.util.createBuffer(),f=d.tagClass|d.type,g=b.util.createBuffer();if(d.composed){d.constructed?f|=32:g.putByte(0);for(var h=0;h<d.value.length;++h)void 0!==d.value[h]&&g.putBuffer(c.toDer(d.value[h],!0))}else if(d.type===c.Type.BMPSTRING)for(var h=0;h<d.value.length;++h)g.putInt16(d.value.charCodeAt(h));else g.putBytes(d.value);if(e.putByte(f),g.length()<=127)e.putByte(127&g.length());else{var i=g.length(),j="";do j+=String.fromCharCode(255&i),i>>>=8;while(i>0);e.putByte(128|j.length);for(var h=j.length-1;h>=0;--h)e.putByte(j.charCodeAt(h))}return e.putBuffer(g),e},c.oidToDer=function(a){var c=a.split("."),d=b.util.createBuffer();d.putByte(40*parseInt(c[0],10)+parseInt(c[1],10));for(var e,f,g,h,i=2;i<c.length;++i){e=!0,f=[],g=parseInt(c[i],10);do h=127&g,g>>>=7,e||(h|=128),f.push(h),e=!1;while(g>0);for(var j=f.length-1;j>=0;--j)d.putByte(f[j])}return d},c.derToOid=function(a){var c;"string"==typeof a&&(a=b.util.createBuffer(a));var d=a.getByte();c=Math.floor(d/40)+"."+d%40;for(var e=0;a.length()>0;)d=a.getByte(),e<<=7,128&d?e+=127&d:(c+="."+(e+d),e=0);return c},c.utcTimeToDate=function(a){var b=new Date,c=parseInt(a.substr(0,2),10);c=c>=50?1900+c:2e3+c;var d=parseInt(a.substr(2,2),10)-1,e=parseInt(a.substr(4,2),10),f=parseInt(a.substr(6,2),10),g=parseInt(a.substr(8,2),10),h=0;if(a.length>11){var i=a.charAt(10),j=10;"+"!==i&&"-"!==i&&(h=parseInt(a.substr(10,2),10),j+=2)}if(b.setUTCFullYear(c,d,e),b.setUTCHours(f,g,h,0),j&&(i=a.charAt(j),"+"===i||"-"===i)){var k=parseInt(a.substr(j+1,2),10),l=parseInt(a.substr(j+4,2),10),m=60*k+l;m*=6e4,"+"===i?b.setTime(+b-m):b.setTime(+b+m)}return b},c.generalizedTimeToDate=function(a){var b=new Date,c=parseInt(a.substr(0,4),10),d=parseInt(a.substr(4,2),10)-1,e=parseInt(a.substr(6,2),10),f=parseInt(a.substr(8,2),10),g=parseInt(a.substr(10,2),10),h=parseInt(a.substr(12,2),10),i=0,j=0,k=!1;"Z"===a.charAt(a.length-1)&&(k=!0);var l=a.length-5,m=a.charAt(l);if("+"===m||"-"===m){var n=parseInt(a.substr(l+1,2),10),o=parseInt(a.substr(l+4,2),10);j=60*n+o,j*=6e4,"+"===m&&(j*=-1),k=!0}return"."===a.charAt(14)&&(i=1e3*parseFloat(a.substr(14),10)),k?(b.setUTCFullYear(c,d,e),b.setUTCHours(f,g,h,i),b.setTime(+b+j)):(b.setFullYear(c,d,e),b.setHours(f,g,h,i)),b},c.dateToUtcTime=function(a){var b="",c=[];c.push((""+a.getUTCFullYear()).substr(2)),c.push(""+(a.getUTCMonth()+1)),c.push(""+a.getUTCDate()),c.push(""+a.getUTCHours()),c.push(""+a.getUTCMinutes()),c.push(""+a.getUTCSeconds());for(var d=0;d<c.length;++d)c[d].length<2&&(b+="0"),b+=c[d];return b+="Z"},c.integerToDer=function(a){var c=b.util.createBuffer();if(a>=-128&&128>a)return c.putSignedInt(a,8);if(a>=-32768&&32768>a)return c.putSignedInt(a,16);if(a>=-8388608&&8388608>a)return c.putSignedInt(a,24);if(a>=-2147483648&&2147483648>a)return c.putSignedInt(a,32);var d=new Error("Integer too large; max is 32-bits.");throw d.integer=a,d},c.derToInteger=function(a){"string"==typeof a&&(a=b.util.createBuffer(a));var c=8*a.length();if(c>32)throw new Error("Integer too large; max is 32-bits.");return a.getSignedInt(c)},c.validate=function(a,d,e,f){var g=!1;if(a.tagClass!==d.tagClass&&"undefined"!=typeof d.tagClass||a.type!==d.type&&"undefined"!=typeof d.type)f&&(a.tagClass!==d.tagClass&&f.push("["+d.name+'] Expected tag class "'+d.tagClass+'", got "'+a.tagClass+'"'),a.type!==d.type&&f.push("["+d.name+'] Expected type "'+d.type+'", got "'+a.type+'"'));else if(a.constructed===d.constructed||"undefined"==typeof d.constructed){if(g=!0,d.value&&b.util.isArray(d.value))for(var h=0,i=0;g&&i<d.value.length;++i)g=d.value[i].optional||!1,a.value[h]&&(g=c.validate(a.value[h],d.value[i],e,f),g?++h:d.value[i].optional&&(g=!0)),!g&&f&&f.push("["+d.name+'] Tag class "'+d.tagClass+'", type "'+d.type+'" expected value length "'+d.value.length+'", got "'+a.value.length+'"');g&&e&&(d.capture&&(e[d.capture]=a.value),d.captureAsn1&&(e[d.captureAsn1]=a))}else f&&f.push("["+d.name+'] Expected constructed "'+d.constructed+'", got "'+a.constructed+'"');return g}}var b="asn1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util","./oids"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(a){function b(a,b,c){this.data=[],null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function c(){return new b(null)}function d(a,b,c,d,e,f){for(;--f>=0;){var g=b*this.data[a++]+c.data[d]+e;e=Math.floor(g/67108864),c.data[d++]=67108863&g}return e}function e(a,b,c,d,e,f){for(var g=32767&b,h=b>>15;--f>=0;){var i=32767&this.data[a],j=this.data[a++]>>15,k=h*i+j*g;i=g*i+((32767&k)<<15)+c.data[d]+(1073741823&e),e=(i>>>30)+(k>>>15)+h*j+(e>>>30),c.data[d++]=1073741823&i}return e}function f(a,b,c,d,e,f){for(var g=16383&b,h=b>>14;--f>=0;){var i=16383&this.data[a],j=this.data[a++]>>14,k=h*i+j*g;i=g*i+((16383&k)<<14)+c.data[d]+e,e=(i>>28)+(k>>14)+h*j,c.data[d++]=268435455&i}return e}function g(a){return fb.charAt(a)}function h(a,b){var c=gb[a.charCodeAt(b)];return null==c?-1:c}function i(a){for(var b=this.t-1;b>=0;--b)a.data[b]=this.data[b];a.t=this.t,a.s=this.s}function j(a){this.t=1,this.s=0>a?-1:0,a>0?this.data[0]=a:-1>a?this.data[0]=a+this.DV:this.t=0}function k(a){var b=c();return b.fromInt(a),b}function l(a,c){var d;if(16==c)d=4;else if(8==c)d=3;else if(256==c)d=8;else if(2==c)d=1;else if(32==c)d=5;else{if(4!=c)return void this.fromRadix(a,c);d=2}this.t=0,this.s=0;for(var e=a.length,f=!1,g=0;--e>=0;){var i=8==d?255&a[e]:h(a,e);0>i?"-"==a.charAt(e)&&(f=!0):(f=!1,0==g?this.data[this.t++]=i:g+d>this.DB?(this.data[this.t-1]|=(i&(1<<this.DB-g)-1)<<g,this.data[this.t++]=i>>this.DB-g):this.data[this.t-1]|=i<<g,g+=d,g>=this.DB&&(g-=this.DB))}8==d&&0!=(128&a[0])&&(this.s=-1,g>0&&(this.data[this.t-1]|=(1<<this.DB-g)-1<<g)),this.clamp(),f&&b.ZERO.subTo(this,this)}function m(){for(var a=this.s&this.DM;this.t>0&&this.data[this.t-1]==a;)--this.t}function n(a){if(this.s<0)return"-"+this.negate().toString(a);var b;if(16==a)b=4;else if(8==a)b=3;else if(2==a)b=1;else if(32==a)b=5;else{if(4!=a)return this.toRadix(a);b=2}var c,d=(1<<b)-1,e=!1,f="",h=this.t,i=this.DB-h*this.DB%b;if(h-- >0)for(i<this.DB&&(c=this.data[h]>>i)>0&&(e=!0,f=g(c));h>=0;)b>i?(c=(this.data[h]&(1<<i)-1)<<b-i,c|=this.data[--h]>>(i+=this.DB-b)):(c=this.data[h]>>(i-=b)&d,0>=i&&(i+=this.DB,--h)),c>0&&(e=!0),e&&(f+=g(c));return e?f:"0"}function o(){var a=c();return b.ZERO.subTo(this,a),a}function p(){return this.s<0?this.negate():this}function q(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;if(b=c-a.t,0!=b)return this.s<0?-b:b;for(;--c>=0;)if(0!=(b=this.data[c]-a.data[c]))return b;return 0}function r(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=(b=a>>1)&&(a=b,c+=1),c}function s(){return this.t<=0?0:this.DB*(this.t-1)+r(this.data[this.t-1]^this.s&this.DM)}function t(a,b){var c;for(c=this.t-1;c>=0;--c)b.data[c+a]=this.data[c];for(c=a-1;c>=0;--c)b.data[c]=0;b.t=this.t+a,b.s=this.s}function u(a,b){for(var c=a;c<this.t;++c)b.data[c-a]=this.data[c];b.t=Math.max(this.t-a,0),b.s=this.s}function v(a,b){var c,d=a%this.DB,e=this.DB-d,f=(1<<e)-1,g=Math.floor(a/this.DB),h=this.s<<d&this.DM;for(c=this.t-1;c>=0;--c)b.data[c+g+1]=this.data[c]>>e|h,h=(this.data[c]&f)<<d;for(c=g-1;c>=0;--c)b.data[c]=0;b.data[g]=h,b.t=this.t+g+1,b.s=this.s,b.clamp()}function w(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)return void(b.t=0);var d=a%this.DB,e=this.DB-d,f=(1<<d)-1;b.data[0]=this.data[c]>>d;for(var g=c+1;g<this.t;++g)b.data[g-c-1]|=(this.data[g]&f)<<e,b.data[g-c]=this.data[g]>>d;d>0&&(b.data[this.t-c-1]|=(this.s&f)<<e),b.t=this.t-c,b.clamp()}function x(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this.data[c]-a.data[c],b.data[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this.data[c],b.data[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d-=a.data[c],b.data[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=0>d?-1:0,-1>d?b.data[c++]=this.DV+d:d>0&&(b.data[c++]=d),b.t=c,b.clamp()}function y(a,c){var d=this.abs(),e=a.abs(),f=d.t;for(c.t=f+e.t;--f>=0;)c.data[f]=0;for(f=0;f<e.t;++f)c.data[f+d.t]=d.am(0,e.data[f],c,f,0,d.t);c.s=0,c.clamp(),this.s!=a.s&&b.ZERO.subTo(c,c)}function z(a){for(var b=this.abs(),c=a.t=2*b.t;--c>=0;)a.data[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b.data[c],a,2*c,0,1);(a.data[c+b.t]+=b.am(c+1,2*b.data[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a.data[c+b.t]-=b.DV,a.data[c+b.t+1]=1)}a.t>0&&(a.data[a.t-1]+=b.am(c,b.data[c],a,2*c,0,1)),a.s=0,a.clamp()}function A(a,d,e){var f=a.abs();if(!(f.t<=0)){var g=this.abs();if(g.t<f.t)return null!=d&&d.fromInt(0),void(null!=e&&this.copyTo(e));null==e&&(e=c());var h=c(),i=this.s,j=a.s,k=this.DB-r(f.data[f.t-1]);k>0?(f.lShiftTo(k,h),g.lShiftTo(k,e)):(f.copyTo(h),g.copyTo(e));var l=h.t,m=h.data[l-1];if(0!=m){var n=m*(1<<this.F1)+(l>1?h.data[l-2]>>this.F2:0),o=this.FV/n,p=(1<<this.F1)/n,q=1<<this.F2,s=e.t,t=s-l,u=null==d?c():d;for(h.dlShiftTo(t,u),e.compareTo(u)>=0&&(e.data[e.t++]=1,e.subTo(u,e)),b.ONE.dlShiftTo(l,u),u.subTo(h,h);h.t<l;)h.data[h.t++]=0;for(;--t>=0;){var v=e.data[--s]==m?this.DM:Math.floor(e.data[s]*o+(e.data[s-1]+q)*p);if((e.data[s]+=h.am(0,v,e,t,0,l))<v)for(h.dlShiftTo(t,u),e.subTo(u,e);e.data[s]<--v;)e.subTo(u,e)}null!=d&&(e.drShiftTo(l,d),i!=j&&b.ZERO.subTo(d,d)),e.t=l,e.clamp(),k>0&&e.rShiftTo(k,e),0>i&&b.ZERO.subTo(e,e)}}}function B(a){var d=c();return this.abs().divRemTo(a,null,d),this.s<0&&d.compareTo(b.ZERO)>0&&a.subTo(d,d),d}function C(a){this.m=a}function D(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a}function E(a){return a}function F(a){a.divRemTo(this.m,null,a)}function G(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function H(a,b){a.squareTo(b),this.reduce(b)}function I(){if(this.t<1)return 0;var a=this.data[0];if(0==(1&a))return 0;var b=3&a;return b=b*(2-(15&a)*b)&15,b=b*(2-(255&a)*b)&255,b=b*(2-((65535&a)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV,b>0?this.DV-b:-b}function J(a){this.m=a,this.mp=a.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function K(a){var d=c();return a.abs().dlShiftTo(this.m.t,d),d.divRemTo(this.m,null,d),a.s<0&&d.compareTo(b.ZERO)>0&&this.m.subTo(d,d),d}function L(a){var b=c();return a.copyTo(b),this.reduce(b),b}function M(a){for(;a.t<=this.mt2;)a.data[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=32767&a.data[b],d=c*this.mpl+((c*this.mph+(a.data[b]>>15)*this.mpl&this.um)<<15)&a.DM;for(c=b+this.m.t,a.data[c]+=this.m.am(0,d,a,b,0,this.m.t);a.data[c]>=a.DV;)a.data[c]-=a.DV,a.data[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)}function N(a,b){a.squareTo(b),this.reduce(b)}function O(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function P(){return 0==(this.t>0?1&this.data[0]:this.s)}function Q(a,d){if(a>4294967295||1>a)return b.ONE;var e=c(),f=c(),g=d.convert(this),h=r(a)-1;for(g.copyTo(e);--h>=0;)if(d.sqrTo(e,f),(a&1<<h)>0)d.mulTo(f,g,e);else{var i=e;e=f,f=i}return d.revert(e)}function R(a,b){var c;return c=256>a||b.isEven()?new C(b):new J(b),this.exp(a,c)}function S(){var a=c();return this.copyTo(a),a}function T(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function U(){return 0==this.t?this.s:this.data[0]<<24>>24}function V(){return 0==this.t?this.s:this.data[0]<<16>>16}function W(a){return Math.floor(Math.LN2*this.DB/Math.log(a))}function X(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1}function Y(a){if(null==a&&(a=10),0==this.signum()||2>a||a>36)return"0";var b=this.chunkSize(a),d=Math.pow(a,b),e=k(d),f=c(),g=c(),h="";for(this.divRemTo(e,f,g);f.signum()>0;)h=(d+g.intValue()).toString(a).substr(1)+h,f.divRemTo(e,f,g);return g.intValue().toString(a)+h}function Z(a,c){this.fromInt(0),null==c&&(c=10);for(var d=this.chunkSize(c),e=Math.pow(c,d),f=!1,g=0,i=0,j=0;j<a.length;++j){var k=h(a,j);0>k?"-"==a.charAt(j)&&0==this.signum()&&(f=!0):(i=c*i+k,++g>=d&&(this.dMultiply(e),this.dAddOffset(i,0),g=0,i=0))}g>0&&(this.dMultiply(Math.pow(c,g)),this.dAddOffset(i,0)),f&&b.ZERO.subTo(this,this)}function $(a,c,d){if("number"==typeof c)if(2>a)this.fromInt(1);else for(this.fromNumber(a,d),this.testBit(a-1)||this.bitwiseTo(b.ONE.shiftLeft(a-1),ga,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(c);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(b.ONE.shiftLeft(a-1),this);else{var e=new Array,f=7&a;e.length=(a>>3)+1,c.nextBytes(e),f>0?e[0]&=(1<<f)-1:e[0]=0,this.fromString(e,256)}}function _(){var a=this.t,b=new Array;b[0]=this.s;var c,d=this.DB-a*this.DB%8,e=0;if(a-- >0)for(d<this.DB&&(c=this.data[a]>>d)!=(this.s&this.DM)>>d&&(b[e++]=c|this.s<<this.DB-d);a>=0;)8>d?(c=(this.data[a]&(1<<d)-1)<<8-d,c|=this.data[--a]>>(d+=this.DB-8)):(c=this.data[a]>>(d-=8)&255,0>=d&&(d+=this.DB,--a)),0!=(128&c)&&(c|=-256),0==e&&(128&this.s)!=(128&c)&&++e,(e>0||c!=this.s)&&(b[e++]=c);return b}function aa(a){return 0==this.compareTo(a)}function ba(a){return this.compareTo(a)<0?this:a}function ca(a){return this.compareTo(a)>0?this:a}function da(a,b,c){var d,e,f=Math.min(a.t,this.t);for(d=0;f>d;++d)c.data[d]=b(this.data[d],a.data[d]);if(a.t<this.t){for(e=a.s&this.DM,d=f;d<this.t;++d)c.data[d]=b(this.data[d],e);c.t=this.t}else{for(e=this.s&this.DM,d=f;d<a.t;++d)c.data[d]=b(e,a.data[d]);c.t=a.t}c.s=b(this.s,a.s),c.clamp()}function ea(a,b){return a&b}function fa(a){var b=c();return this.bitwiseTo(a,ea,b),b}function ga(a,b){return a|b}function ha(a){var b=c();return this.bitwiseTo(a,ga,b),b}function ia(a,b){return a^b}function ja(a){var b=c();return this.bitwiseTo(a,ia,b),b}function ka(a,b){return a&~b}function la(a){var b=c();return this.bitwiseTo(a,ka,b),b}function ma(){for(var a=c(),b=0;b<this.t;++b)a.data[b]=this.DM&~this.data[b];return a.t=this.t,a.s=~this.s,a}function na(a){var b=c();return 0>a?this.rShiftTo(-a,b):this.lShiftTo(a,b),b}function oa(a){var b=c();return 0>a?this.lShiftTo(-a,b):this.rShiftTo(a,b),b}function pa(a){if(0==a)return-1;var b=0;return 0==(65535&a)&&(a>>=16,b+=16),0==(255&a)&&(a>>=8,b+=8),0==(15&a)&&(a>>=4,b+=4),0==(3&a)&&(a>>=2,b+=2),0==(1&a)&&++b,b}function qa(){for(var a=0;a<this.t;++a)if(0!=this.data[a])return a*this.DB+pa(this.data[a]);return this.s<0?this.t*this.DB:-1}function ra(a){for(var b=0;0!=a;)a&=a-1,++b;return b}function sa(){for(var a=0,b=this.s&this.DM,c=0;c<this.t;++c)a+=ra(this.data[c]^b);return a}function ta(a){var b=Math.floor(a/this.DB);return b>=this.t?0!=this.s:0!=(this.data[b]&1<<a%this.DB)}function ua(a,c){var d=b.ONE.shiftLeft(a);return this.bitwiseTo(d,c,d),d}function va(a){return this.changeBit(a,ga)}function wa(a){return this.changeBit(a,ka)}function xa(a){return this.changeBit(a,ia)}function ya(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this.data[c]+a.data[c],b.data[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d+=a.s;c<this.t;)d+=this.data[c],b.data[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d+=a.data[c],b.data[c++]=d&this.DM,d>>=this.DB;d+=a.s}b.s=0>d?-1:0,d>0?b.data[c++]=d:-1>d&&(b.data[c++]=this.DV+d),b.t=c,b.clamp()}function za(a){var b=c();return this.addTo(a,b),b}function Aa(a){var b=c();return this.subTo(a,b),b}function Ba(a){var b=c();return this.multiplyTo(a,b),b}function Ca(a){var b=c();return this.divRemTo(a,b,null),b}function Da(a){var b=c();return this.divRemTo(a,null,b),b}function Ea(a){var b=c(),d=c();return this.divRemTo(a,b,d),new Array(b,d)}function Fa(a){this.data[this.t]=this.am(0,a-1,this,0,0,this.t),++this.t,this.clamp()}function Ga(a,b){if(0!=a){for(;this.t<=b;)this.data[this.t++]=0;for(this.data[b]+=a;this.data[b]>=this.DV;)this.data[b]-=this.DV,++b>=this.t&&(this.data[this.t++]=0),++this.data[b]}}function Ha(){}function Ia(a){return a}function Ja(a,b,c){a.multiplyTo(b,c)}function Ka(a,b){a.squareTo(b)}function La(a){return this.exp(a,new Ha)}function Ma(a,b,c){var d=Math.min(this.t+a.t,b);for(c.s=0,c.t=d;d>0;)c.data[--d]=0;var e;for(e=c.t-this.t;e>d;++d)c.data[d+this.t]=this.am(0,a.data[d],c,d,0,this.t);for(e=Math.min(a.t,b);e>d;++d)this.am(0,a.data[d],c,d,0,b-d);c.clamp()}function Na(a,b,c){--b;var d=c.t=this.t+a.t-b;for(c.s=0;--d>=0;)c.data[d]=0;for(d=Math.max(b-this.t,0);d<a.t;++d)c.data[this.t+d-b]=this.am(b-d,a.data[d],c,0,0,this.t+d-b);c.clamp(),c.drShiftTo(1,c)}function Oa(a){this.r2=c(),this.q3=c(),b.ONE.dlShiftTo(2*a.t,this.r2),this.mu=this.r2.divide(a),this.m=a}function Pa(a){if(a.s<0||a.t>2*this.m.t)return a.mod(this.m);if(a.compareTo(this.m)<0)return a;var b=c();return a.copyTo(b),this.reduce(b),b}function Qa(a){return a}function Ra(a){for(a.drShiftTo(this.m.t-1,this.r2),a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);a.compareTo(this.r2)<0;)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);a.compareTo(this.m)>=0;)a.subTo(this.m,a)}function Sa(a,b){a.squareTo(b),this.reduce(b)}function Ta(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function Ua(a,b){var d,e,f=a.bitLength(),g=k(1);if(0>=f)return g;d=18>f?1:48>f?3:144>f?4:768>f?5:6,e=8>f?new C(b):b.isEven()?new Oa(b):new J(b);var h=new Array,i=3,j=d-1,l=(1<<d)-1;if(h[1]=e.convert(this),d>1){var m=c();for(e.sqrTo(h[1],m);l>=i;)h[i]=c(),e.mulTo(m,h[i-2],h[i]),i+=2}var n,o,p=a.t-1,q=!0,s=c();for(f=r(a.data[p])-1;p>=0;){for(f>=j?n=a.data[p]>>f-j&l:(n=(a.data[p]&(1<<f+1)-1)<<j-f,p>0&&(n|=a.data[p-1]>>this.DB+f-j)),i=d;0==(1&n);)n>>=1,--i;if((f-=i)<0&&(f+=this.DB,--p),q)h[n].copyTo(g),q=!1;else{for(;i>1;)e.sqrTo(g,s),e.sqrTo(s,g),i-=2;i>0?e.sqrTo(g,s):(o=g,g=s,s=o),e.mulTo(s,h[n],g)}for(;p>=0&&0==(a.data[p]&1<<f);)e.sqrTo(g,s),o=g,g=s,s=o,--f<0&&(f=this.DB-1,--p)}return e.revert(g)}function Va(a){var b=this.s<0?this.negate():this.clone(),c=a.s<0?a.negate():a.clone();if(b.compareTo(c)<0){var d=b;b=c,c=d}var e=b.getLowestSetBit(),f=c.getLowestSetBit();if(0>f)return b;for(f>e&&(f=e),f>0&&(b.rShiftTo(f,b),c.rShiftTo(f,c));b.signum()>0;)(e=b.getLowestSetBit())>0&&b.rShiftTo(e,b),(e=c.getLowestSetBit())>0&&c.rShiftTo(e,c),b.compareTo(c)>=0?(b.subTo(c,b),b.rShiftTo(1,b)):(c.subTo(b,c),c.rShiftTo(1,c));return f>0&&c.lShiftTo(f,c),c}function Wa(a){if(0>=a)return 0;var b=this.DV%a,c=this.s<0?a-1:0;if(this.t>0)if(0==b)c=this.data[0]%a;else for(var d=this.t-1;d>=0;--d)c=(b*c+this.data[d])%a;return c}function Xa(a){var c=a.isEven();if(this.isEven()&&c||0==a.signum())return b.ZERO;for(var d=a.clone(),e=this.clone(),f=k(1),g=k(0),h=k(0),i=k(1);0!=d.signum();){for(;d.isEven();)d.rShiftTo(1,d),c?(f.isEven()&&g.isEven()||(f.addTo(this,f),g.subTo(a,g)),f.rShiftTo(1,f)):g.isEven()||g.subTo(a,g),g.rShiftTo(1,g);for(;e.isEven();)e.rShiftTo(1,e),c?(h.isEven()&&i.isEven()||(h.addTo(this,h),i.subTo(a,i)),h.rShiftTo(1,h)):i.isEven()||i.subTo(a,i),i.rShiftTo(1,i);d.compareTo(e)>=0?(d.subTo(e,d),c&&f.subTo(h,f),g.subTo(i,g)):(e.subTo(d,e),c&&h.subTo(f,h),i.subTo(g,i))}return 0!=e.compareTo(b.ONE)?b.ZERO:i.compareTo(a)>=0?i.subtract(a):i.signum()<0?(i.addTo(a,i),i.signum()<0?i.add(a):i):i}function Ya(a){var b,c=this.abs();if(1==c.t&&c.data[0]<=hb[hb.length-1]){for(b=0;b<hb.length;++b)if(c.data[0]==hb[b])return!0;return!1}if(c.isEven())return!1;for(b=1;b<hb.length;){for(var d=hb[b],e=b+1;e<hb.length&&ib>d;)d*=hb[e++];for(d=c.modInt(d);e>b;)if(d%hb[b++]==0)return!1}return c.millerRabin(a)}function Za(a){var c=this.subtract(b.ONE),d=c.getLowestSetBit();if(0>=d)return!1;for(var e,f=c.shiftRight(d),g=$a(),h=0;a>h;++h){do e=new b(this.bitLength(),g);while(e.compareTo(b.ONE)<=0||e.compareTo(c)>=0);var i=e.modPow(f,this);if(0!=i.compareTo(b.ONE)&&0!=i.compareTo(c)){for(var j=1;j++<d&&0!=i.compareTo(c);)if(i=i.modPowInt(2,this),0==i.compareTo(b.ONE))return!1;if(0!=i.compareTo(c))return!1}}return!0}function $a(){return{nextBytes:function(a){var b=window.crypto||window.msCrypto;if(b&&b.getRandomValues){var c=(Math.ceil(a.length/4),new Uint32Array(Math.ceil(a.length/4)));b.getRandomValues(c);for(var d=0,e=0;e<c.length;++e)e==c.length-1?(d<a.length&&(a[d++]=c[e]>>24&255),d<a.length&&(a[d++]=c[e]>>16&255),d<a.length&&(a[d++]=c[e]>>8&255),d<a.length&&(a[d++]=255&c[e])):(a[d++]=c[e]>>24&255,a[d++]=c[e]>>16&255,a[d++]=c[e]>>8&255,a[d++]=255&c[e])}else for(var e=0;e<a.length;++e)a[e]=Math.floor(255*Math.random())}}}var _a,ab=0xdeadbeefcafe,bb=15715070==(16777215&ab);"undefined"==typeof navigator?(b.prototype.am=f,_a=28):bb&&"Microsoft Internet Explorer"==navigator.appName?(b.prototype.am=e,_a=30):bb&&"Netscape"!=navigator.appName?(b.prototype.am=d,_a=26):(b.prototype.am=f,_a=28),b.prototype.DB=_a,b.prototype.DM=(1<<_a)-1,b.prototype.DV=1<<_a;var cb=52;b.prototype.FV=Math.pow(2,cb),b.prototype.F1=cb-_a,b.prototype.F2=2*_a-cb;var db,eb,fb="0123456789abcdefghijklmnopqrstuvwxyz",gb=new Array;for(db="0".charCodeAt(0),eb=0;9>=eb;++eb)gb[db++]=eb;for(db="a".charCodeAt(0),eb=10;36>eb;++eb)gb[db++]=eb;for(db="A".charCodeAt(0),eb=10;36>eb;++eb)gb[db++]=eb;C.prototype.convert=D,C.prototype.revert=E,C.prototype.reduce=F,C.prototype.mulTo=G,C.prototype.sqrTo=H,J.prototype.convert=K,J.prototype.revert=L,J.prototype.reduce=M,J.prototype.mulTo=O,J.prototype.sqrTo=N,b.prototype.copyTo=i,b.prototype.fromInt=j,b.prototype.fromString=l,b.prototype.clamp=m,b.prototype.dlShiftTo=t,b.prototype.drShiftTo=u,b.prototype.lShiftTo=v,b.prototype.rShiftTo=w,b.prototype.subTo=x,b.prototype.multiplyTo=y,b.prototype.squareTo=z,b.prototype.divRemTo=A,b.prototype.invDigit=I,b.prototype.isEven=P,b.prototype.exp=Q,b.prototype.toString=n,b.prototype.negate=o,b.prototype.abs=p,b.prototype.compareTo=q,b.prototype.bitLength=s,b.prototype.mod=B,b.prototype.modPowInt=R,b.ZERO=k(0),b.ONE=k(1),Ha.prototype.convert=Ia,Ha.prototype.revert=Ia,Ha.prototype.mulTo=Ja,Ha.prototype.sqrTo=Ka,Oa.prototype.convert=Pa,Oa.prototype.revert=Qa,Oa.prototype.reduce=Ra,Oa.prototype.mulTo=Ta,Oa.prototype.sqrTo=Sa;var hb=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],ib=(1<<26)/hb[hb.length-1];b.prototype.chunkSize=W,b.prototype.toRadix=Y,b.prototype.fromRadix=Z,b.prototype.fromNumber=$,b.prototype.bitwiseTo=da,b.prototype.changeBit=ua,b.prototype.addTo=ya,b.prototype.dMultiply=Fa,b.prototype.dAddOffset=Ga,b.prototype.multiplyLowerTo=Ma,b.prototype.multiplyUpperTo=Na,b.prototype.modInt=Wa,b.prototype.millerRabin=Za,b.prototype.clone=S,b.prototype.intValue=T,b.prototype.byteValue=U,b.prototype.shortValue=V,b.prototype.signum=X,b.prototype.toByteArray=_,b.prototype.equals=aa,b.prototype.min=ba,b.prototype.max=ca,b.prototype.and=fa,b.prototype.or=ha,b.prototype.xor=ja,b.prototype.andNot=la,b.prototype.not=ma,b.prototype.shiftLeft=na,b.prototype.shiftRight=oa,b.prototype.getLowestSetBit=qa,b.prototype.bitCount=sa,b.prototype.testBit=ta,b.prototype.setBit=va,b.prototype.clearBit=wa,b.prototype.flipBit=xa,b.prototype.add=za,b.prototype.subtract=Aa,b.prototype.multiply=Ba,b.prototype.divide=Ca,b.prototype.remainder=Da,b.prototype.divideAndRemainder=Ea,b.prototype.modPow=Ua,b.prototype.modInverse=Xa,b.prototype.pow=La,b.prototype.gcd=Va,b.prototype.isProbablePrime=Ya,a.jsbn=a.jsbn||{},a.jsbn.BigInteger=b}var b="jsbn";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),
c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(a){function b(a){if(this.data="",this.read=0,"string"==typeof a)this.data=a;else if(e.isArrayBuffer(a)||e.isArrayBufferView(a)){var c=new Uint8Array(a);try{this.data=String.fromCharCode.apply(null,c)}catch(d){for(var f=0;f<c.length;++f)this.putByte(c[f])}}else(a instanceof b||"object"==typeof a&&"string"==typeof a.data&&"number"==typeof a.read)&&(this.data=a.data,this.read=a.read)}function c(a,b){b=b||{},this.read=b.readOffset||0,this.growSize=b.growSize||1024;var c=e.isArrayBuffer(a),d=e.isArrayBufferView(a);return c||d?(c?this.data=new DataView(a):this.data=new DataView(a.buffer,a.byteOffset,a.byteLength),void(this.write="writeOffset"in b?b.writeOffset:this.data.byteLength)):(this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!==a&&void 0!==a&&this.putBytes(a),void("writeOffset"in b&&(this.write=b.writeOffset)))}var d=a.err=a.err||{};d.unsupported=1,d.wrongPasswd=2,d.revoked=3,d.expired=4,d.encrypt=5,d.decrypt=6,d.sign=7,d.verify=8,d.generate=9,d.process=10,d.encode=11,d.decode=12,d.license=13,d.invalidInput=14,d.vidNotExist=15;var e=a.util=a.util||{};"undefined"!=typeof process&&process.nextTick?(e.nextTick=process.nextTick,"function"==typeof setImmediate?e.setImmediate=setImmediate:e.setImmediate=e.nextTick):"function"==typeof setImmediate?(e.setImmediate=setImmediate,e.nextTick=function(a){return setImmediate(a)}):(e.setImmediate=function(a){setTimeout(a,0)},e.nextTick=e.setImmediate),e.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},e.isArrayBuffer=function(a){return"undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer},e.arrayIndexOf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1};var f=[];"undefined"!=typeof DataView&&f.push(DataView),"undefined"!=typeof Int8Array&&f.push(Int8Array),"undefined"!=typeof Uint8Array&&f.push(Uint8Array),"undefined"!=typeof Uint8ClampedArray&&f.push(Uint8ClampedArray),"undefined"!=typeof Int16Array&&f.push(Int16Array),"undefined"!=typeof Uint16Array&&f.push(Uint16Array),"undefined"!=typeof Int32Array&&f.push(Int32Array),"undefined"!=typeof Uint32Array&&f.push(Uint32Array),"undefined"!=typeof Float32Array&&f.push(Float32Array),"undefined"!=typeof Float64Array&&f.push(Float64Array),e.isArrayBufferView=function(a){for(var b=0;b<f.length;++b)if(a instanceof f[b])return!0;return!1},e.ByteBuffer=b,e.ByteStringBuffer=b,e.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},e.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},e.ByteStringBuffer.prototype.putByte=function(a){return this.data+=String.fromCharCode(a),this},e.ByteStringBuffer.prototype.fillWithByte=function(a,b){a=String.fromCharCode(a);for(var c=this.data;b>0;)1&b&&(c+=a),b>>>=1,b>0&&(a+=a);return this.data=c,this},e.ByteStringBuffer.prototype.putBytes=function(a){return this.data+=a,this},e.ByteStringBuffer.prototype.putString=function(a){return this.data+=e.encodeUtf8(a),this},e.ByteStringBuffer.prototype.putInt16=function(a){return this.data+=String.fromCharCode(a>>8&255)+String.fromCharCode(255&a),this},e.ByteStringBuffer.prototype.putInt24=function(a){return this.data+=String.fromCharCode(a>>16&255)+String.fromCharCode(a>>8&255)+String.fromCharCode(255&a),this},e.ByteStringBuffer.prototype.putInt32=function(a){return this.data+=String.fromCharCode(a>>24&255)+String.fromCharCode(a>>16&255)+String.fromCharCode(a>>8&255)+String.fromCharCode(255&a),this},e.ByteStringBuffer.prototype.putInt16Le=function(a){return this.data+=String.fromCharCode(255&a)+String.fromCharCode(a>>8&255),this},e.ByteStringBuffer.prototype.putInt24Le=function(a){return this.data+=String.fromCharCode(255&a)+String.fromCharCode(a>>8&255)+String.fromCharCode(a>>16&255),this},e.ByteStringBuffer.prototype.putInt32Le=function(a){return this.data+=String.fromCharCode(255&a)+String.fromCharCode(a>>8&255)+String.fromCharCode(a>>16&255)+String.fromCharCode(a>>24&255),this},e.ByteStringBuffer.prototype.putInt=function(a,b){do b-=8,this.data+=String.fromCharCode(a>>b&255);while(b>0);return this},e.ByteStringBuffer.prototype.putSignedInt=function(a,b){return 0>a&&(a+=2<<b-1),this.putInt(a,b)},e.ByteStringBuffer.prototype.putBuffer=function(a){return this.data+=a.getBytes(),this},e.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},e.ByteStringBuffer.prototype.getInt16=function(){var a=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,a},e.ByteStringBuffer.prototype.getInt24=function(){var a=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,a},e.ByteStringBuffer.prototype.getInt32=function(){var a=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,a},e.ByteStringBuffer.prototype.getInt16Le=function(){var a=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,a},e.ByteStringBuffer.prototype.getInt24Le=function(){var a=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,a},e.ByteStringBuffer.prototype.getInt32Le=function(){var a=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,a},e.ByteStringBuffer.prototype.getInt=function(a){var b=0;do b=(b<<8)+this.data.charCodeAt(this.read++),a-=8;while(a>0);return b},e.ByteStringBuffer.prototype.getSignedInt=function(a){var b=this.getInt(a),c=2<<a-2;return b>=c&&(b-=c<<1),b},e.ByteStringBuffer.prototype.getBytes=function(a){var b;return a?(a=Math.min(this.length(),a),b=this.data.slice(this.read,this.read+a),this.read+=a):0===a?b="":(b=0===this.read?this.data:this.data.slice(this.read),this.clear()),b},e.ByteStringBuffer.prototype.bytes=function(a){return"undefined"==typeof a?this.data.slice(this.read):this.data.slice(this.read,this.read+a)},e.ByteStringBuffer.prototype.at=function(a){return this.data.charCodeAt(this.read+a)},e.ByteStringBuffer.prototype.setAt=function(a,b){return this.data=this.data.substr(0,this.read+a)+String.fromCharCode(b)+this.data.substr(this.read+a+1),this},e.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},e.ByteStringBuffer.prototype.copy=function(){var a=e.createBuffer(this.data);return a.read=this.read,a},e.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},e.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},e.ByteStringBuffer.prototype.truncate=function(a){var b=Math.max(0,this.length()-a);return this.data=this.data.substr(this.read,b),this.read=0,this},e.ByteStringBuffer.prototype.toHex=function(){for(var a="",b=this.read;b<this.data.length;++b){var c=this.data.charCodeAt(b);16>c&&(a+="0"),a+=c.toString(16)}return a},e.ByteStringBuffer.prototype.toString=function(){return e.decodeUtf8(this.bytes())},e.DataBuffer=c,e.DataBuffer.prototype.length=function(){return this.write-this.read},e.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},e.DataBuffer.prototype.accommodate=function(a,b){if(this.length()>=a)return this;b=Math.max(b||this.growSize,a);var c=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),d=new Uint8Array(this.length()+b);return d.set(c),this.data=new DataView(d.buffer),this},e.DataBuffer.prototype.putByte=function(a){return this.accommodate(1),this.data.setUint8(this.write++,a),this},e.DataBuffer.prototype.fillWithByte=function(a,b){this.accommodate(b);for(var c=0;b>c;++c)this.data.setUint8(a);return this},e.DataBuffer.prototype.putBytes=function(a,b){if(e.isArrayBufferView(a)){var c=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),d=c.byteLength-c.byteOffset;this.accommodate(d);var f=new Uint8Array(this.data.buffer,this.write);return f.set(c),this.write+=d,this}if(e.isArrayBuffer(a)){var c=new Uint8Array(a);this.accommodate(c.byteLength);var f=new Uint8Array(this.data.buffer);return f.set(c,this.write),this.write+=c.byteLength,this}if(a instanceof e.DataBuffer||"object"==typeof a&&"number"==typeof a.read&&"number"==typeof a.write&&e.isArrayBufferView(a.data)){var c=new Uint8Array(a.data.byteLength,a.read,a.length());this.accommodate(c.byteLength);var f=new Uint8Array(a.data.byteLength,this.write);return f.set(c),this.write+=c.byteLength,this}if(a instanceof e.ByteStringBuffer&&(a=a.data,b="binary"),b=b||"binary","string"==typeof a){var g;if("hex"===b)return this.accommodate(Math.ceil(a.length/2)),g=new Uint8Array(this.data.buffer,this.write),this.write+=e.binary.hex.decode(a,g,this.write),this;if("base64"===b)return this.accommodate(3*Math.ceil(a.length/4)),g=new Uint8Array(this.data.buffer,this.write),this.write+=e.binary.base64.decode(a,g,this.write),this;if("utf8"===b&&(a=e.encodeUtf8(a),b="binary"),"binary"===b||"raw"===b)return this.accommodate(a.length),g=new Uint8Array(this.data.buffer,this.write),this.write+=e.binary.raw.decode(g),this;if("utf16"===b)return this.accommodate(2*a.length),g=new Uint16Array(this.data.buffer,this.write),this.write+=e.text.utf16.encode(g),this;throw new Error("Invalid encoding: "+b)}throw Error("Invalid parameter: "+a)},e.DataBuffer.prototype.putBuffer=function(a){return this.putBytes(a),a.clear(),this},e.DataBuffer.prototype.putString=function(a){return this.putBytes(a,"utf16")},e.DataBuffer.prototype.putInt16=function(a){return this.accommodate(2),this.data.setInt16(this.write,a),this.write+=2,this},e.DataBuffer.prototype.putInt24=function(a){return this.accommodate(3),this.data.setInt16(this.write,a>>8&65535),this.data.setInt8(this.write,a>>16&255),this.write+=3,this},e.DataBuffer.prototype.putInt32=function(a){return this.accommodate(4),this.data.setInt32(this.write,a),this.write+=4,this},e.DataBuffer.prototype.putInt16Le=function(a){return this.accommodate(2),this.data.setInt16(this.write,a,!0),this.write+=2,this},e.DataBuffer.prototype.putInt24Le=function(a){return this.accommodate(3),this.data.setInt8(this.write,a>>16&255),this.data.setInt16(this.write,a>>8&65535,!0),this.write+=3,this},e.DataBuffer.prototype.putInt32Le=function(a){return this.accommodate(4),this.data.setInt32(this.write,a,!0),this.write+=4,this},e.DataBuffer.prototype.putInt=function(a,b){this.accommodate(b/8);do b-=8,this.data.setInt8(this.write++,a>>b&255);while(b>0);return this},e.DataBuffer.prototype.putSignedInt=function(a,b){return this.accommodate(b/8),0>a&&(a+=2<<b-1),this.putInt(a,b)},e.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},e.DataBuffer.prototype.getInt16=function(){var a=this.data.getInt16(this.read);return this.read+=2,a},e.DataBuffer.prototype.getInt24=function(){var a=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,a},e.DataBuffer.prototype.getInt32=function(){var a=this.data.getInt32(this.read);return this.read+=4,a},e.DataBuffer.prototype.getInt16Le=function(){var a=this.data.getInt16(this.read,!0);return this.read+=2,a},e.DataBuffer.prototype.getInt24Le=function(){var a=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,a},e.DataBuffer.prototype.getInt32Le=function(){var a=this.data.getInt32(this.read,!0);return this.read+=4,a},e.DataBuffer.prototype.getInt=function(a){var b=0;do b=(b<<8)+this.data.getInt8(this.read++),a-=8;while(a>0);return b},e.DataBuffer.prototype.getSignedInt=function(a){var b=this.getInt(a),c=2<<a-2;return b>=c&&(b-=c<<1),b},e.DataBuffer.prototype.getBytes=function(a){var b;return a?(a=Math.min(this.length(),a),b=this.data.slice(this.read,this.read+a),this.read+=a):0===a?b="":(b=0===this.read?this.data:this.data.slice(this.read),this.clear()),b},e.DataBuffer.prototype.bytes=function(a){return"undefined"==typeof a?this.data.slice(this.read):this.data.slice(this.read,this.read+a)},e.DataBuffer.prototype.at=function(a){return this.data.getUint8(this.read+a)},e.DataBuffer.prototype.setAt=function(a,b){return this.data.setUint8(a,b),this},e.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},e.DataBuffer.prototype.copy=function(){return new e.DataBuffer(this)},e.DataBuffer.prototype.compact=function(){if(this.read>0){var a=new Uint8Array(this.data.buffer,this.read),b=new Uint8Array(a.byteLength);b.set(a),this.data=new DataView(b),this.write-=this.read,this.read=0}return this},e.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},e.DataBuffer.prototype.truncate=function(a){return this.write=Math.max(0,this.length()-a),this.read=Math.min(this.read,this.write),this},e.DataBuffer.prototype.toHex=function(){for(var a="",b=this.read;b<this.data.byteLength;++b){var c=this.data.getUint8(b);16>c&&(a+="0"),a+=c.toString(16)}return a},e.DataBuffer.prototype.toString=function(a){var b=new Uint8Array(this.data,this.read,this.length());if(a=a||"utf8","binary"===a||"raw"===a)return e.binary.raw.encode(b);if("hex"===a)return e.binary.hex.encode(b);if("base64"===a)return e.binary.base64.encode(b);if("utf8"===a)return e.text.utf8.decode(b);if("utf16"===a)return e.text.utf16.decode(b);throw new Error("Invalid encoding: "+a)},e.createBuffer=function(a,b){return b=b||"raw",void 0!==a&&"utf8"===b&&(a=e.encodeUtf8(a)),new e.ByteBuffer(a)},e.fillString=function(a,b){for(var c="";b>0;)1&b&&(c+=a),b>>>=1,b>0&&(a+=a);return c},e.xorBytes=function(a,b,c){for(var d="",e="",f="",g=0,h=0;c>0;--c,++g)e=a.charCodeAt(g)^b.charCodeAt(g),h>=10&&(d+=f,f="",h=0),f+=String.fromCharCode(e),++h;return d+=f},e.hexToBytes=function(a){var b="",c=0;for(a.length&!0&&(c=1,b+=String.fromCharCode(parseInt(a.substr(0,1),16)));c<a.length;c+=2)b+=String.fromCharCode(parseInt(a.substr(c,2),16));return b},e.bytesToHex=function(a){return e.createBuffer(a).toHex()},e.int32ToBytes=function(a){return String.fromCharCode(a>>24&255)+String.fromCharCode(a>>16&255)+String.fromCharCode(a>>8&255)+String.fromCharCode(255&a)};var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];e.encode64=function(a,b){for(var c,d,e,f="",h="",i=0;i<a.length;)c=a.charCodeAt(i++),d=a.charCodeAt(i++),e=a.charCodeAt(i++),f+=g.charAt(c>>2),f+=g.charAt((3&c)<<4|d>>4),isNaN(d)?f+="==":(f+=g.charAt((15&d)<<2|e>>6),f+=isNaN(e)?"=":g.charAt(63&e)),b&&f.length>b&&(h+=f.substr(0,b)+"\r\n",f=f.substr(b));return h+=f},e.decode64=function(a){a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var b,c,d,e,f="",g=0;g<a.length;)b=h[a.charCodeAt(g++)-43],c=h[a.charCodeAt(g++)-43],d=h[a.charCodeAt(g++)-43],e=h[a.charCodeAt(g++)-43],f+=String.fromCharCode(b<<2|c>>4),64!==d&&(f+=String.fromCharCode((15&c)<<4|d>>2),64!==e&&(f+=String.fromCharCode((3&d)<<6|e)));return f},e.encodeUtf8=function(a){return unescape(encodeURIComponent(a))},e.decodeUtf8=function(a){return decodeURIComponent(escape(a))},e.binary={raw:{},hex:{},base64:{}},e.binary.raw.encode=function(a){return String.fromCharCode.apply(null,a)},e.binary.raw.decode=function(a,b,c){var d=b;d||(d=new Uint8Array(a.length)),c=c||0;for(var e=c,f=0;f<a.length;++f)d[e++]=a.charCodeAt(f);return b?e-c:d},e.binary.hex.encode=e.bytesToHex,e.binary.hex.decode=function(a,b,c){var d=b;d||(d=new Uint8Array(Math.ceil(a.length/2))),c=c||0;var e=0,f=c;for(1&a.length&&(e=1,d[f++]=parseInt(a[0],16));e<a.length;e+=2)d[f++]=parseInt(a.substr(e,2),16);return b?f-c:d},e.binary.base64.encode=function(a,b){for(var c,d,e,f="",h="",i=0;i<a.byteLength;)c=a[i++],d=a[i++],e=a[i++],f+=g.charAt(c>>2),f+=g.charAt((3&c)<<4|d>>4),isNaN(d)?f+="==":(f+=g.charAt((15&d)<<2|e>>6),f+=isNaN(e)?"=":g.charAt(63&e)),b&&f.length>b&&(h+=f.substr(0,b)+"\r\n",f=f.substr(b));return h+=f},e.binary.base64.decode=function(a,b,c){var d=b;d||(d=new Uint8Array(3*Math.ceil(a.length/4))),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,""),c=c||0;for(var e,f,g,i,j=0,k=c;j<a.length;)e=h[a.charCodeAt(j++)-43],f=h[a.charCodeAt(j++)-43],g=h[a.charCodeAt(j++)-43],i=h[a.charCodeAt(j++)-43],d[k++]=e<<2|f>>4,64!==g&&(d[k++]=(15&f)<<4|g>>2,64!==i&&(d[k++]=(3&g)<<6|i));return b?k-c:d},e.text={utf8:{},utf16:{}},e.text.utf8.encode=function(a,b,c){a=e.encodeUtf8(a);var d=b;d||(d=new Uint8Array(a.length)),c=c||0;for(var f=c,g=0;g<a.length;++g)d[f++]=a.charCodeAt(g);return b?f-c:d},e.text.utf8.decode=function(a){return e.decodeUtf8(String.fromCharCode.apply(null,a))},e.text.utf16.encode=function(a,b,c){var d=b;d||(d=new Uint8Array(a.length));var e=new Uint16Array(d);c=c||0;for(var f=c,g=c,h=0;h<a.length;++h)e[g++]=a.charCodeAt(h),f+=2;return b?f-c:d},e.text.utf16.decode=function(a){return String.fromCharCode.apply(null,new Uint16Array(a))},e.deflate=function(a,b,c){if(b=e.decode64(a.deflate(e.encode64(b)).rval),c){var d=2,f=b.charCodeAt(1);32&f&&(d=6),b=b.substring(d,b.length-4)}return b},e.inflate=function(a,b,c){var d=a.inflate(e.encode64(b)).rval;return null===d?null:e.decode64(d)};var i=function(a,b,c){if(!a)throw new Error("WebStorage not available.");var d;if(null===c?d=a.removeItem(b):(c=e.encode64(JSON.stringify(c)),d=a.setItem(b,c)),"undefined"!=typeof d&&d.rval!==!0){var f=new Error(d.error.message);throw f.id=d.error.id,f.name=d.error.name,f}},j=function(a,b){if(!a)throw new Error("WebStorage not available.");var c=a.getItem(b);if(a.init)if(null===c.rval){if(c.error){var d=new Error(c.error.message);throw d.id=c.error.id,d.name=c.error.name,d}c=null}else c=c.rval;return null!==c&&(c=JSON.parse(e.decode64(c))),c},k=function(a,b,c,d){var e=j(a,b);null===e&&(e={}),e[c]=d,i(a,b,e)},l=function(a,b,c){var d=j(a,b);return null!==d&&(d=c in d?d[c]:null),d},m=function(a,b,c){var d=j(a,b);if(null!==d&&c in d){delete d[c];var e=!0;for(var f in d){e=!1;break}e&&(d=null),i(a,b,d)}},n=function(a,b){i(a,b,null)},o=function(a,b,c){var d=null;"undefined"==typeof c&&(c=["web","flash"]);var e,f=!1,g=null;for(var h in c){e=c[h];try{if("flash"===e||"both"===e){if(null===b[0])throw new Error("Flash local storage not available.");d=a.apply(this,b),f="flash"===e}"web"!==e&&"both"!==e||(b[0]=localStorage,d=a.apply(this,b),f=!0)}catch(i){g=i}if(f)break}if(!f)throw g;return d};e.setItem=function(a,b,c,d,e){o(k,arguments,e)},e.getItem=function(a,b,c,d){return o(l,arguments,d)},e.removeItem=function(a,b,c,d){o(m,arguments,d)},e.clearItems=function(a,b,c){o(n,arguments,c)},e.parseUrl=function(a){var b=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;b.lastIndex=0;var c=b.exec(a),d=null===c?null:{full:a,scheme:c[1],host:c[2],port:c[3],path:c[4]};return d&&(d.fullHost=d.host,d.port?80!==d.port&&"http"===d.scheme?d.fullHost+=":"+d.port:443!==d.port&&"https"===d.scheme&&(d.fullHost+=":"+d.port):"http"===d.scheme?d.port=80:"https"===d.scheme&&(d.port=443),d.full=d.scheme+"://"+d.fullHost),d};var p=null;e.getQueryVariables=function(a){var b,c=function(a){for(var b={},c=a.split("&"),d=0;d<c.length;d++){var e,f,g=c[d].indexOf("=");g>0?(e=c[d].substring(0,g),f=c[d].substring(g+1)):(e=c[d],f=null),e in b||(b[e]=[]),e in Object.prototype||null===f||b[e].push(unescape(f))}return b};return"undefined"==typeof a?(null===p&&(p="undefined"==typeof window?{}:c(window.location.search.substring(1))),b=p):b=c(a),b},e.parseFragment=function(a){var b=a,c="",d=a.indexOf("?");d>0&&(b=a.substring(0,d),c=a.substring(d+1));var f=b.split("/");f.length>0&&""===f[0]&&f.shift();var g=""===c?{}:e.getQueryVariables(c);return{pathString:b,queryString:c,path:f,query:g}},e.makeRequest=function(a){var b=e.parseFragment(a),c={path:b.pathString,query:b.queryString,getPath:function(a){return"undefined"==typeof a?b.path:b.path[a]},getQuery:function(a,c){var d;return"undefined"==typeof a?d=b.query:(d=b.query[a],d&&"undefined"!=typeof c&&(d=d[c])),d},getQueryLast:function(a,b){var d,e=c.getQuery(a);return d=e?e[e.length-1]:b}};return c},e.makeLink=function(a,b,c){a=jQuery.isArray(a)?a.join("/"):a;var d=jQuery.param(b||{});return c=c||"",a+(d.length>0?"?"+d:"")+(c.length>0?"#"+c:"")},e.setPath=function(a,b,c){if("object"==typeof a&&null!==a)for(var d=0,e=b.length;e>d;){var f=b[d++];if(d==e)a[f]=c;else{var g=f in a;(!g||g&&"object"!=typeof a[f]||g&&null===a[f])&&(a[f]={}),a=a[f]}}},e.getPath=function(a,b,c){for(var d=0,e=b.length,f=!0;f&&e>d&&"object"==typeof a&&null!==a;){var g=b[d++];f=g in a,f&&(a=a[g])}return f?a:c},e.deletePath=function(a,b){if("object"==typeof a&&null!==a)for(var c=0,d=b.length;d>c;){var e=b[c++];if(c==d)delete a[e];else{if(!(e in a)||"object"!=typeof a[e]||null===a[e])break;a=a[e]}}},e.isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},e.format=function(a){for(var b,c,d=/%./g,e=0,f=[],g=0;b=d.exec(a);){c=a.substring(g,d.lastIndex-2),c.length>0&&f.push(c),g=d.lastIndex;var h=b[0][1];switch(h){case"s":case"o":e<arguments.length?f.push(arguments[e++ +1]):f.push("<?>");break;case"%":f.push("%");break;default:f.push("<%"+h+"?>")}}return f.push(a.substring(g)),f.join("")},e.formatNumber=function(a,b,c,d){var e=a,f=isNaN(b=Math.abs(b))?2:b,g=void 0===c?",":c,h=void 0===d?".":d,i=0>e?"-":"",j=parseInt(e=Math.abs(+e||0).toFixed(f),10)+"",k=j.length>3?j.length%3:0;return i+(k?j.substr(0,k)+h:"")+j.substr(k).replace(/(\d{3})(?=\d)/g,"$1"+h)+(f?g+Math.abs(e-j).toFixed(f).slice(2):"")},e.formatSize=function(a){return a=a>=1073741824?e.formatNumber(a/1073741824,2,".","")+" GiB":a>=1048576?e.formatNumber(a/1048576,2,".","")+" MiB":a>=1024?e.formatNumber(a/1024,0)+" KiB":e.formatNumber(a,0)+" bytes"},e.bytesFromIP=function(a){return-1!==a.indexOf(".")?e.bytesFromIPv4(a):-1!==a.indexOf(":")?e.bytesFromIPv6(a):null},e.bytesFromIPv4=function(a){if(a=a.split("."),4!==a.length)return null;for(var b=e.createBuffer(),c=0;c<a.length;++c){var d=parseInt(a[c],10);if(isNaN(d))return null;b.putByte(d)}return b.getBytes()},e.bytesFromIPv6=function(a){var b=0;a=a.split(":").filter(function(a){return 0===a.length&&++b,!0});for(var c=2*(8-a.length+b),d=e.createBuffer(),f=0;8>f;++f)if(a[f]&&0!==a[f].length){var g=e.hexToBytes(a[f]);g.length<2&&d.putByte(0),d.putBytes(g)}else d.fillWithByte(0,c),c=0;return d.getBytes()},e.bytesToIP=function(a){return 4===a.length?e.bytesToIPv4(a):16===a.length?e.bytesToIPv6(a):null},e.bytesToIPv4=function(a){if(4!==a.length)return null;for(var b=[],c=0;c<a.length;++c)b.push(a.charCodeAt(c));return b.join(".")},e.bytesToIPv6=function(a){if(16!==a.length)return null;for(var b=[],c=[],d=0,f=0;f<a.length;f+=2){for(var g=e.bytesToHex(a[f]+a[f+1]);"0"===g[0]&&"0"!==g;)g=g.substr(1);if("0"===g){var h=c[c.length-1],i=b.length;h&&i===h.end+1?(h.end=i,h.end-h.start>c[d].end-c[d].start&&(d=c.length-1)):c.push({start:i,end:i})}b.push(g)}if(c.length>0){var j=c[d];j.end-j.start>0&&(b.splice(j.start,j.end-j.start+1,""),0===j.start&&b.unshift(""),7===j.end&&b.push(""))}return b.join(":")},e.estimateCores=function(a,b){function c(a,h,i){if(0===h){var j=Math.floor(a.reduce(function(a,b){return a+b},0)/a.length);return e.cores=Math.max(1,j),URL.revokeObjectURL(g),b(null,e.cores)}d(i,function(b,d){a.push(f(i,d)),c(a,h-1,i)})}function d(a,b){for(var c=[],d=[],e=0;a>e;++e){var f=new Worker(g);f.addEventListener("message",function(e){if(d.push(e.data),d.length===a){for(var f=0;a>f;++f)c[f].terminate();b(null,d)}}),c.push(f)}for(var e=0;a>e;++e)c[e].postMessage(e)}function f(a,b){for(var c=[],d=0;a>d;++d)for(var e=b[d],f=c[d]=[],g=0;a>g;++g)if(d!==g){var h=b[g];(e.st>h.st&&e.st<h.et||h.st>e.st&&h.st<e.et)&&f.push(g)}return c.reduce(function(a,b){return Math.max(a,b.length)},0)}if("function"==typeof a&&(b=a,a={}),a=a||{},"cores"in e&&!a.update)return b(null,e.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return e.cores=navigator.hardwareConcurrency,b(null,e.cores);if("undefined"==typeof Worker)return e.cores=1,b(null,e.cores);if("undefined"==typeof Blob)return e.cores=2,b(null,e.cores);var g=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(a){for(var b=Date.now(),c=b+4;Date.now()<c;);self.postMessage({st:b,et:c})})}.toString(),")()"],{type:"application/javascript"}));c([],5,16)}}var b="util";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a){for(var b=a.name+": ",c=[],d=function(a,b){return" "+b},e=0;e<a.values.length;++e)c.push(a.values[e].replace(/^(\S+\r\n)/,d));b+=c.join(",")+"\r\n";for(var f=0,g=-1,e=0;e<b.length;++e,++f)if(f>65&&-1!==g){var h=b[g];","===h?(++g,b=b.substr(0,g)+"\r\n "+b.substr(g)):b=b.substr(0,g)+"\r\n"+h+b.substr(g+1),f=e-g-1,g=-1,++e}else" "!==b[e]&&"	"!==b[e]&&","!==b[e]||(g=e);return b}function d(a){return a.replace(/^\s+/,"")}if(void 0==b)return void("function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"pem"));var e=b.pem=b.pem||{};e.encode=function(d,e){a(),e=e||{};var f,g="-----BEGIN "+d.type+"-----\r\n";if(d.procType&&(f={name:"Proc-Type",values:[String(d.procType.version),d.procType.type]},g+=c(f)),d.contentDomain&&(f={name:"Content-Domain",values:[d.contentDomain]},g+=c(f)),d.dekInfo&&(f={name:"DEK-Info",values:[d.dekInfo.algorithm]},d.dekInfo.parameters&&f.values.push(d.dekInfo.parameters),g+=c(f)),d.headers)for(var h=0;h<d.headers.length;++h)g+=c(d.headers[h]);return d.procType&&(g+="\r\n"),g+=b.util.encode64(d.body,e.maxline||64)+"\r\n",g+="-----END "+d.type+"-----\r\n"},e.decode=function(c){a();for(var e,f=[],g=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,h=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,i=/\r?\n/;;){if(e=g.exec(c),!e)break;var j={type:e[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:b.util.decode64(e[3])};if(f.push(j),e[2]){for(var k=e[2].split(i),l=0;e&&l<k.length;){for(var m=k[l].replace(/\s+$/,""),n=l+1;n<k.length;++n){var o=k[n];if(!/\s/.test(o[0]))break;m+=o,l=n}if(e=m.match(h)){for(var p={name:e[1],values:[]},q=e[2].split(","),r=0;r<q.length;++r)p.values.push(d(q[r]));if(j.procType)if(j.contentDomain||"Content-Domain"!==p.name)if(j.dekInfo||"DEK-Info"!==p.name)j.headers.push(p);else{if(0===p.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');j.dekInfo={algorithm:q[0],parameters:q[1]||null}}else j.contentDomain=q[0]||"";else{if("Proc-Type"!==p.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==p.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');j.procType={version:q[0],type:q[1]}}}++l}if("ENCRYPTED"===j.procType&&!j.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===f.length)throw new Error("Invalid PEM formatted message.");return f}}var b="pem";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(a){a.pki=a.pki||{};var b=a.pki.oids=a.oids=a.oids||{};b["1.2.840.113549.1.1.1"]="rsaEncryption",b.rsaEncryption="1.2.840.113549.1.1.1",b["1.2.410.200004.1.21"]="kcdsa1",b.kcdsa1="1.2.410.200004.1.21",b["1.2.410.200004.1.23"]="kcdsa1WithSHA1",b.kcdsa1WithSHA1="1.2.410.200004.1.23",b["1.2.410.200004.1.38"]="kcdsa1WithSHA256",b.kcdsa1WithSHA256="1.2.410.200004.1.38",b["1.2.840.113549.1.1.4"]="md5WithRSAEncryption",b.md5WithRSAEncryption="1.2.840.113549.1.1.4",b["1.2.840.113549.1.1.5"]="sha1WithRSAEncryption",b.sha1WithRSAEncryption="1.2.840.113549.1.1.5",b["1.2.840.113549.1.1.7"]="RSAES-OAEP",b.RSAES_OAEP="1.2.840.113549.1.1.7",b["1.2.840.113549.1.1.8"]="mgf1",b.mgf1="1.2.840.113549.1.1.8",b["1.2.840.113549.1.1.9"]="pSpecified",b.pSpecified="1.2.840.113549.1.1.9",b["1.2.840.113549.1.1.10"]="RSASSA_PSS",b.RSASSA_PSS="1.2.840.113549.1.1.10",b["1.2.840.113549.1.1.11"]="sha256WithRSAEncryption",b.sha256WithRSAEncryption="1.2.840.113549.1.1.11",b["1.2.840.113549.1.1.12"]="sha384WithRSAEncryption",b.sha384WithRSAEncryption="1.2.840.113549.1.1.12",b["1.2.840.113549.1.1.13"]="sha512WithRSAEncryption",b.sha512WithRSAEncryption="1.2.840.113549.1.1.13",b["1.3.14.3.2.7"]="desCBC",b.desCBC="1.3.14.3.2.7",b["1.3.14.3.2.26"]="sha1",b.sha1="1.3.14.3.2.26",b["2.16.840.1.101.3.4.2.1"]="sha256",b.sha256="2.16.840.1.101.3.4.2.1",b["2.16.840.1.101.3.4.2.2"]="sha384",b.sha384="2.16.840.1.101.3.4.2.2",b["2.16.840.1.101.3.4.2.3"]="sha512",b.sha512="2.16.840.1.101.3.4.2.3",b["1.2.840.113549.2.5"]="md5",b.md5="1.2.840.113549.2.5",b["1.2.840.113549.1.7.1"]="data",b.data="1.2.840.113549.1.7.1",b["1.2.840.113549.1.7.2"]="signedData",b.signedData="1.2.840.113549.1.7.2",b["1.2.840.113549.1.7.3"]="envelopedData",b.envelopedData="1.2.840.113549.1.7.3",b["1.2.840.113549.1.7.4"]="signedAndEnvelopedData",b.signedAndEnvelopedData="1.2.840.113549.1.7.4",b["1.2.840.113549.1.7.5"]="digestedData",b.digestedData="1.2.840.113549.1.7.5",b["1.2.840.113549.1.7.6"]="encryptedData",b.encryptedData="1.2.840.113549.1.7.6",b["1.2.840.113549.1.9.16.1.4"]="tstInfo",b.tstInfo="1.2.840.113549.1.9.16.1.4",b["1.2.840.113549.1.9.16.2.12"]="signingCertificate",b.signingCertificate="1.2.840.113549.1.9.16.2.12",b["1.2.840.113549.1.9.16.2.47"]="signingCertificateV2",b.signingCertificateV2="1.2.840.113549.1.9.16.2.47",b["1.2.410.200032.2.2"]="arcCertRes",b.arcCertRes="1.2.410.200032.2.2",b["1.2.410.200032.2.3.1"]="kiec_qualifications",b.kiec_qualifications="1.2.410.200032.2.3.1",b["1.2.410.200032.2.3.2"]="kiec_usageType",b.kiec_usageType="1.2.410.200032.2.3.2",b["1.2.410.200032.2.3.3"]="kiec_dateOfExpiration",b.kiec_dateOfExpiration="1.2.410.200032.2.3.3",b["1.2.410.200032.2.3.4"]="kiec_certifiedTime",b.kiec_certifiedTime="1.2.410.200032.2.3.4",b["1.2.410.200032.2.3.5"]="kiec_certUsage",b.kiec_certUsage="1.2.410.200032.2.3.5",b["1.2.410.200032.2.3.6"]="kiec_docContentInfoFlag",b.kiec_docContentInfoFlag="1.2.410.200032.2.3.6",b["1.2.410.200032.2.4.1"]="kiec_hashedIDNInfo",b.kiec_hashedIDNInfo="1.2.410.200032.2.4.1",b["1.2.840.113549.1.9.1"]="emailAddress",b.emailAddress="1.2.840.113549.1.9.1",b["1.2.840.113549.1.9.2"]="unstructuredName",b.unstructuredName="1.2.840.113549.1.9.2",b["1.2.840.113549.1.9.3"]="contentType",b.contentType="1.2.840.113549.1.9.3",b["1.2.840.113549.1.9.4"]="messageDigest",b.messageDigest="1.2.840.113549.1.9.4",
b["1.2.840.113549.1.9.5"]="signingTime",b.signingTime="1.2.840.113549.1.9.5",b["1.2.840.113549.1.9.6"]="counterSignature",b.counterSignature="1.2.840.113549.1.9.6",b["1.2.840.113549.1.9.7"]="challengePassword",b.challengePassword="1.2.840.113549.1.9.7",b["1.2.840.113549.1.9.8"]="unstructuredAddress",b.unstructuredAddress="1.2.840.113549.1.9.8",b["1.2.840.113549.1.9.14"]="extensionRequest",b.extensionRequest="1.2.840.113549.1.9.14",b["1.2.840.113549.1.9.20"]="friendlyName",b.friendlyName="1.2.840.113549.1.9.20",b["1.2.840.113549.1.9.21"]="localKeyId",b.localKeyId="1.2.840.113549.1.9.21",b["1.2.840.113549.1.9.22.1"]="x509Certificate",b.x509Certificate="1.2.840.113549.1.9.22.1",b["1.2.840.113549.1.12.10.1.1"]="keyBag",b.keyBag="1.2.840.113549.1.12.10.1.1",b["1.2.840.113549.1.12.10.1.2"]="pkcs8ShroudedKeyBag",b.pkcs8ShroudedKeyBag="1.2.840.113549.1.12.10.1.2",b["1.2.840.113549.1.12.10.1.3"]="certBag",b.certBag="1.2.840.113549.1.12.10.1.3",b["1.2.840.113549.1.12.10.1.4"]="crlBag",b.crlBag="1.2.840.113549.1.12.10.1.4",b["1.2.840.113549.1.12.10.1.5"]="secretBag",b.secretBag="1.2.840.113549.1.12.10.1.5",b["1.2.840.113549.1.12.10.1.6"]="safeContentsBag",b.safeContentsBag="1.2.840.113549.1.12.10.1.6",b["1.2.840.113549.1.5.13"]="pkcs5PBES2",b.pkcs5PBES2="1.2.840.113549.1.5.13",b["1.2.840.113549.1.5.12"]="pkcs5PBKDF2",b.pkcs5PBKDF2="1.2.840.113549.1.5.12",b["1.2.840.113549.1.12.1.1"]="pbeWithSHAAnd128BitRC4",b.pbeWithSHAAnd128BitRC4="1.2.840.113549.1.12.1.1",b["1.2.840.113549.1.12.1.2"]="pbeWithSHAAnd40BitRC4",b.pbeWithSHAAnd40BitRC4="1.2.840.113549.1.12.1.2",b["1.2.840.113549.1.12.1.3"]="pbeWithSHAAnd3-KeyTripleDES-CBC",b["pbeWithSHAAnd3-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.3",b["1.2.840.113549.1.12.1.4"]="pbeWithSHAAnd2-KeyTripleDES-CBC",b["pbeWithSHAAnd2-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.4",b["1.2.840.113549.1.12.1.5"]="pbeWithSHAAnd128BitRC2-CBC",b["pbeWithSHAAnd128BitRC2-CBC"]="1.2.840.113549.1.12.1.5",b["1.2.840.113549.1.12.1.6"]="pbewithSHAAnd40BitRC2-CBC",b["pbewithSHAAnd40BitRC2-CBC"]="1.2.840.113549.1.12.1.6",b["1.2.840.113549.3.7"]="des-EDE3-CBC",b["des-EDE3-CBC"]="1.2.840.113549.3.7",b["2.16.840.1.101.3.4.1.2"]="aes128-CBC",b["aes128-CBC"]="2.16.840.1.101.3.4.1.2",b["2.16.840.1.101.3.4.1.22"]="aes192-CBC",b["aes192-CBC"]="2.16.840.1.101.3.4.1.22",b["2.16.840.1.101.3.4.1.42"]="aes256-CBC",b["aes256-CBC"]="2.16.840.1.101.3.4.1.42",b["1.2.410.200004.1.4"]="seedCBC",b.seedCBC="1.2.410.200004.1.4",b["1.2.410.200004.1.15"]="seedCBCWithSHA1",b.seedCBCWithSHA1="1.2.410.200004.1.15",b["1.2.410.100001.1.20"]="ariaCBC",b.ariaCBC="1.2.410.100001.1.20",b["1.2.410.200046.1.1.2"]="aria128-CBC",b["aria128-CBC"]="1.2.410.200046.1.1.2",b["1.2.410.200046.1.1.7"]="aria192-CBC",b["aria192-CBC"]="1.2.410.200046.1.1.7",b["1.2.410.200046.1.1.12"]="aria256-CBC",b["aria256-CBC"]="1.2.410.200046.1.1.12",b["2.5.4.3"]="commonName",b.commonName="2.5.4.3",b["2.5.4.5"]="serialName",b.serialName="2.5.4.5",b["2.5.4.6"]="countryName",b.countryName="2.5.4.6",b["2.5.4.7"]="localityName",b.localityName="2.5.4.7",b["2.5.4.8"]="stateOrProvinceName",b.stateOrProvinceName="2.5.4.8",b["2.5.4.10"]="organizationName",b.organizationName="2.5.4.10",b["2.5.4.11"]="organizationalUnitName",b.organizationalUnitName="2.5.4.11",b["2.16.840.1.113730.1.1"]="nsCertType",b.nsCertType="2.16.840.1.113730.1.1",b["2.5.29.9"]="subjectDirectoryAttributes",b["2.5.29.14"]="subjectKeyIdentifier",b.subjectKeyIdentifier="2.5.29.14",b["2.5.29.15"]="keyUsage",b.keyUsage="2.5.29.15",b["2.5.29.16"]="privateKeyUsagePeriod",b["2.5.29.17"]="subjectAltName",b.subjectAltName="2.5.29.17",b["2.5.29.18"]="issuerAltName",b.issuerAltName="2.5.29.18",b["2.5.29.19"]="basicConstraints",b.basicConstraints="2.5.29.19",b["2.5.29.20"]="cRLNumber",b.cRLNumber="2.5.29.20",b["2.5.29.21"]="cRLReason",b.cRLReason="2.5.29.21",b["2.5.29.22"]="expirationDate",b["2.5.29.23"]="instructionCode",b["2.5.29.24"]="invalidityDate",b.invalidityDate="2.5.29.24",b["2.5.29.27"]="deltaCRLIndicator",b["2.5.29.28"]="issuingDistributionPoint",b.issuingDistributionPoint="2.5.29.28",b["2.5.29.29"]="certificateIssuer",b["2.5.29.30"]="nameConstraints",b["2.5.29.31"]="cRLDistributionPoints",b.cRLDistributionPoints="2.5.29.31",b["2.5.29.32"]="certificatePolicies",b.certificatePolicies="2.5.29.32",b["2.5.29.33"]="policyMappings",b["2.5.29.35"]="authorityKeyIdentifier",b.authorityKeyIdentifier="2.5.29.35",b["2.5.29.36"]="policyConstraints",b.policyConstraints="2.5.29.36",b["2.5.29.37"]="extKeyUsage",b.extKeyUsage="2.5.29.37",b["2.5.29.46"]="freshestCRL",b["2.5.29.54"]="inhibitAnyPolicy",b["1.3.6.1.5.5.7.3.1"]="serverAuth",b.serverAuth="1.3.6.1.5.5.7.3.1",b["1.3.6.1.5.5.7.3.2"]="clientAuth",b.clientAuth="1.3.6.1.5.5.7.3.2",b["1.3.6.1.5.5.7.3.3"]="codeSigning",b.codeSigning="1.3.6.1.5.5.7.3.3",b["1.3.6.1.5.5.7.3.4"]="emailProtection",b.emailProtection="1.3.6.1.5.5.7.3.4",b["1.3.6.1.5.5.7.3.8"]="timeStamping",b.timeStamping="1.3.6.1.5.5.7.3.8",b["1.3.6.1.5.5.7.1.1"]="authorityInfoAccess",b.authorityInfoAccess="1.3.6.1.5.5.7.1.1",b["1.3.6.1.5.5.7.2.1"]="cps",b["1.3.6.1.5.5.7.2.2"]="unotice",b.cps="1.3.6.1.5.5.7.2.1",b.unotice="1.3.6.1.5.5.7.2.2",b["1.3.6.1.5.5.7.48.1"]="ad_ocsp",b.ad_ocsp="1.3.6.1.5.5.7.48.1",b["1.3.6.1.5.5.7.48.2"]="ad_caIssuers",b.ad_caIssuers="1.3.6.1.5.5.7.48.2",b["1.2.410.200004.10.1.1"]="kisa_identifyData",b.kisa_identifyData="1.2.410.200004.10.1.1",b["1.2.410.200004.10.1.1.1"]="VID",b.VID="1.2.410.200004.10.1.1.1",b["1.2.410.200004.10.1.1.3"]="randomNum",b.randomNum="1.2.410.200004.10.1.1.3"}var b="oids";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){if(void 0==b)return void(dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"cipher"));b.cipher=b.cipher||{},b.cipher.algorithms=b.cipher.algorithms||{},b.cipher.createCipher=function(a,c){var d=a;if("string"==typeof d&&(d=b.cipher.getAlgorithm(d),d&&(d=d())),!d){var e=new Error("Unsupported algorithm: "+a);throw e.type=b.err.unsupported,e}return new b.cipher.BlockCipher({algorithm:d,key:c,decrypt:!1})},b.cipher.createDecipher=function(a,c){var d=a;if("string"==typeof d&&(d=b.cipher.getAlgorithm(d),d&&(d=d())),!d)throw new Error("Unsupported algorithm: "+a);return new b.cipher.BlockCipher({algorithm:d,key:c,decrypt:!0})},b.cipher.registerAlgorithm=function(a,c){a=a.toUpperCase(),b.cipher.algorithms[a]=c},b.cipher.getAlgorithm=function(a){return a=a.toUpperCase(),a in b.cipher.algorithms?b.cipher.algorithms[a]:null};var c=b.cipher.BlockCipher=function(a){this.algorithm=a.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=a.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=a.decrypt,this.algorithm.initialize(a)};c.prototype.start=function(c){a(),c=c||{};var d={};for(var e in c)d[e]=c[e];d.decrypt=this._decrypt,this._finish=!1,this._input=b.util.createBuffer(),this.output=c.output||b.util.createBuffer(),this.mode.start(d)},c.prototype.update=function(b){a(),this._finish||this._input.putBuffer(b);for(var c=!0;this._input.length()>=this.blockSize||this._input.length()>0&&this._finish;)this._op.call(this.mode,this._input,this.output,c),c=!1;this._input.compact()},c.prototype.finish=function(b){a(),b&&"CBC"===this.mode.name&&(this.mode.pad=function(a){return b(this.blockSize,a,!1)},this.mode.unpad=function(a){return b(this.blockSize,a,!0)});var c={};return c.decrypt=this._decrypt,c.overflow=this._input.length()%this.blockSize,this._decrypt||!this.mode.pad||this.mode.pad(this._input,c)?(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,c)?!1:!this.mode.afterFinish||this.mode.afterFinish(this.output,c)):!1}}var b="cipher";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a){if("string"==typeof a&&(a=b.util.createBuffer(a)),b.util.isArray(a)&&a.length>4){var c=a;a=b.util.createBuffer();for(var d=0;d<a.length;++d)a.putByte(c[d])}return b.util.isArray(a)||(a=[a.getInt32(),a.getInt32(),a.getInt32(),a.getInt32()]),a}if(void 0==b)return void(dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"cipherModes"));b.cipher=b.cipher||{};var d=b.cipher.modes=b.cipher.modes||{};d.cbc=function(a){a=a||{},this.name="CBC",this.cipher=a.cipher,this.blockSize=a.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=new Array(this._blocks),this._outBlock=new Array(this._blocks)},d.cbc.prototype.start=function(b){if(a(),null===b.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in b))throw new Error("Invalid IV parameter.");this._iv=c(b.iv),this._prev=this._iv.slice(0)}},d.cbc.prototype.encrypt=function(b,c,d){d&&a();for(var e=0;e<this._blocks;++e)this._inBlock[e]=this._prev[e]^b.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var e=0;e<this._blocks;++e)c.putInt32(this._outBlock[e]);this._prev=this._outBlock},d.cbc.prototype.decrypt=function(b,c,d){d&&a();for(var e=0;e<this._blocks;++e)this._inBlock[e]=b.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var e=0;e<this._blocks;++e)c.putInt32(this._prev[e]^this._outBlock[e]);this._prev=this._inBlock.slice(0)},d.cbc.prototype.pad=function(a,b){var c=a.length()===this.blockSize?this.blockSize:this.blockSize-a.length();return a.fillWithByte(c,c),!0},d.cbc.prototype.unpad=function(a,b){if(b.overflow>0)return!1;var c=a.length(),d=a.at(c-1);return d>this.blockSize<<2?!1:(a.truncate(d),!0)}}var b="cipherModes";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){if(void 0==b)return void("function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"hmac"));var c=b.hmac=b.hmac||{};c.create=function(){a();var c=null,d=null,e=null,f=null,g={};return g.start=function(a,g){if(null!==a)if("string"==typeof a){if(a=a.toLowerCase(),!(a in b.md.algorithms)){var h=new Error('Unknown hash algorithm "'+a+'"');throw h.type=b.err.unsupported,h}d=b.md.algorithms[a].create()}else d=a;if(null===g)g=c;else{if("string"==typeof g)g=b.util.createBuffer(g);else if(b.util.isArray(g)){var i=g;g=b.util.createBuffer();for(var j=0;j<i.length;++j)g.putByte(i[j])}var k=g.length();k>d.blockLength&&(d.start(),d.update(g.bytes()),g=d.digest()),e=b.util.createBuffer(),f=b.util.createBuffer(),k=g.length();for(var j=0;k>j;++j){var i=g.at(j);e.putByte(54^i),f.putByte(92^i)}if(k<d.blockLength)for(var i=d.blockLength-k,j=0;i>j;++j)e.putByte(54),f.putByte(92);c=g,e=e.bytes(),f=f.bytes()}d.start(),d.update(e)},g.update=function(a){d.update(a)},g.getMac=function(){var a=d.digest().bytes();return d.start(),d.update(f),d.update(a),d.digest()},g.digest=g.getMac,g}}var b="hmac";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./md","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(){f=String.fromCharCode(128),f+=b.util.fillString(String.fromCharCode(0),64),g=!0}function d(a,b,c){for(var d,e,f,g,h,i,j,k,l=c.length();l>=64;){for(e=a.h0,f=a.h1,g=a.h2,h=a.h3,i=a.h4,k=0;16>k;++k)d=c.getInt32()>>>0,b[k]=d>>>0,j=(h^f&(g^h))>>>0,d=(e<<5|e>>>27)+j+i+1518500249+d>>>0,i=h>>>0,h=g>>>0,g=(f<<30|f>>>2)>>>0,f=e>>>0,e=d>>>0;for(;20>k;++k)d=(b[k-3]^b[k-8]^b[k-14]^b[k-16])>>>0,d=(d<<1|d>>>31)>>>0,b[k]=d,j=(h^f&(g^h))>>>0,d=(e<<5|e>>>27)+j+i+1518500249+d>>>0,i=h>>>0,h=g>>>0,g=(f<<30|f>>>2)>>>0,f=e>>>0,e=d>>>0;for(;32>k;++k)d=(b[k-3]^b[k-8]^b[k-14]^b[k-16])>>>0,d=(d<<1|d>>>31)>>>0,b[k]=d>>>0,j=(f^g^h)>>>0,d=(e<<5|e>>>27)+j+i+1859775393+d>>>0,i=h>>>0,h=g>>>0,g=(f<<30|f>>>2)>>>0,f=e>>>0,e=d>>>0;for(;40>k;++k)d=(b[k-6]^b[k-16]^b[k-28]^b[k-32])>>>0,d=(d<<2|d>>>30)>>>0,b[k]=d>>>0,j=(f^g^h)>>>0,d=(e<<5|e>>>27)+j+i+1859775393+d>>>0,i=h>>>0,h=g>>>0,g=(f<<30|f>>>2)>>>0,f=e>>>0,e=d>>>0;for(;60>k;++k)d=(b[k-6]^b[k-16]^b[k-28]^b[k-32])>>>0,d=(d<<2|d>>>30)>>>0,b[k]=d>>>0,j=(f&g|h&(f^g))>>>0,d=(e<<5|e>>>27)+j+i+2400959708+d>>>0,i=h>>>0,h=g>>>0,g=(f<<30|f>>>2)>>>0,f=e>>>0,e=d>>>0;for(;80>k;++k)d=(b[k-6]^b[k-16]^b[k-28]^b[k-32])>>>0,d=(d<<2|d>>>30)>>>0,b[k]=d>>>0,j=(f^g^h)>>>0,d=(e<<5|e>>>27)+j+i+3395469782+d>>>0,i=h>>>0,h=g>>>0,g=(f<<30|f>>>2)>>>0,f=e>>>0,e=d>>>0;a.h0=a.h0+e|0,a.h1=a.h1+f|0,a.h2=a.h2+g|0,a.h3=a.h3+h|0,a.h4=a.h4+i|0,l-=64}}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"sha1");var e=b.sha1=b.sha1||{};b.md=b.md||{},b.md.algorithms=b.md.algorithms||{},b.md.sha1=b.md.algorithms.sha1=e,e.create=function(){a(),g||c();var e=null,h=b.util.createBuffer(),i=new Array(80),j={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,messageLength64:[0,0]};return j.start=function(){return j.messageLength=0,j.messageLength64=[0,0],h=b.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},j},j.start(),j.update=function(a,c){return"utf8"===c&&(a=b.util.encodeUtf8(a)),j.messageLength+=a.length,j.messageLength64[0]+=a.length/4294967296>>>0,j.messageLength64[1]+=a.length>>>0,h.putBytes(a),d(e,i,h),(h.read>2048||0===h.length())&&h.compact(),j},j.digest=function(){var a=b.util.createBuffer();a.putBytes(h.bytes()),a.putBytes(f.substr(0,64-(j.messageLength64[1]+8&63))),a.putInt32(j.messageLength64[0]<<3|j.messageLength64[0]>>>28),a.putInt32(j.messageLength64[1]<<3);var c={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};d(c,i,a);var g=b.util.createBuffer();return g.putInt32(c.h0),g.putInt32(c.h1),g.putInt32(c.h2),g.putInt32(c.h3),g.putInt32(c.h4),g},j};var f=null,g=!1}var b="sha1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(a){function b(){e=String.fromCharCode(128),e+=a.util.fillString(String.fromCharCode(0),64),g=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],f=!0}function c(a,b,c){for(var d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t=c.length();t>=64;){for(k=0;16>k;++k)b[k]=c.getInt32();for(;64>k;++k)d=b[k-2],d=(d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10,e=b[k-15],e=(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3,b[k]=d+b[k-7]+e+b[k-16]|0;for(l=a.h0,m=a.h1,n=a.h2,o=a.h3,p=a.h4,q=a.h5,r=a.h6,s=a.h7,k=0;64>k;++k)h=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),i=r^p&(q^r),f=(l>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),j=l&m|n&(l^m),d=s+h+i+g[k]+b[k],e=f+j,s=r,r=q,q=p,p=o+d|0,o=n,n=m,m=l,l=d+e|0;a.h0=a.h0+l|0,a.h1=a.h1+m|0,a.h2=a.h2+n|0,a.h3=a.h3+o|0,a.h4=a.h4+p|0,a.h5=a.h5+q|0,a.h6=a.h6+r|0,a.h7=a.h7+s|0,t-=64}}var d=a.sha256=a.sha256||{};a.md=a.md||{},a.md.algorithms=a.md.algorithms||{},a.md.sha256=a.md.algorithms.sha256=d,d.create=function(){f||b();var d=null,g=a.util.createBuffer(),h=new Array(64),i={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,messageLength64:[0,0]};return i.start=function(){return i.messageLength=0,i.messageLength64=[0,0],g=a.util.createBuffer(),d={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},i},i.start(),i.update=function(b,e){return"utf8"===e&&(b=a.util.encodeUtf8(b)),i.messageLength+=b.length,i.messageLength64[0]+=b.length/4294967296>>>0,i.messageLength64[1]+=b.length>>>0,g.putBytes(b),c(d,h,g),(g.read>2048||0===g.length())&&g.compact(),i},i.digest=function(){var b=a.util.createBuffer();b.putBytes(g.bytes()),b.putBytes(e.substr(0,64-(i.messageLength64[1]+8&63))),b.putInt32(i.messageLength64[0]<<3|i.messageLength64[0]>>>28),b.putInt32(i.messageLength64[1]<<3);var f={h0:d.h0,h1:d.h1,h2:d.h2,h3:d.h3,h4:d.h4,h5:d.h5,h6:d.h6,h7:d.h7};c(f,h,b);var j=a.util.createBuffer();return j.putInt32(f.h0),j.putInt32(f.h1),j.putInt32(f.h2),j.putInt32(f.h3),j.putInt32(f.h4),j.putInt32(f.h5),j.putInt32(f.h6),j.putInt32(f.h7),j},i};var e=null,f=!1,g=null}var b="sha256";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(){g=String.fromCharCode(128),g+=b.util.fillString(String.fromCharCode(0),128),i=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],j={},j["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],j["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],j["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],j["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],h=!0}function d(a,b,c){for(var d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N=c.length();N>=128;){for(G=0;16>G;++G)b[G][0]=c.getInt32()>>>0,b[G][1]=c.getInt32()>>>0;for(;80>G;++G)J=b[G-2],H=J[0],I=J[1],d=((H>>>19|I<<13)^(I>>>29|H<<3)^H>>>6)>>>0,e=((H<<13|I>>>19)^(I<<3|H>>>29)^(H<<26|I>>>6))>>>0,L=b[G-15],H=L[0],I=L[1],f=((H>>>1|I<<31)^(H>>>8|I<<24)^H>>>7)>>>0,g=((H<<31|I>>>1)^(H<<24|I>>>8)^(H<<25|I>>>7))>>>0,K=b[G-7],M=b[G-16],I=e+K[1]+g+M[1],b[G][0]=d+K[0]+f+M[0]+(I/4294967296>>>0)>>>0,b[G][1]=I>>>0;for(q=a[0][0],r=a[0][1],s=a[1][0],t=a[1][1],u=a[2][0],v=a[2][1],w=a[3][0],x=a[3][1],y=a[4][0],z=a[4][1],A=a[5][0],B=a[5][1],C=a[6][0],D=a[6][1],E=a[7][0],F=a[7][1],G=0;80>G;++G)k=((y>>>14|z<<18)^(y>>>18|z<<14)^(z>>>9|y<<23))>>>0,l=((y<<18|z>>>14)^(y<<14|z>>>18)^(z<<23|y>>>9))>>>0,m=(C^y&(A^C))>>>0,n=(D^z&(B^D))>>>0,h=((q>>>28|r<<4)^(r>>>2|q<<30)^(r>>>7|q<<25))>>>0,j=((q<<4|r>>>28)^(r<<30|q>>>2)^(r<<25|q>>>7))>>>0,o=(q&s|u&(q^s))>>>0,p=(r&t|v&(r^t))>>>0,I=F+l+n+i[G][1]+b[G][1],d=E+k+m+i[G][0]+b[G][0]+(I/4294967296>>>0)>>>0,e=I>>>0,I=j+p,f=h+o+(I/4294967296>>>0)>>>0,g=I>>>0,E=C,F=D,C=A,D=B,A=y,B=z,I=x+e,y=w+d+(I/4294967296>>>0)>>>0,z=I>>>0,w=u,x=v,u=s,v=t,s=q,t=r,I=e+g,q=d+f+(I/4294967296>>>0)>>>0,r=I>>>0;I=a[0][1]+r,a[0][0]=a[0][0]+q+(I/4294967296>>>0)>>>0,a[0][1]=I>>>0,I=a[1][1]+t,a[1][0]=a[1][0]+s+(I/4294967296>>>0)>>>0,a[1][1]=I>>>0,I=a[2][1]+v,a[2][0]=a[2][0]+u+(I/4294967296>>>0)>>>0,a[2][1]=I>>>0,I=a[3][1]+x,a[3][0]=a[3][0]+w+(I/4294967296>>>0)>>>0,a[3][1]=I>>>0,I=a[4][1]+z,a[4][0]=a[4][0]+y+(I/4294967296>>>0)>>>0,a[4][1]=I>>>0,I=a[5][1]+B,a[5][0]=a[5][0]+A+(I/4294967296>>>0)>>>0,a[5][1]=I>>>0,I=a[6][1]+D,a[6][0]=a[6][0]+C+(I/4294967296>>>0)>>>0,a[6][1]=I>>>0,I=a[7][1]+F,a[7][0]=a[7][0]+E+(I/4294967296>>>0)>>>0,a[7][1]=I>>>0,N-=128}}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"sha512");var e=b.sha512=b.sha512||{};b.md=b.md||{},b.md.algorithms=b.md.algorithms||{},b.md.sha512=b.md.algorithms.sha512=e;var f=b.sha384=b.sha512.sha384=b.sha512.sha384||{};f.create=function(){return e.create("SHA-384")},b.md.sha384=b.md.algorithms.sha384=f,b.sha512.sha256=b.sha512.sha256||{create:function(){return e.create("SHA-512/256")}},b.md["sha512/256"]=b.md.algorithms["sha512/256"]=b.sha512.sha256,b.sha512.sha224=b.sha512.sha224||{create:function(){return e.create("SHA-512/224")}},b.md["sha512/224"]=b.md.algorithms["sha512/224"]=b.sha512.sha224,e.create=function(e){if(a(),h||c(),"undefined"==typeof e&&(e="SHA-512"),!(e in j))throw new Error("Invalid SHA-512 algorithm: "+e);for(var f=j[e],i=null,k=b.util.createBuffer(),l=new Array(80),m=0;80>m;++m)l[m]=new Array(2);var n={algorithm:e.replace("-","").toLowerCase(),blockLength:128,digestLength:64,messageLength:0,messageLength128:[0,0,0,0]};return n.start=function(){n.messageLength=0,n.messageLength128=[0,0,0,0],k=b.util.createBuffer(),i=new Array(f.length);for(var a=0;a<f.length;++a)i[a]=f[a].slice(0);return n},n.start(),n.update=function(a,c){"utf8"===c&&(a=b.util.encodeUtf8(a)),n.messageLength+=a.length;var e=a.length;e=[e/4294967296>>>0,e>>>0];for(var f=3;f>=0;--f)n.messageLength128[f]+=e[1],e[1]=e[0]+(n.messageLength128[f]/4294967296>>>0),n.messageLength128[f]=n.messageLength128[f]>>>0,e[0]=e[1]/4294967296>>>0;return k.putBytes(a),d(i,l,k),(k.read>2048||0===k.length())&&k.compact(),n},n.digest=function(){var a=b.util.createBuffer();a.putBytes(k.bytes()),a.putBytes(g.substr(0,128-(n.messageLength128[3]+16&127)));for(var c=[],f=0;3>f;++f)c[f]=n.messageLength128[f]<<3|n.messageLength128[f-1]>>>28;c[3]=n.messageLength128[3]<<3,a.putInt32(c[0]),a.putInt32(c[1]),a.putInt32(c[2]),a.putInt32(c[3]);for(var h=new Array(i.length),f=0;f<i.length;++f)h[f]=i[f].slice(0);d(h,l,a);var j,m=b.util.createBuffer();j="SHA-512"===e?h.length:"SHA-384"===e?h.length-2:h.length-4;for(var f=0;j>f;++f)m.putInt32(h[f][0]),f===j-1&&"SHA-512/224"===e||m.putInt32(h[f][1]);return m},n};var g=null,h=!1,i=null,j=null}var b="sha512";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"prng");var c="undefined"!=typeof process&&process.versions&&process.versions.node,d=null;b.disableNativeCode||!c||process.versions["node-webkit"]||(d=require("crypto"));var e=b.prng=b.prng||{};e.create=function(c){function e(a){if(i.pools[0].messageLength>=32)return g(),a();var b=32-i.pools[0].messageLength<<5;i.seedFile(b,function(b,c){return b?a(b):(i.collect(c),g(),void a())})}function f(){if(i.pools[0].messageLength>=32)return g();var a=32-i.pools[0].messageLength<<5;i.collect(i.seedFileSync(a)),g()}function g(){var a=i.plugin.md.create();a.update(i.pools[0].digest().getBytes()),i.pools[0].start();for(var b=1,c=1;32>c;++c)b=31===b?2147483648:b<<2,b%i.reseeds===0&&(a.update(i.pools[c].digest().getBytes()),i.pools[c].start());var d=a.digest().getBytes();a.start(),a.update(d);var e=a.digest().getBytes();i.key=i.plugin.formatKey(d),i.seed=i.plugin.formatSeed(e),i.reseeds=4294967295===i.reseeds?0:i.reseeds+1,i.generated=0}function h(a){var c=null;if("undefined"!=typeof window){var d=window.crypto||window.msCrypto;d&&d.getRandomValues&&(c=function(a){return d.getRandomValues(a)})}var e=b.util.createBuffer();if(c)for(;e.length()<a;){var f=Math.max(1,Math.min(a-e.length(),65536)/4),g=new Uint32Array(Math.floor(f));try{c(g);for(var h=0;h<g.length;++h)e.putInt32(g[h])}catch(i){if(!("undefined"!=typeof QuotaExceededError&&i instanceof QuotaExceededError))throw i}}if(e.length()<a)for(var j,k,l,m=Math.floor(65536*Math.random());e.length()<a;){k=16807*(65535&m),j=16807*(m>>16),k+=(32767&j)<<16,k+=j>>15,k=(2147483647&k)+(k>>31),m=4294967295&k;for(var h=0;3>h;++h)l=m>>>(h<<3),l^=Math.floor(256*Math.random()),e.putByte(String.fromCharCode(255&l))}return e.getBytes(a)}for(var i={plugin:c,key:null,seed:null,time:null,reseeds:0,generated:0},j=c.md,k=new Array(32),l=0;32>l;++l)k[l]=j.create();return i.pools=k,i.pool=0,i.generate=function(c,d){function f(a){if(a)return d(a);if(l.length()>=c)return d(null,l.getBytes(c));if(i.generated>1048575&&(i.key=null),null===i.key)return b.util.nextTick(function(){e(f)});var m=g(i.key,i.seed);i.generated+=m.length,l.putBytes(m),i.key=j(g(i.key,h(i.seed))),i.seed=k(g(i.key,i.seed)),b.util.setImmediate(f)}if(a(),!d)return i.generateSync(c);var g=i.plugin.cipher,h=i.plugin.increment,j=i.plugin.formatKey,k=i.plugin.formatSeed,l=b.util.createBuffer();i.key=null,f()},i.generateSync=function(a){var c=i.plugin.cipher,d=i.plugin.increment,e=i.plugin.formatKey,g=i.plugin.formatSeed;i.key=null;for(var h=b.util.createBuffer();h.length()<a;){i.generated>1048575&&(i.key=null),null===i.key&&f();var j=c(i.key,i.seed);i.generated+=j.length,h.putBytes(j),i.key=e(c(i.key,d(i.seed))),i.seed=g(c(i.key,i.seed))}return h.getBytes(a)},d?(i.seedFile=function(a,b){d.randomBytes(a,function(a,c){return a?b(a):void b(null,c.toString())})},i.seedFileSync=function(a){return d.randomBytes(a).toString()}):(i.seedFile=function(a,b){try{b(null,h(a))}catch(c){b(c)}},i.seedFileSync=h),i.collect=function(a){for(var b=a.length,c=0;b>c;++c)i.pools[i.pool].update(a.substr(c,1)),i.pool=31===i.pool?0:i.pool+1},i.collectInt=function(a,b){for(var c="",d=0;b>d;d+=8)c+=String.fromCharCode(a>>d&255);i.collect(c)},i.registerWorker=function(a){if(a===self)i.seedFile=function(a,b){function c(a){var d=a.data;d._ds&&d._ds.prng&&(self.removeEventListener("message",c),b(d._ds.prng.err,d._ds.prng.bytes))}self.addEventListener("message",c),self.postMessage({_ds:{prng:{needed:a}}})};else{var b=function(b){var c=b.data;c._ds&&c._ds.prng&&i.seedFile(c._ds.prng.needed,function(b,c){a.postMessage({_ds:{prng:{err:b,bytes:c}}})})};a.addEventListener("message",b)}},i}}var b="prng";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){
var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./md","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){return void 0==b&&"function"==typeof dreamsecurity.chkIntegrity?void dreamsecurity.chkIntegrity(arguments.callee,"random"):void(b.random&&b.random.getBytes||!function(c){function d(){var c=b.prng.create(e);return c.getBytes=function(a,b){return c.generate(a,b)},c.getBytesSync=function(b){return a(),c.generate(b)},c}var e={},f=new Array(4),g=b.util.createBuffer();e.formatKey=function(a){var c=b.util.createBuffer(a);return a=new Array(4),a[0]=c.getInt32(),a[1]=c.getInt32(),a[2]=c.getInt32(),a[3]=c.getInt32(),b.aes._expandKey(a,!1)},e.formatSeed=function(a){var c=b.util.createBuffer(a);return a=new Array(4),a[0]=c.getInt32(),a[1]=c.getInt32(),a[2]=c.getInt32(),a[3]=c.getInt32(),a},e.cipher=function(a,c){return b.aes._updateBlock(a,c,f,!1),g.putInt32(f[0]),g.putInt32(f[1]),g.putInt32(f[2]),g.putInt32(f[3]),g.getBytes()},e.increment=function(a){return++a[3],a},e.md=b.md.sha256;var h=d(),i="undefined"!=typeof process&&process.versions&&process.versions.node,j=null;if("undefined"!=typeof window){var k=window.crypto||window.msCrypto;k&&k.getRandomValues&&(j=function(a){return k.getRandomValues(a)})}if(b.disableNativeCode||!i&&!j){if("undefined"==typeof window||void 0===window.document,h.collectInt(+new Date,32),"undefined"!=typeof navigator){var l="";for(var m in navigator)try{"string"==typeof navigator[m]&&(l+=navigator[m])}catch(n){}h.collect(l),l=null}c&&(c().mousemove(function(a){h.collectInt(a.clientX,16),h.collectInt(a.clientY,16)}),c().keypress(function(a){h.collectInt(a.charCode,8)}))}if(b.random)for(var m in h)b.random[m]=h[m];else b.random=h;b.random.createInstance=d}("undefined"!=typeof jQuery?jQuery:null))}var b="random";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./md","./prng","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a,c,d){var e=b.util.createBuffer(),f=Math.ceil(c.n.bitLength()/8);if(a.length>f-11){var g=new Error("Message is too long for PKCS#1 v1.5 padding.");throw g.length=a.length,g.max=f-11,g}e.putByte(0),e.putByte(d);var h,i=f-3-a.length;if(0===d||1===d){h=0===d?0:255;for(var j=0;i>j;++j)e.putByte(h)}else for(;i>0;){for(var k=0,l=b.random.getBytes(i),j=0;i>j;++j)h=l.charCodeAt(j),0===h?++k:e.putByte(h);i=k}return e.putByte(0),e.putBytes(a),e}function d(a,c,d,e){var f=Math.ceil(c.n.bitLength()/8),g=b.util.createBuffer(a),h=g.getByte(),i=g.getByte();if(0!==h||d&&0!==i&&1!==i||!d&&2!=i||d&&0===i&&"undefined"==typeof e)throw new Error("Encryption block is invalid.");var j=0;if(0===i){j=f-3-e;for(var k=0;j>k;++k)if(0!==g.getByte())throw new Error("Encryption block is invalid.")}else if(1===i)for(j=0;g.length()>1;){if(255!==g.getByte()){--g.read;break}++j}else if(2===i)for(j=0;g.length()>1;){if(0===g.getByte()){--g.read;break}++j}var l=g.getByte();if(0!==l||j!==f-3-g.length())throw new Error("Encryption block is invalid.");return g.getBytes()}function e(a,c,d){function e(){f(a.pBits,function(b,c){return b?d(b):(a.p=c,null!==a.q?g(b,a.q):void f(a.qBits,g))})}function f(a,c){b.prime.generateProbablePrime(a,i,c)}function g(b,c){if(b)return d(b);if(a.q=c,a.p.compareTo(a.q)<0){var i=a.p;a.p=a.q,a.q=i}if(0!==a.p.subtract(h.ONE).gcd(a.e).compareTo(h.ONE))return a.p=null,void e();if(0!==a.q.subtract(h.ONE).gcd(a.e).compareTo(h.ONE))return a.q=null,void f(a.qBits,g);if(a.p1=a.p.subtract(h.ONE),a.q1=a.q.subtract(h.ONE),a.phi=a.p1.multiply(a.q1),0!==a.phi.gcd(a.e).compareTo(h.ONE))return a.p=a.q=null,void e();if(a.n=a.p.multiply(a.q),a.n.bitLength()!==a.bits)return a.q=null,void f(a.qBits,g);var k=a.e.modInverse(a.phi);a.keys={privateKey:j.rsa.setPrivateKey(a.n,a.e,k,a.p,a.q,k.mod(a.p1),k.mod(a.q1),a.q.modInverse(a.p)),publicKey:j.rsa.setPublicKey(a.n,a.e)},d(null,a.keys)}"function"==typeof c&&(d=c,c={}),c=c||{};var i={algorithm:{name:c.algorithm||"PRIMEINC",options:{workers:c.workers||2,workLoad:c.workLoad||100,workerScript:c.workerScript}}};"prng"in c&&(i.prng=c.prng),e()}function f(a){var c=a.toString(16);return c[0]>="8"&&(c="00"+c),b.util.hexToBytes(c)}function g(a){return 100>=a?27:150>=a?18:200>=a?15:250>=a?12:300>=a?9:350>=a?8:400>=a?7:500>=a?6:600>=a?5:800>=a?4:1250>=a?3:2}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"rsa");if("undefined"==typeof h)var h=b.jsbn.BigInteger;var i=b.asn1;b.pki=b.pki||{},b.pki.rsa=b.rsa=b.rsa||{};var j=b.pki,k=[6,4,2,4,2,4,6,2],l={name:"RSAPrivateKey",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},m={name:"RSAPublicKey",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},n=function(a){var b;if(!(a.algorithm in j.oids)){var c=new Error("Unknown message digest algorithm.");throw c.algorithm=a.algorithm,c}b=j.oids[a.algorithm];var d=i.oidToDer(b).getBytes(),e=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),f=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);f.value.push(i.create(i.Class.UNIVERSAL,i.Type.OID,!1,d)),f.value.push(i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,""));var g=i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,a.digest().getBytes());return e.value.push(f),e.value.push(g),i.toDer(e).getBytes()},o=function(a,c,d){if(d)return a.modPow(c.e,c.n);if(!c.p||!c.q)return a.modPow(c.d,c.n);c.dP||(c.dP=c.d.mod(c.p.subtract(h.ONE))),c.dQ||(c.dQ=c.d.mod(c.q.subtract(h.ONE))),c.qInv||(c.qInv=c.q.modInverse(c.p));var e;do e=new h(b.util.bytesToHex(b.random.getBytes(c.n.bitLength()/8)),16).mod(c.n);while(e.equals(h.ZERO));a=a.multiply(e.modPow(c.e,c.n)).mod(c.n);for(var f=a.mod(c.p).modPow(c.dP,c.p),g=a.mod(c.q).modPow(c.dQ,c.q);f.compareTo(g)<0;)f=f.add(c.p);var i=f.subtract(g).multiply(c.qInv).mod(c.p).multiply(c.q).add(g);return i=i.multiply(e.modInverse(c.n)).mod(c.n)};j.rsa.encrypt=function(d,e,f){a();var g,i=f,j=Math.ceil(e.n.bitLength()/8);f!==!1&&f!==!0?(i=2===f,g=c(d,e,f)):(g=b.util.createBuffer(),g.putBytes(d));for(var k=new h(g.toHex(),16),l=o(k,e,i),m=l.toString(16),n=b.util.createBuffer(),p=j-Math.ceil(m.length/2);p>0;)n.putByte(0),--p;return n.putBytes(b.util.hexToBytes(m)),n.getBytes()},j.rsa.decrypt=function(c,e,f,g){!b.gf&&b.vi.filter&&a();var i=Math.ceil(e.n.bitLength()/8);if(c.length!==i){var j=new Error("Encrypted message length is invalid.");throw j.length=c.length,j.expected=i,j}var k=new h(b.util.createBuffer(c).toHex(),16);if(k.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var l=o(k,e,f),m=l.toString(16),n=b.util.createBuffer(),p=i-Math.ceil(m.length/2);p>0;)n.putByte(0),--p;return n.putBytes(b.util.hexToBytes(m)),g!==!1?d(n.getBytes(),e,f):n.getBytes()},j.rsa.createKeyPairGenerationState=function(a,c,d){"string"==typeof a&&(a=parseInt(a,10)),a=a||2048,d=d||{};var e,f=d.prng||b.random,g={nextBytes:function(a){for(var b=f.getBytesSync(a.length),c=0;c<a.length;++c)a[c]=b.charCodeAt(c)}},i=d.algorithm||"PRIMEINC";if("PRIMEINC"!==i)throw new Error("Invalid key generation algorithm: "+i);return e={algorithm:i,state:0,bits:a,rng:g,eInt:c||65537,e:new h(null),p:null,q:null,qBits:a>>1,pBits:a-(a>>1),pqState:0,num:null,keys:null},e.e.fromInt(e.eInt),e},j.rsa.stepKeyPairGenerationState=function(a,b){"algorithm"in a||(a.algorithm="PRIMEINC");var c=new h(null);c.fromInt(30);for(var d,e=0,f=function(a,b){return a|b},i=+new Date,l=0;null===a.keys&&(0>=b||b>l);){if(0===a.state){var m=null===a.p?a.pBits:a.qBits,n=m-1;0===a.pqState?(a.num=new h(m,a.rng),a.num.testBit(n)||a.num.bitwiseTo(h.ONE.shiftLeft(n),f,a.num),a.num.dAddOffset(31-a.num.mod(c).byteValue(),0),e=0,++a.pqState):1===a.pqState?a.num.bitLength()>m?a.pqState=0:a.num.isProbablePrime(g(a.num.bitLength()))?++a.pqState:a.num.dAddOffset(k[e++%8],0):2===a.pqState?a.pqState=0===a.num.subtract(h.ONE).gcd(a.e).compareTo(h.ONE)?3:0:3===a.pqState&&(a.pqState=0,null===a.p?a.p=a.num:a.q=a.num,null!==a.p&&null!==a.q&&++a.state,a.num=null)}else if(1===a.state)a.p.compareTo(a.q)<0&&(a.num=a.p,a.p=a.q,a.q=a.num),++a.state;else if(2===a.state)a.p1=a.p.subtract(h.ONE),a.q1=a.q.subtract(h.ONE),a.phi=a.p1.multiply(a.q1),++a.state;else if(3===a.state)0===a.phi.gcd(a.e).compareTo(h.ONE)?++a.state:(a.p=null,a.q=null,a.state=0);else if(4===a.state)a.n=a.p.multiply(a.q),a.n.bitLength()===a.bits?++a.state:(a.q=null,a.state=0);else if(5===a.state){var o=a.e.modInverse(a.phi);a.keys={privateKey:j.rsa.setPrivateKey(a.n,a.e,o,a.p,a.q,o.mod(a.p1),o.mod(a.q1),a.q.modInverse(a.p)),publicKey:j.rsa.setPublicKey(a.n,a.e)}}d=+new Date,l+=d-i,i=d}return null!==a.keys},j.rsa.generateKeyPair=function(a,b,c,d){1===arguments.length?"object"==typeof a?(c=a,a=void 0):"function"==typeof a&&(d=a,a=void 0):2===arguments.length?"number"==typeof a?"function"==typeof b?(d=b,b=void 0):"number"!=typeof b&&(c=b,b=void 0):(c=a,d=b,a=void 0,b=void 0):3===arguments.length&&("number"==typeof b?"function"==typeof c&&(d=c,c=void 0):(d=c,c=b,b=void 0)),c=c||{},void 0===a&&(a=c.bits||2048),void 0===b&&(b=c.e||65537);var f=j.rsa.createKeyPairGenerationState(a,b,c);return d?void e(f,c,d):(j.rsa.stepKeyPairGenerationState(f,0),f.keys)},j.setRsaPublicKey=j.rsa.setPublicKey=function(a,e){var f={n:a,e:e};return f.encrypt=function(a,d,e){if("string"==typeof d?d=d.toUpperCase():void 0===d&&(d="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===d)d={encode:function(a,b,d){return c(a,b,2).getBytes()}};else if("RSA-OAEP"===d||"RSAES-OAEP"===d)d={encode:function(a,c){return b.pkcs1.encode_rsa_oaep(c,a,e)}};else if(-1!==b.util.arrayIndexOf(["RAW","NONE","NULL",null],d))d={encode:function(a){return a}};else if("string"==typeof d)throw new Error('Unsupported encryption scheme: "'+d+'".');var g=d.encode(a,f,!0);return j.rsa.encrypt(g,f,!0)},f.verify=function(a,b,c){"string"==typeof c?c=c.toUpperCase():void 0===c&&(c="RSASSA-PKCS1-V1_5"),"RSASSA-PKCS1-V1_5"===c?c={verify:function(a,b){b=d(b,f,!0);var c=i.fromDer(b);return a===c.value[1].value}}:"NONE"!==c&&"NULL"!==c&&null!==c||(c={verify:function(a,b){return b=d(b,f,!0),a===b}});var e=j.rsa.decrypt(b,f,!0,!1);return c.verify(a,e,f.n.bitLength())},f},j.setRsaPrivateKey=j.rsa.setPrivateKey=function(a,c,e,f,g,h,i,k){var l={n:a,e:c,d:e,p:f,q:g,dP:h,dQ:i,qInv:k};return l.decrypt=function(a,c,e){"string"==typeof c?c=c.toUpperCase():void 0===c&&(c="RSAES-PKCS1-V1_5");var f=j.rsa.decrypt(a,l,!1,!1);if("RSAES-PKCS1-V1_5"===c)c={decode:d};else if("RSA-OAEP"===c||"RSAES-OAEP"===c)c={decode:function(a,c){return b.pkcs1.decode_rsa_oaep(c,a,e)}};else{if(-1===b.util.arrayIndexOf(["RAW","NONE","NULL",null],c))throw new Error('Unsupported encryption scheme: "'+c+'".');c={decode:function(a){return a}}}return c.decode(f,l,!1)},l.sign=function(a,b){var c=!1;"string"==typeof b&&(b=b.toUpperCase()),void 0===b||"RSASSA-PKCS1-V1_5"===b?(b={encode:n},c=1):"NONE"!==b&&"NULL"!==b&&null!==b||(b={encode:function(){return a}},c=1);var d=b.encode(a,l.n.bitLength());return j.rsa.encrypt(d,l,c)},l},j.wrapRsaPrivateKey=function(a){return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(0).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(j.oids.rsaEncryption).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")]),i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,i.toDer(a).getBytes())])},j.rsa.privateKeyFromAsn1=function(a){var c={},d=[];if(!i.validate(a,l,c,d)){var e=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw e.errors=d,e.type=b.err.unsupported,e}var f,g,k,m,n,o,p,q;return f=b.util.createBuffer(c.privateKeyModulus).toHex(),g=b.util.createBuffer(c.privateKeyPublicExponent).toHex(),k=b.util.createBuffer(c.privateKeyPrivateExponent).toHex(),m=b.util.createBuffer(c.privateKeyPrime1).toHex(),n=b.util.createBuffer(c.privateKeyPrime2).toHex(),o=b.util.createBuffer(c.privateKeyExponent1).toHex(),p=b.util.createBuffer(c.privateKeyExponent2).toHex(),q=b.util.createBuffer(c.privateKeyCoefficient).toHex(),j.setRsaPrivateKey(new h(f,16),new h(g,16),new h(k,16),new h(m,16),new h(n,16),new h(o,16),new h(p,16),new h(q,16))},j.privateKeyToAsn1=j.privateKeyToRSAPrivateKey=function(a){return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(0).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,f(a.n)),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,f(a.e)),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,f(a.d)),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,f(a.p)),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,f(a.q)),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,f(a.dP)),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,f(a.dQ)),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,f(a.qInv))])},j.rsa.publicKeyFromAsn1=function(a){var c={},d=[];if(!i.validate(a,m,c,d)){var e=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw e.errors=d,e}var f=b.util.createBuffer(c.publicKeyModulus).toHex(),g=b.util.createBuffer(c.publicKeyExponent).toHex();return j.setRsaPublicKey(new h(f,16),new h(g,16))},j.publicKeyToRSAPublicKey=function(a){return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,f(a.n)),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,f(a.e))])}}var b="rsa";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./jsbn","./oids","./pkcs1","./prime","./random","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a){var c=a.toString(16);return c[0]>="8"&&(c="00"+c),b.util.hexToBytes(c)}function d(a,c,d){function e(){g(a.pBits,function(b,c){return b?d(b):(a.p=c,null!==a.q?h(b,a.q):void g(a.qBits,h))})}function g(a,c){b.prime.generateProbablePrime(a,i,c)}function h(b,c){if(b)return d(b);if(a.q=c,a.p.compareTo(a.q)<0){var i=a.p;a.p=a.q,a.q=i}if(0!==a.p.subtract(f.ONE).gcd(a.e).compareTo(f.ONE))return a.p=null,void e();if(0!==a.q.subtract(f.ONE).gcd(a.e).compareTo(f.ONE))return a.q=null,void g(a.qBits,h);if(a.p1=a.p.subtract(f.ONE),a.q1=a.q.subtract(f.ONE),a.phi=a.p1.multiply(a.q1),0!==a.phi.gcd(a.e).compareTo(f.ONE))return a.p=a.q=null,void e();if(a.n=a.p.multiply(a.q),a.n.bitLength()!==a.bits)return a.q=null,void g(a.qBits,h);var k=a.e.modInverse(a.phi);a.keys={privateKey:j.kcdsa.setPrivateKey(a.n,a.e,k,a.p,a.q,k.mod(a.p1),k.mod(a.q1),a.q.modInverse(a.p)),publicKey:j.kcdsa.setPublicKey(a.n,a.e)},d(null,a.keys)}"function"==typeof c&&(d=c,c={}),c=c||{};var i={algorithm:{name:c.algorithm||"PRIMEINC",options:{workers:c.workers||2,workLoad:c.workLoad||100,workerScript:c.workerScript}}};"prng"in c&&(i.prng=c.prng),e()}function c(a){var c=a.toString(16);return c[0]>="8"&&(c="00"+c),b.util.hexToBytes(c)}function e(a){return 100>=a?27:150>=a?18:200>=a?15:250>=a?12:300>=a?9:350>=a?8:400>=a?7:500>=a?6:600>=a?5:800>=a?4:1250>=a?3:2}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"kcdsa");if("undefined"==typeof f)var f=b.jsbn.BigInteger;var h=b.asn1;b.pki=b.pki||{},b.pki.kcdsa=b.kcdsa=b.kcdsa||{};var j=b.pki,k=[6,4,2,4,2,4,6,2],l={name:"KCDSAPrivateKey.exponent",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"privateKeyExponent"},m={name:"KCDSAPublicKey.public",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"publicKey"},n={name:"KCDSASignature",tagClass:h.Class.UNIVERSAL,type:h.Type.SEQUENCE,constructed:!0,value:[{name:"KCDSASignature.R",tagClass:h.Class.UNIVERSAL,type:h.Type.BITSTRING,constructed:!1,capture:"r"},{name:"KCDSASignature.S",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"s"}]},o={name:"KCDSAParameters",tagClass:h.Class.UNIVERSAL,type:h.Type.SEQUENCE,constructed:!0,value:[{name:"P",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"p"},{name:"Q",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"q"},{name:"G",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"g"}]};j.kcdsa.createKeyPairGenerationState=function(a,c,d){"string"==typeof a&&(a=parseInt(a,10)),a=a||2048,d=d||{};var e,g=d.prng||b.random,h={nextBytes:function(a){for(var b=g.getBytesSync(a.length),c=0;c<a.length;++c)a[c]=b.charCodeAt(c)}},i=d.algorithm||"PRIMEINC";if("PRIMEINC"!==i)throw new Error("Invalid key generation algorithm: "+i);return e={algorithm:i,state:0,bits:a,rng:h,eInt:c||65537,e:new f(null),p:null,q:null,qBits:a>>1,pBits:a-(a>>1),pqState:0,num:null,keys:null},e.e.fromInt(e.eInt),e},j.kcdsa.stepKeyPairGenerationState=function(a,b){"algorithm"in a||(a.algorithm="PRIMEINC");var c=new f(null);c.fromInt(30);for(var d,g=0,h=function(a,b){return a|b},i=+new Date,l=0;null===a.keys&&(0>=b||b>l);){if(0===a.state){var m=null===a.p?a.pBits:a.qBits,n=m-1;0===a.pqState?(a.num=new f(m,a.rng),a.num.testBit(n)||a.num.bitwiseTo(f.ONE.shiftLeft(n),h,a.num),a.num.dAddOffset(31-a.num.mod(c).byteValue(),0),g=0,++a.pqState):1===a.pqState?a.num.bitLength()>m?a.pqState=0:a.num.isProbablePrime(e(a.num.bitLength()))?++a.pqState:a.num.dAddOffset(k[g++%8],0):2===a.pqState?a.pqState=0===a.num.subtract(f.ONE).gcd(a.e).compareTo(f.ONE)?3:0:3===a.pqState&&(a.pqState=0,null===a.p?a.p=a.num:a.q=a.num,null!==a.p&&null!==a.q&&++a.state,a.num=null)}else if(1===a.state)a.p.compareTo(a.q)<0&&(a.num=a.p,a.p=a.q,a.q=a.num),++a.state;else if(2===a.state)a.p1=a.p.subtract(f.ONE),a.q1=a.q.subtract(f.ONE),a.phi=a.p1.multiply(a.q1),++a.state;else if(3===a.state)0===a.phi.gcd(a.e).compareTo(f.ONE)?++a.state:(a.p=null,a.q=null,a.state=0);else if(4===a.state)a.n=a.p.multiply(a.q),a.n.bitLength()===a.bits?++a.state:(a.q=null,a.state=0);else if(5===a.state){var o=a.e.modInverse(a.phi);a.keys={privateKey:j.kcdsa.setPrivateKey(a.n,a.e,o,a.p,a.q,o.mod(a.p1),o.mod(a.q1),a.q.modInverse(a.p)),publicKey:j.kcdsa.setPublicKey(a.n,a.e)}}d=+new Date,l+=d-i,i=d}return null!==a.keys},j.kcdsa.generateKeyPair=function(a,b,c,e){1===arguments.length?"object"==typeof a?(c=a,a=void 0):"function"==typeof a&&(e=a,a=void 0):2===arguments.length?"number"==typeof a?"function"==typeof b?(e=b,b=void 0):"number"!=typeof b&&(c=b,b=void 0):(c=a,e=b,a=void 0,b=void 0):3===arguments.length&&("number"==typeof b?"function"==typeof c&&(e=c,c=void 0):(e=c,c=b,b=void 0)),c=c||{},void 0===a&&(a=c.bits||2048),void 0===b&&(b=c.e||65537);var f=j.kcdsa.createKeyPairGenerationState(a,b,c);return e?void d(f,c,e):(j.kcdsa.stepKeyPairGenerationState(f,0),f.keys)},j.setKcdsaPublicKey=j.kcdsa.setPublicKey=function(d,e,g,j){var k={p:d,q:e,g:g,y:j};return k.verify=function(d,e,g,j){a();var l=b.util.createBuffer(c(k.y)).toHex();l=l.substr(l.length-128,128),l=b.util.hexToBytes(l);var m=b.md.algorithms[e].create();m.update(l),m.update(d);var o=h.fromDer(g),p={},q=[];if(!h.validate(o,n,p,q)){var r=new Error("Cannot read KCDSA Signature. ");throw r.errors=q,r}var s=b.util.createBuffer(p.r).toHex(),t=b.util.createBuffer(p.s).toHex(),u=new f(s,16),v=new f(t,16),w=m.digest(),x=new f(w.toHex(),16),y=u.xor(x);y=y.mod(k.q);var z=k.y.modPow(v,k.p),A=k.g.modPow(y,k.p),B=z.multiply(A).mod(k.p),C=k.p.toByteArray().length;C%128==1&&(C-=1);var z=b.util.createBuffer(c(B)).toHex();if(z.length>2*C)z=z.substr(z.length-2*C,2*C);else if(z.length<2*C){var D="";for(i=0;i<2*C-z.length;i++)D+="0";z=D+z}z=b.util.hexToBytes(z);var E=b.md.algorithms[e].create();E.update(z);var F=E.digest();return u.equals(new f(F.toHex(),16))},k},j.setKcdsaPrivateKey=j.kcdsa.setPrivateKey=function(d,e,g,j,k){var l={p:d,q:e,g:g,x:j,y:k};return l.sign=function(d,e,g){a();var j=b.util.createBuffer(c(g)).toHex();j=j.substr(j.length-128,128),j=b.util.hexToBytes(j);var k=b.md.algorithms[e].create();k.update(j),k.update(d);var m=b.random.getBytesSync(k.digestLength),n=new f(b.util.createBuffer(m).toHex(),16);n=n.mod(l.q);var o=l.g.modPow(n,l.p),p=l.p.toByteArray().length;p%128==1&&(p-=1);var q=b.util.createBuffer(c(o)).toHex();if(q.length>2*p)q=q.substr(q.length-2*p,2*p);else if(q.length<2*p){var r="";for(i=0;i<2*p-q.length;i++)r+="0";q=r+q}q=b.util.hexToBytes(q);var s=b.md.algorithms[e].create();s.update(q);var t=s.digest(),u=new f(t.toHex(),16),v=k.digest(),w=new f(v.toHex(),16),x=u.xor(w);x=x.mod(l.q);var y=n.subtract(x);0!=y.s&&y.add(l.q);var z=l.x.multiply(y);z=z.mod(l.q);var A=h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[]),B=h.create(h.Class.UNIVERSAL,h.Type.BITSTRING,!1,String.fromCharCode(0)+t.getBytes()),C=h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,c(z));return A.value.push(B),A.value.push(C),h.toDer(A).getBytes()},l},j.kcdsa.domainParamFromAsn1=function(a){var c={},d=[];if(!h.validate(a,o,c,d)){var e=new Error("Cannot read kcdsaParam.");throw e.errors=d,e.type=b.err.process,e}return p=b.util.createBuffer(c.p).toHex(),q=b.util.createBuffer(c.q).toHex(),g=b.util.createBuffer(c.g).toHex(),{p:new f(p,16),q:new f(q,16),g:new f(g,16)}},j.kcdsa.privateKeyFromAsn1=function(a,c){var d,e={},g=[];if(!h.validate(a,l,e,g)){var i=new Error("Cannot read kcdsaPrivateKey.");throw i.errors=g,i.type=b.err.process,i}d=b.util.createBuffer(e.privateKeyExponent).toHex();var c=j.kcdsa.domainParamFromAsn1(c);return j.setKcdsaPrivateKey(c.p,c.q,c.g,new f(d,16))},j.privateKeyToKCDSAPrivateKey=function(a){return h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,c(a.x))},j.toKCDSAParam=function(a){return h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,c(a.p)),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,c(a.q)),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,c(a.g))])},j.kcdsa.publicKeyFromAsn1=function(a,c){var d,e={},g=[];if(!h.validate(a,m,e,g)){var i=new Error("Cannot read kcdsaPublicKey.");throw i.errors=g,i.type=b.err.process,i}d=b.util.createBuffer(e.publicKey).toHex();var c=j.kcdsa.domainParamFromAsn1(c);return j.setKcdsaPublicKey(c.p,c.q,c.g,new f(d,16))},j.publicKeyToKCDSAPublicKey=function(a){return h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,c(a.y))])}}var b="kcdsa";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./jsbn","./oids","./pkcs1","./prime","./random","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(a){a.mgf=a.mgf||{},a.mgf.mgf1=a.mgf1}var b="mgf";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./mgf1"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){if(void 0==b)return void("function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"mgf1"));b.mgf=b.mgf||{};var c=b.mgf.mgf1=b.mgf1=b.mgf1||{};c.create=function(c){var d={generate:function(d,e){a();for(var f=new b.util.ByteBuffer,g=Math.ceil(e/c.digestLength),h=0;g>h;h++){var i=new b.util.ByteBuffer;i.putInt32(h),c.start(),c.update(d+i.getBytes()),f.putBuffer(c.digest())}return f.truncate(f.length()-e),f.getBytes()},name:"mgf1",md:c.algorithm};return d}}var b="mgf1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"pss");var c=b.pss=b.pss||{};c.create=function(c){a(),3===arguments.length&&(c={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var d=c.md,e=c.mgf,f=d.digestLength,g=c.salt||null;"string"==typeof g&&(g=b.util.createBuffer(g));var h;if("saltLength"in c)h=c.saltLength;else{if(null===g)throw new Error("Salt length not specified or specific salt not given.");h=g.length()}if(null!==g&&g.length()!==h)throw new Error("Given salt length does not match length of given salt.");var i=c.prng||b.random,j={};return j.md=d.algorithm,j.mgf=e.name+"-"+e.md,j.saltLength=h,j.encode=function(c,j){a();var k,l=j-1,m=Math.ceil(l/8),n=c.digest().getBytes();if(f+h+2>m)throw new Error("Message is too long to encrypt.");var o;o=null===g?i.getBytesSync(h):g.bytes();var p=new b.util.ByteBuffer;p.fillWithByte(0,8),p.putBytes(n),p.putBytes(o),d.start(),d.update(p.getBytes());var q=d.digest().getBytes(),r=new b.util.ByteBuffer;r.fillWithByte(0,m-h-f-2),r.putByte(1),r.putBytes(o);var s=r.getBytes(),t=m-f-1,u=e.generate(q,t),v="";for(k=0;t>k;k++)v+=String.fromCharCode(s.charCodeAt(k)^u.charCodeAt(k));var w=65280>>8*m-l&255;return v=String.fromCharCode(v.charCodeAt(0)&~w)+v.substr(1),v+q+String.fromCharCode(188)},j.verify=function(c,g,i){a();var j,k=i-1,l=Math.ceil(k/8);if(g=g.substr(g.length-l,l),f+h+2>l)throw new Error("Inconsistent parameters to PSS signature verification.");if(188!==g.charCodeAt(l-1))throw new Error("Encoded message does not end in 0xBC.");var m=l-f-1,n=g.substr(0,m),o=g.substr(m,f),p=65280>>8*l-k&255;if(0!==(n.charCodeAt(0)&p))throw new Error("Bits beyond keysize not zero as expected.");var q=e.generate(o,m),r="";for(j=0;m>j;j++)r+=String.fromCharCode(n.charCodeAt(j)^q.charCodeAt(j));r=String.fromCharCode(r.charCodeAt(0)&~p)+r.substr(1);var s=l-f-h-2;for(j=0;s>j;j++)if(0!==r.charCodeAt(j))throw new Error("Leftmost octets not zero as expected");if(1!==r.charCodeAt(s))throw new Error("Inconsistent PSS signature, 0x01 marker not found");var t=r.substr(r.length-h,h),u=new b.util.ByteBuffer;u.fillWithByte(0,8),u.putBytes(c),u.putBytes(t),d.start(),d.update(u.getBytes());var v=d.digest().getBytes();return o===v},j}}var b="pss";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./random","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a,c,d){d||(d=b.md.sha1.create());for(var e="",f=Math.ceil(c/d.digestLength),g=0;f>g;++g){var h=String.fromCharCode(g>>24&255,g>>16&255,g>>8&255,255&g);d.start(),d.update(a+h),e+=d.digest().getBytes()}return e.substring(0,c)}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"pkcs1");var d=b.pkcs1=b.pkcs1||{},e=b.asn1,f=b.pkcs1.asn1=b.pkcs1.asn1||{};f.rsaoaepParamValidator={name:"RSAES_OAEP_params",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RSAES_OAEP_params.ctx0",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"RSAES_OAEP_params.hashAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,capture:"hashAlgorithm"}]},{name:"RSAES_OAEP_params.ctx1",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"RSAES_OAEP_params.maskGenAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RSAES_OAEP_params.maskGenAlgorithm.mgf",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,
capture:"mgf"},{name:"RSAES_OAEP_params.maskGenAlgorithm.param",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,capture:"mgfHashAlg"}]}]}]},d.encode_rsa_oaep=function(d,e,f){a();var g,h,i,j;"string"==typeof f?(g=f,h=arguments[3]||void 0,i=arguments[4]||void 0):f&&(g=f.label||void 0,h=f.seed||void 0,i=f.md||void 0,f.mgf1&&f.mgf1.md&&(j=f.mgf1.md)),i?i.start():i=b.md.sha1.create(),j||(j=i);var k=Math.ceil(d.n.bitLength()/8),l=k-2*i.digestLength-2;if(e.length>l){var m=new Error("RSAES-OAEP input message length is too long.");throw m.length=e.length,m.maxLength=l,m}g||(g=""),i.update(g,"raw");for(var n=i.digest(),o="",p=l-e.length,q=0;p>q;q++)o+="\x00";var r=n.getBytes()+o+b.util.hexToBytes("01")+e;if(h){if(h.length!==i.digestLength){var m=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw m.seedLength=h.length,m.digestLength=i.digestLength,m}}else h=b.random.getBytes(i.digestLength);var s=c(h,k-i.digestLength-1,j),t=b.util.xorBytes(r,s,r.length),u=c(t,i.digestLength,j),v=b.util.xorBytes(h,u,h.length);return"\x00"+v+t},d.decode_rsa_oaep=function(d,e,f){a();var g,h,i;"string"==typeof f?(g=f,h=arguments[3]||void 0):f&&(g=f.label||void 0,h=f.md||void 0,f.mgf1&&f.mgf1.md&&(i=f.mgf1.md));var j=Math.ceil(d.n.bitLength()/8);if(e.length!==j){var k=new Error("RSAES-OAEP encoded message length is invalid.");throw k.length=e.length,k.expectedLength=j,k}if(void 0===h?h=b.md.sha1.create():h.start(),i||(i=h),j<2*h.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");g||(g=""),h.update(g,"raw");for(var l=h.digest().getBytes(),m=e.charAt(0),n=e.substring(1,h.digestLength+1),o=e.substring(1+h.digestLength),p=c(o,h.digestLength,i),q=b.util.xorBytes(n,p,n.length),r=c(q,j-h.digestLength-1,i),s=b.util.xorBytes(o,r,o.length),t=s.substring(0,h.digestLength),k="\x00"!==m,u=0;u<h.digestLength;++u)k|=l.charAt(u)!==t.charAt(u);for(var v=1,w=h.digestLength,x=h.digestLength;x<s.length;x++){var y=s.charCodeAt(x),z=1&y^1,A=v?65534:0;k|=y&A,v&=z,w+=v}if(k||1!==s.charCodeAt(w))throw new Error("Invalid RSAES-OAEP padding.");return s.substring(w+1)}}var b="pkcs1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util","./random","./sha1"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a,c){var d=function(){return new b.aes.Algorithm(a,c)};b.cipher.registerAlgorithm(a,d)}function d(){m=!0,j=[0,1,2,4,8,16,32,64,128,27,54];for(var a=new Array(256),b=0;128>b;++b)a[b]=b<<1,a[b+128]=b+128<<1^283;h=new Array(256),i=new Array(256),k=new Array(4),l=new Array(4);for(var b=0;4>b;++b)k[b]=new Array(256),l[b]=new Array(256);for(var c,d,e,f,g,n,o,p=0,q=0,b=0;256>b;++b){f=q^q<<1^q<<2^q<<3^q<<4,f=f>>8^255&f^99,h[p]=f,i[f]=p,g=a[f],c=a[p],d=a[c],e=a[d],n=g<<24^f<<16^f<<8^(f^g),o=(c^d^e)<<24^(p^e)<<16^(p^d^e)<<8^(p^c^e);for(var r=0;4>r;++r)k[r][p]=n,l[r][f]=o,n=n<<24|n>>>8,o=o<<24|o>>>8;0===p?p=q=1:(p=c^a[a[a[c^e]]],q^=a[a[q]])}}function e(a,b){for(var c,d=a.slice(0),e=1,f=d.length,g=f+6+1,i=n*g,k=f;i>k;++k)c=d[k-1],k%f===0?(c=h[c>>>16&255]<<24^h[c>>>8&255]<<16^h[255&c]<<8^h[c>>>24]^j[e]<<24,e++):f>6&&k%f===4&&(c=h[c>>>24]<<24^h[c>>>16&255]<<16^h[c>>>8&255]<<8^h[255&c]),d[k]=d[k-f]^c;if(b){var m,o=l[0],p=l[1],q=l[2],r=l[3],s=d.slice(0);i=d.length;for(var k=0,t=i-n;i>k;k+=n,t-=n)if(0===k||k===i-n)s[k]=d[t],s[k+1]=d[t+3],s[k+2]=d[t+2],s[k+3]=d[t+1];else for(var u=0;n>u;++u)m=d[t+u],s[k+(3&-u)]=o[h[m>>>24]]^p[h[m>>>16&255]]^q[h[m>>>8&255]]^r[h[255&m]];d=s}return d}function f(a,b,c,d){var e,f,g,j,m,n=a.length/4-1;d?(e=l[0],f=l[1],g=l[2],j=l[3],m=i):(e=k[0],f=k[1],g=k[2],j=k[3],m=h);var o,p,q,r,s,t,u;o=b[0]^a[0],p=b[d?3:1]^a[1],q=b[2]^a[2],r=b[d?1:3]^a[3];for(var v=3,w=1;n>w;++w)s=e[o>>>24]^f[p>>>16&255]^g[q>>>8&255]^j[255&r]^a[++v],t=e[p>>>24]^f[q>>>16&255]^g[r>>>8&255]^j[255&o]^a[++v],u=e[q>>>24]^f[r>>>16&255]^g[o>>>8&255]^j[255&p]^a[++v],r=e[r>>>24]^f[o>>>16&255]^g[p>>>8&255]^j[255&q]^a[++v],o=s,p=t,q=u;c[0]=m[o>>>24]<<24^m[p>>>16&255]<<16^m[q>>>8&255]<<8^m[255&r]^a[++v],c[d?3:1]=m[p>>>24]<<24^m[q>>>16&255]<<16^m[r>>>8&255]<<8^m[255&o]^a[++v],c[2]=m[q>>>24]<<24^m[r>>>16&255]<<16^m[o>>>8&255]<<8^m[255&p]^a[++v],c[d?1:3]=m[r>>>24]<<24^m[o>>>16&255]<<16^m[p>>>8&255]<<8^m[255&q]^a[++v]}function g(a){a=a||{};var c,d=(a.mode||"CBC").toUpperCase(),e="AES-"+d;c=a.decrypt?b.cipher.createDecipher(e,a.key):b.cipher.createCipher(e,a.key);var f=c.start;return c.start=function(a,d){var e=null;d instanceof b.util.ByteBuffer&&(e=d,d={}),d=d||{},d.output=e,d.iv=a,f.call(c,d)},c}if(void 0==b)return void(dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"aes"));b.aes=b.aes||{},b.aes.startEncrypting=function(a,b,c,d){var e=g({key:a,output:c,decrypt:!1,mode:d});return e.start(b),e},b.aes.createEncryptionCipher=function(a,b){return g({key:a,output:null,decrypt:!1,mode:b})},b.aes.startDecrypting=function(a,b,c,d){var e=g({key:a,output:c,decrypt:!0,mode:d});return e.start(b),e},b.aes.createDecryptionCipher=function(a,b){return g({key:a,output:null,decrypt:!0,mode:b})},b.aes.Algorithm=function(b,c){a(),m||d();var e=this;e.name=b,e.mode=new c({blockSize:16,cipher:{encrypt:function(a,b){return f(e._w,a,b,!1)},decrypt:function(a,b){return f(e._w,a,b,!0)}}}),e._init=!1},b.aes.Algorithm.prototype.initialize=function(a){if(!this._init){var c,d=a.key;if("string"==typeof d){if(16!==d.length&&24!==d.length&&32!==d.length)throw new Error("The "+d.length+" bytes key length is not valid for aes algorithm.");d=b.util.createBuffer(d)}else if(b.util.isArray(d)){if(16!==d.length&&24!==d.length&&32!==d.length)throw new Error("The "+d.length+" bytes key length is not valid for aes algorithm.");c=d,d=b.util.createBuffer();for(var f=0;f<c.length;++f)d.putByte(c[f])}if(!b.util.isArray(d)){c=d,d=[];var g=c.length();if(16===g||24===g||32===g){g>>>=2;for(var f=0;g>f;++f)d.push(c.getInt32())}}if(!b.util.isArray(d)||4!==d.length&&6!==d.length&&8!==d.length)throw new Error("Invalid key parameter.");var h=this.mode.name,i=-1!==b.util.arrayIndexOf(["CFB","OFB","CTR","GCM"],h);this._w=e(d,a.decrypt&&!i),this._init=!0}},b.aes._expandKey=function(a,b){return m||d(),e(a,b)},b.aes._updateBlock=f,c("AES-CBC",b.cipher.modes.cbc),c("AES-CFB",b.cipher.modes.cfb),c("AES-OFB",b.cipher.modes.ofb),c("AES-CTR",b.cipher.modes.ctr),c("AES-GCM",b.cipher.modes.gcm);var h,i,j,k,l,m=!1,n=4}var b="aes";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./cipher","./cipherModes","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a,c){var d=function(){return new b.seed.Algorithm(a,c)};b.cipher.registerAlgorithm(a,d)}function d(a){return 255&a}function e(a){return 255&a>>>8}function f(a){return 255&a>>>16}function g(a){return 255&a>>>24}function h(a){a[0]=a[0]>>>24|a[0]<<24|a[0]<<8&16711680|a[0]>>>8&65280}function h(a){return a>>>24|a<<24|a<<8&16711680|a>>>8&65280}function i(a,b,c,h,i,j){var k,l,m;k=b[0],b[0]=b[0]>>>8^c[0]<<24,c[0]=c[0]>>>8^k<<24,l=b[0]+h[0]-u[j],m=c[0]+u[j]-i[0],a[0]=q[d(l)]^r[e(l)]^s[f(l)]^t[g(l)],a[1]=q[d(m)]^r[e(m)]^s[f(m)]^t[g(m)]}function j(a,b,c,h,i,j){var k,l,m;k=h[0],h[0]=h[0]<<8^i[0]>>>24,i[0]=i[0]<<8^k>>>24,l=b[0]+h[0]-u[j],m=c[0]+u[j]-i[0],a[0]=q[d(l)]^r[e(l)]^s[f(l)]^t[g(l)],a[1]=q[d(m)]^r[e(m)]^s[f(m)]^t[g(m)]}function k(a,b,c,h,i){var j,k,l=0,m=0;j=c[0]^i[0],k=h[0]^i[1],k^=j,l=0>j?2147483647&j|2147483648:j,k=q[d(k)]^r[e(k)]^s[f(k)]^t[g(k)],m=0>k?2147483647&k|2147483648:k,l+=m,j=q[d(l)]^r[e(l)]^s[f(l)]^t[g(l)],l=0>j?2147483647&j|2147483648:j,m+=l,k=q[d(m)]^r[e(m)]^s[f(m)]^t[g(m)],m=0>k?2147483647&k|2147483648:k,l+=m,a[0]^=l,b[0]^=m}function l(a,b,c,d,e){var f=new Array(2),g=0;v||(h(b),h(c),h(d),h(e)),f[0]=a[g++],f[1]=a[g++],k(b,c,d,e,f),f[0]=a[g++],f[1]=a[g++],k(d,e,b,c,f),f[0]=a[g++],f[1]=a[g++],k(b,c,d,e,f),f[0]=a[g++],f[1]=a[g++],k(d,e,b,c,f),f[0]=a[g++],f[1]=a[g++],k(b,c,d,e,f),f[0]=a[g++],f[1]=a[g++],k(d,e,b,c,f),f[0]=a[g++],f[1]=a[g++],k(b,c,d,e,f),f[0]=a[g++],f[1]=a[g++],k(d,e,b,c,f),f[0]=a[g++],f[1]=a[g++],k(b,c,d,e,f),f[0]=a[g++],f[1]=a[g++],k(d,e,b,c,f),f[0]=a[g++],f[1]=a[g++],k(b,c,d,e,f),f[0]=a[g++],f[1]=a[g++],k(d,e,b,c,f),f[0]=a[g++],f[1]=a[g++],k(b,c,d,e,f),f[0]=a[g++],f[1]=a[g++],k(d,e,b,c,f),f[0]=a[g++],f[1]=a[g++],k(b,c,d,e,f),f[0]=a[g++],f[1]=a[g++],k(d,e,b,c,f),v||(h(b),h(c),h(d),h(e))}function m(a,b,c,d,e){var f=new Array(2),g=31;v||(h(b),h(c),h(d),h(e)),f[1]=a[g--],f[0]=a[g--],k(b,c,d,e,f),f[1]=a[g--],f[0]=a[g--],k(d,e,b,c,f),f[1]=a[g--],f[0]=a[g--],k(b,c,d,e,f),f[1]=a[g--],f[0]=a[g--],k(d,e,b,c,f),f[1]=a[g--],f[0]=a[g--],k(b,c,d,e,f),f[1]=a[g--],f[0]=a[g--],k(d,e,b,c,f),f[1]=a[g--],f[0]=a[g--],k(b,c,d,e,f),f[1]=a[g--],f[0]=a[g--],k(d,e,b,c,f),f[1]=a[g--],f[0]=a[g--],k(b,c,d,e,f),f[1]=a[g--],f[0]=a[g--],k(d,e,b,c,f),f[1]=a[g--],f[0]=a[g--],k(b,c,d,e,f),f[1]=a[g--],f[0]=a[g--],k(d,e,b,c,f),f[1]=a[g--],f[0]=a[g--],k(b,c,d,e,f),f[1]=a[g--],f[0]=a[g--],k(d,e,b,c,f),f[1]=a[g--],f[0]=a[g--],k(b,c,d,e,f),f[1]=a[g--],f[0]=a[g],k(d,e,b,c,f),v||(h(b),h(c),h(d),h(e))}function n(a){var b,c,k=new Array(1),l=new Array(1),m=new Array(1),n=new Array(1),o=new Array(2),p=2,w=[];return k[0]=a.getInt32(),l[0]=a.getInt32(),m[0]=a.getInt32(),n[0]=a.getInt32(),v||(k[0]=h(k[0]),l[0]=h(l[0]),m[0]=h(m[0]),n[0]=h(n[0])),b=k[0]+m[0]-u[0],c=l[0]-n[0]+u[0],w[0]=q[d(b)]^r[e(b)]^s[f(b)]^t[g(b)],w[1]=q[d(c)]^r[e(c)]^s[f(c)]^t[g(c)],i(o,k,l,m,n,1),w[p++]=o[0],w[p++]=o[1],j(o,k,l,m,n,2),w[p++]=o[0],w[p++]=o[1],i(o,k,l,m,n,3),w[p++]=o[0],w[p++]=o[1],j(o,k,l,m,n,4),w[p++]=o[0],w[p++]=o[1],i(o,k,l,m,n,5),w[p++]=o[0],w[p++]=o[1],j(o,k,l,m,n,6),w[p++]=o[0],w[p++]=o[1],i(o,k,l,m,n,7),w[p++]=o[0],w[p++]=o[1],j(o,k,l,m,n,8),w[p++]=o[0],w[p++]=o[1],i(o,k,l,m,n,9),w[p++]=o[0],w[p++]=o[1],j(o,k,l,m,n,10),w[p++]=o[0],w[p++]=o[1],i(o,k,l,m,n,11),w[p++]=o[0],w[p++]=o[1],j(o,k,l,m,n,12),w[p++]=o[0],w[p++]=o[1],i(o,k,l,m,n,13),w[p++]=o[0],w[p++]=o[1],j(o,k,l,m,n,14),w[p++]=o[0],w[p++]=o[1],i(o,k,l,m,n,15),w[p++]=o[0],w[p++]=o[1],w}function o(a,b,c,d){var e=new Array(1),f=new Array(1),g=new Array(1),h=new Array(1);e[0]=b[0],f[0]=b[1],g[0]=b[2],h[0]=b[3],d?m(a,e,f,g,h):l(a,e,f,g,h),c[0]=g[0],c[1]=h[0],c[2]=e[0],c[3]=f[0]}function p(a){a=a||{};var c,d=(a.mode||"CBC").toUpperCase(),e="SEED-"+d;c=a.decrypt?b.cipher.createDecipher(e,a.key):b.cipher.createCipher(e,a.key);var f=c.start;return c.start=function(a,d){var e=null;d instanceof b.util.ByteBuffer&&(e=d,d={}),d=d||{},d.output=e,d.iv=a,f.call(c,d)},c}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"seed");b.seed=b.seed||{},b.seed.startEncrypting=function(a,b,c,d){var e=p({key:a,output:c,decrypt:!1,mode:d||(null===b?"ECB":"CBC")});return e.start(b),e},b.seed.createEncryptionCipher=function(a,b){return p({key:a,output:null,decrypt:!1,mode:b})},b.seed.startDecrypting=function(a,b,c,d){var e=p({key:a,output:c,decrypt:!0,mode:d||(null===b?"ECB":"CBC")});return e.start(b),e},b.seed.createDecryptionCipher=function(a,b){return p({key:a,output:null,decrypt:!0,mode:b})},b.seed.Algorithm=function(b,c){a();var d=this;d.name=b,d.mode=new c({blockSize:16,cipher:{encrypt:function(a,b){return o(d._keys,a,b,!1)},decrypt:function(a,b){return o(d._keys,a,b,!0)}}}),d._init=!1},b.seed.Algorithm.prototype.initialize=function(a){if(!this._init){var c=b.util.createBuffer(a.key);if(0===this.name.indexOf("SEED")&&16!==c.length())throw new Error("Invalid SEED key size: "+8*c.length());this._keys=n(c),this._init=!0}},c("SEED-CBC",b.cipher.modes.cbc),c("SEED-ECB",b.cipher.modes.ecb);var q=[696885672,92635524,382128852,331600848,340021332,487395612,747413676,621093156,491606364,54739776,403181592,504238620,289493328,1020063996,181060296,591618912,671621160,71581764,536879136,495817116,549511392,583197408,147374280,386339604,629514660,261063564,50529024,994800504,999011256,318968592,314757840,785310444,809529456,210534540,1057960764,680042664,839004720,500027868,919007988,876900468,751624428,361075092,185271048,390550356,474763356,457921368,1032696252,16843008,604250148,470552604,860058480,411603096,268439568,214745292,851636976,432656856,738992172,667411428,843215472,58950528,462132120,297914832,109478532,164217288,541089888,272650320,595829664,734782440,218956044,914797236,512660124,256852812,931640244,441078360,113689284,944271480,646357668,302125584,797942700,365285844,557932896,63161280,881111220,21053760,306336336,1028485500,227377548,134742024,521081628,428446104,0,420024600,67371012,323179344,935850996,566354400,1036907004,910586484,789521196,654779172,813740208,193692552,235799052,730571688,578986656,776888940,327390096,223166796,692674920,1011642492,151585032,168428040,1066382268,802153452,868479984,96846276,126321540,335810580,1053750012,608460900,516870876,772678188,189481800,436867608,101057028,553722144,726360936,642146916,33686016,902164980,310547088,176849544,202113036,864269232,1045328508,281071824,977957496,122110788,377918100,633725412,637936164,8421504,764256684,533713884,562143648,805318704,923218740,781099692,906375732,352653588,570565152,940060728,885321972,663200676,88424772,206323788,25264512,701096424,75792516,394761108,889532724,197903304,248431308,1007431740,826372464,285282576,130532292,160006536,893743476,1003222008,449499864,952692984,344232084,424235352,42107520,80003268,1070593020,155795784,956903736,658989924,12632256,265274316,398971860,948482232,252642060,244220556,37896768,587408160,293704080,743202924,466342872,612671652,872689716,834793968,138952776,46318272,793731948,1024274748,755835180,4210752,1049539260,1041117756,1015853244,29475264,713728680,982168248,240009804,356864340,990589752,483184860,675831912,1062171516,478974108,415813848,172638792,373707348,927429492,545300640,768467436,105267780,897954228,722150184,625303908,986379e3,600040416,965325240,830583216,529503132,508449372,969535992,650568420,847426224,822161712,717939432,760045932,525292380,616882404,817950960,231588300,143163528,369496596,973746744,407392344,348442836,574775904,688464168,117900036,855847728,684253416,453710616,84214020,961114488,276861072,709517928,705307176,445289112],r=[943196208,3894986976,741149985,2753988258,3423588291,3693006546,2956166067,3090712752,2888798115,1612726368,1410680145,3288844227,1141130304,1815039843,1747667811,1478183763,3221472195,1612857954,808649523,3023406513,673777953,2686484640,3760374498,2754054051,3490956243,2417066385,269549841,67503618,471600144,3158084784,875955762,1208699715,3962556387,2282260608,1814842464,2821228704,337053459,3288646848,336987666,4097098992,3221406402,1141196097,3760308705,3558262482,1010765619,1010634033,2349764226,2551744656,673712160,1276005954,4097230578,1010699826,2753922465,4164536817,202181889,3693072339,3625502928,673909539,1680229986,2017086066,606537507,741281571,4029792753,1882342002,1073889858,3558130896,1073824065,3221274816,1882407795,1680295779,2888600736,2282457987,4097296371,2888666529,2147516544,471797523,3356150466,741084192,2821360290,875824176,3490890450,134941443,3962490594,3895052769,1545424209,2484372624,404228112,4164471024,1410811731,2888732322,134744064,3288712641,269681427,3423456705,2215020162,3090778545,4232040435,2084392305,3221340609,808517937,4097164785,2282392194,1747602018,2956034481,3490824657,538968096,3558328275,131586,539099682,67372032,1747470432,1882276209,67569411,3625700307,2619182481,2551810449,1612792161,3158216370,3827746530,1478052177,3692940753,1343308113,2417000592,3692874960,2551876242,2686682019,2821426083,3490758864,2147582337,202313475,1141327683,404359698,3760440291,3962359008,2349698433,3158282163,2484504210,2017151859,1545358416,2686616226,2686550433,1612923747,539165475,1275940161,3356018880,2619248274,2619116688,943327794,202116096,741215778,3090844338,1814974050,2619314067,1478117970,4029858546,2417132178,4029924339,1208568129,2016954480,3423390912,336921873,4164668403,1882210416,1949648241,2084523891,875889969,269484048,197379,1680098400,1814908257,3288778434,1949582448,3558196689,3023340720,3895118562,134809857,1949714034,404293905,4231974642,1073758272,269615634,3760242912,3158150577,67437825,4164602610,65793,4029726960,673843746,1545490002,2821294497,1410745938,1073955651,2214954369,336856080,2282326401,2551942035,2955968688,3827680737,1208502336,2017020273,2484570003,4231843056,471731730,2147648130,539033889,2349632640,404425491,1545555795,1949779827,1410614352,2956100274,471665937,606405921,1276071747,0,1141261890,3962424801,1477986384,1343373906,3895184355,2084458098,3625634514,3356084673,4231908849,808452144,2484438417,1680164193,1010568240,3023472306,3827614944,3090910131,2084326512,202247682,1343242320,943262001,606471714,808583730,2214888576,1747536225,2417197971,876021555,3827812323,606340128,2753856672,3356216259,1343439699,134875650,2215085955,3625568721,1275874368,2147713923,2349830019,3423522498,943393587,1208633922,3023538099],s=[2712152457,2172913029,3537114822,3553629123,1347687492,287055117,2695638156,556016901,1364991309,1128268611,270014472,303832590,1364201793,4043062476,3267889866,1667244867,539502600,1078199364,538976256,2442927501,3772784832,3806339778,3234334920,320083719,2711889285,2206994319,50332419,1937259339,3015195531,319820547,3536851650,3807129294,1886400576,2156661900,859586319,2695374984,842019330,3520863693,4076091078,1886663748,3773574348,2442401157,50858763,1398019911,1348213836,1398283083,2981903757,16777473,539239428,270277644,1936732995,2425886856,269488128,3234598092,4075827906,3520600521,539765772,3823380423,1919955522,2206204803,2476219275,3520074177,2189690502,3251112393,1616912448,1347424320,2745181059,3823643595,17566989,2998154886,2459704974,1129058127,3014932359,1381505610,3267626694,1886926920,2728666758,303043074,2745970575,3520337349,1633689921,3284140995,2964599940,1094713665,1380979266,1903967565,2173439373,526344,320610063,2442664329,0,286791945,263172,1397756739,4092868551,3789562305,4059839949,1920218694,590098191,589571847,2964336768,2206731147,34344462,2745707403,2728403586,1651256910,2475692931,1095503181,1634216265,1887190092,17303817,34081290,3015458703,3823906767,4092605379,3250849221,2206467975,269751300,4076617422,1617175620,3537641166,573320718,1128794955,303569418,33818118,555753729,1667771211,1650730566,33554946,4059313605,2458915458,2189953674,789516,3014669187,1920745038,3503296704,1920481866,1128531783,2459178630,3789825477,572794374,2155872384,2712415629,3554418639,2711626113,808464384,859059975,2729193102,842282502,286528773,572531202,808990728,4042536132,2745444231,1094976837,1078725708,2172649857,3790088649,2156135556,2475956103,825505029,3284667339,3268153038,809253900,1903178049,286265601,3284404167,2173176201,1903441221,4093131723,3537377994,4042799304,2425623684,1364728137,2189427330,3234071748,4093394895,1095240009,825768201,1667508039,3233808576,3284930511,3553892295,2964863112,51121935,2190216846,1111491138,589308675,2442137985,1617701964,3554155467,2695111812,808727556,4059050433,1078462536,3267363522,1668034383,826031373,556543245,1077936192,2998681230,842808846,2965126284,3250586049,2728929930,2998418058,1112280654,1364464965,859323147,3504086220,1617438792,1937522511,2426150028,3503823048,1112017482,1381242438,1936996167,2694848640,3790351821,1111754310,2981377413,589835019,1633953093,4076354250,3823117251,2981640585,2981114241,2476482447,1381768782,4059576777,3806602950,2997891714,825241857,3806866122,1634479437,1398546255,3773048004,4042272960,3251375565,2156398728,303306246,842545674,1347950664,3503559876,1650467394,556280073,50595591,858796803,3773311176,320346891,17040645,1903704393,2425360512,1650993738,573057546,2459441802],t=[137377848,3370182696,220277805,2258805798,3485715471,3469925406,2209591347,2293282872,2409868335,1080057888,1162957845,3351495687,1145062404,1331915823,1264805931,1263753243,3284385795,1113743394,53686323,2243015733,153167913,2158010400,3269648418,2275648551,3285438483,2173800465,17895441,100795398,202382364,2360392764,103953462,1262700555,3487820847,2290124808,1281387564,2292230184,118690839,3300967428,101848086,3304125492,3267543042,1161905157,3252805665,3335705622,255015999,221330493,2390920206,2291177496,136325160,1312967694,3337810998,238173246,2241963045,3388078137,218172429,3486768159,3369130008,186853419,1180853286,1249015866,119743527,253963311,3253858353,1114796082,1111638018,3302020116,1094795265,3233857536,1131638835,1197696039,2359340076,2340653067,3354653751,2376182829,2155905024,252910623,3401762826,203435052,2325915690,70267956,3268595730,184748043,3470978094,3387025449,1297177629,2224067604,135272472,3371235384,1196643351,2393025582,134219784,3317810181,51580947,3452029965,2256700422,2310125625,3488873535,1299283005,3250700289,20000817,3320968245,2323810314,1247963178,2175905841,3251752977,2105376,3352548375,33685506,35790882,67109892,1214277672,1097953329,117638151,3419658267,2375130141,2308020249,1096900641,2394078270,3336758310,1230067737,3453082653,1095847953,2156957712,3436239900,2324863002,2208538659,2342758443,3234910224,2172747777,251857935,1195590663,168957978,3286491171,3437292588,2374077453,2410921023,2257753110,1265858619,1280334876,2191695906,2174853153,1130586147,52633635,1296124941,3368077320,2391972894,2358287388,171063354,201329676,237120558,2326968378,1315073070,2408815647,1246910490,3270701106,2190643218,3287543859,1229015049,1215330360,3435187212,85005333,3421763643,1081110576,1165063221,1332968511,87110709,1052688,50528259,1147167780,1298230317,3334652934,1148220468,3318862869,2226172980,3403868202,151062537,1181905974,152115225,3472030782,1077952512,34738194,3235962912,2377235517,83952645,3404920890,16842753,3237015600,170010666,1314020382,2309072937,1179800598,1128480771,2239857669,68162580,2306967561,2341705755,2159063088,3319915557,1212172296,1232173113,2274595863,3438345276,236067870,2189590530,18948129,2357234700,185800731,1330863135,1198748727,1146115092,2192748594,219225117,86058021,1329810447,0,1178747910,3454135341,1213224984,1112690706,3420710955,1316125758,3402815514,3384920073,3455188029,3158064,2240910357,1164010533,204487740,2259858486,3303072804,2343811131,1282440252,235015182,1079005200,154220601,102900774,36843570,2223014916,1231120425,2207485971,120796215,3353601063,69215268,2225120292,3418605579,1129533459,167905290,2273543175,3385972761,1279282188,2206433283,2407762959,3468872718,187906107,1245857802,2276701239],u=[2654435769,1013904243,2027808486,4055616972,3816266649,3337566003,2380164711,465362127,930724254,1861448508,3722897016,3150826737,2006686179,4013372358,3731777421,3168587547],v=1}var b="seed";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./cipher","./cipherModes","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a,c){var d=function(){return new b.aria.Algorithm(a,c)};b.cipher.registerAlgorithm(a,d)}function d(a){return 65793*(a>>>24&255)^16777473*(a>>>16&255)^16842753*(a>>>8&255)^16843008*(255&a)}function e(a){return a<<8&4278255360^a>>>8&16711935}function f(a){return a<<16&4294901760^a>>>16&65535}function g(a){return(255&a)<<24^(65280&a)<<8^(16711680&a)>>>8^(4278190080&a)>>>24}function h(a,b,c,d,e){var f=4-Math.floor(c/32),g=c%32,h=32-g;d[e]=a[0]^b[f%4]>>>g^b[(f+3)%4]<<h,d[e+1]=a[1]^b[(f+1)%4]>>>g^b[f%4]<<h,d[e+2]=a[2]^b[(f+2)%4]>>>g^b[(f+1)%4]<<h,d[e+3]=a[3]^b[(f+3)%4]>>>g^b[(f+2)%4]<<h}function i(a,b,c,h){var i,j,k,l;i=d(a[b]),j=d(a[b+1]),k=d(a[b+2]),l=d(a[b+3]),j^=k,k^=l,i^=j,l^=j,k^=i,j^=k,j=e(j),k=f(k),l=g(l),j^=k,k^=l,i^=j,l^=j,k^=i,j^=k,c[h]=i,c[h+1]=j,c[h+2]=k,c[h+3]=l}function j(a,b,c){for(var d,e=0;4>e;e++)d=a[b+e],a[b+e]=a[c+e],a[c+e]=d}function k(a,b,c,d){i(a,b,d,0),i(a,c,a,b),a[c]=d[0],a[c+1]=d[1],a[c+2]=d[2],a[c+3]=d[3]}function l(a,b){var c=a.slice(0),d=32*a.length;o=8+a.length;var l,m,n,q,r,s=new Array(4*o),t=0,y=new Array(4),z=new Array(4),A=new Array(4),B=new Array(4);if(y[0]=c[0],y[1]=c[1],y[2]=c[2],y[3]=c[3],r=(d-128)/64,l=y[0]^p[r][0],m=y[1]^p[r][1],n=y[2]^p[r][2],q=y[3]^p[r][3],l=u[l>>>24&255]^v[l>>>16&255]^w[l>>>8&255]^x[255&l],m=u[m>>>24&255]^v[m>>>16&255]^w[m>>>8&255]^x[255&m],n=u[n>>>24&255]^v[n>>>16&255]^w[n>>>8&255]^x[255&n],q=u[q>>>24&255]^v[q>>>16&255]^w[q>>>8&255]^x[255&q],m^=n,n^=q,l^=m,q^=m,n^=l,m^=n,m=e(m),n=f(n),q=g(q),m^=n,n^=q,l^=m,q^=m,n^=l,m^=n,d>128?(z[0]=c[4],z[1]=c[5],d>192?(z[2]=c[6],z[3]=c[7]):z[2]=z[3]=0):z[0]=z[1]=z[2]=z[3]=0,z[0]^=l,z[1]^=m,z[2]^=n,z[3]^=q,l=z[0],m=z[1],n=z[2],q=z[3],r=2==r?0:r+1,l^=p[r][0],m^=p[r][1],n^=p[r][2],q^=p[r][3],l=w[l>>>24&255]^x[l>>>16&255]^u[l>>>8&255]^v[255&l],m=w[m>>>24&255]^x[m>>>16&255]^u[m>>>8&255]^v[255&m],n=w[n>>>24&255]^x[n>>>16&255]^u[n>>>8&255]^v[255&n],q=w[q>>>24&255]^x[q>>>16&255]^u[q>>>8&255]^v[255&q],m^=n,n^=q,l^=m,q^=m,n^=l,m^=n,q=e(q),l=f(l),m=g(m),m^=n,n^=q,l^=m,q^=m,n^=l,m^=n,l^=y[0],m^=y[1],n^=y[2],q^=y[3],A[0]=l,A[1]=m,A[2]=n,A[3]=q,r=2==r?0:r+1,l^=p[r][0],m^=p[r][1],n^=p[r][2],q^=p[r][3],l=u[l>>>24&255]^v[l>>>16&255]^w[l>>>8&255]^x[255&l],m=u[m>>>24&255]^v[m>>>16&255]^w[m>>>8&255]^x[255&m],n=u[n>>>24&255]^v[n>>>16&255]^w[n>>>8&255]^x[255&n],q=u[q>>>24&255]^v[q>>>16&255]^w[q>>>8&255]^x[255&q],m^=n,n^=q,l^=m,q^=m,n^=l,m^=n,m=e(m),n=f(n),q=g(q),m^=n,n^=q,l^=m,q^=m,n^=l,m^=n,B[0]=l^z[0],B[1]=m^z[1],B[2]=n^z[2],B[3]=q^z[3],h(y,z,19,s,t),t+=4,h(z,A,19,s,t),t+=4,h(A,B,19,s,t),t+=4,h(B,y,19,s,t),t+=4,h(y,z,31,s,t),t+=4,h(z,A,31,s,t),t+=4,h(A,B,31,s,t),t+=4,h(B,y,31,s,t),t+=4,h(y,z,67,s,t),t+=4,h(z,A,67,s,t),t+=4,h(A,B,67,s,t),t+=4,h(B,y,67,s,t),t+=4,h(y,z,97,s,t),t+=4,d>128&&(h(z,A,97,s,t),t+=4,h(A,B,97,s,t),t+=4),d>192&&(h(B,y,97,s,t),t+=4,h(y,z,109,s,t)),b){var C,D=0,E=new Array(4);for(C=32+d/8,j(s,0,C),D+=4,C-=4;C>D;D+=4,C-=4)k(s,D,C,E);i(s,D,E,0),s[D]=E[0],s[D+1]=E[1],s[D+2]=E[2],s[D+3]=E[3]}return c=s}function m(a,c,d,h){var i,j,k,l,m,n=0,p=new Array(16),y=a.slice(0);for(i=c[0],j=c[1],k=c[2],l=c[3],m=1;o/2>m;m++)i^=y[n++],j^=y[n++],k^=y[n++],l^=y[n++],i=u[i>>>24&255]^v[i>>>16&255]^w[i>>>8&255]^x[255&i],j=u[j>>>24&255]^v[j>>>16&255]^w[j>>>8&255]^x[255&j],k=u[k>>>24&255]^v[k>>>16&255]^w[k>>>8&255]^x[255&k],l=u[l>>>24&255]^v[l>>>16&255]^w[l>>>8&255]^x[255&l],j^=k,k^=l,i^=j,l^=j,k^=i,j^=k,j=e(j),k=f(k),l=g(l),j^=k,k^=l,i^=j,l^=j,k^=i,j^=k,i^=y[n++],j^=y[n++],k^=y[n++],l^=y[n++],i=w[i>>>24&255]^x[i>>>16&255]^u[i>>>8&255]^v[255&i],j=w[j>>>24&255]^x[j>>>16&255]^u[j>>>8&255]^v[255&j],k=w[k>>>24&255]^x[k>>>16&255]^u[k>>>8&255]^v[255&k],l=w[l>>>24&255]^x[l>>>16&255]^u[l>>>8&255]^v[255&l],j^=k,k^=l,i^=j,l^=j,k^=i,j^=k,l=e(l),i=f(i),j=g(j),j^=k,k^=l,i^=j,l^=j,k^=i,j^=k;i^=y[n++],j^=y[n++],k^=y[n++],l^=y[n++],i=u[i>>>24&255]^v[i>>>16&255]^w[i>>>8&255]^x[255&i],j=u[j>>>24&255]^v[j>>>16&255]^w[j>>>8&255]^x[255&j],k=u[k>>>24&255]^v[k>>>16&255]^w[k>>>8&255]^x[255&k],l=u[l>>>24&255]^v[l>>>16&255]^w[l>>>8&255]^x[255&l],j^=k,k^=l,i^=j,l^=j,k^=i,j^=k,j=e(j),k=f(k),l=g(l),j^=k,k^=l,i^=j,l^=j,k^=i,j^=k,i^=y[n++],j^=y[n++],k^=y[n++],l^=y[n++],p=b.util.createBuffer(),p.putByte(255&(s[255&i>>>24]^y[n]>>>24)),p.putByte(255&(t[255&i>>>16]^y[n]>>>16)),p.putByte(255&(q[255&i>>>8]^y[n]>>>8)),p.putByte(255&(r[255&i]^y[n])),p.putByte(255&(s[255&j>>>24]^y[n+1]>>>24)),p.putByte(255&(t[255&j>>>16]^y[n+1]>>>16)),p.putByte(255&(q[255&j>>>8]^y[n+1]>>>8)),p.putByte(255&(r[255&j]^y[n+1])),p.putByte(255&(s[255&k>>>24]^y[n+2]>>>24)),p.putByte(255&(t[255&k>>>16]^y[n+2]>>>16)),p.putByte(255&(q[255&k>>>8]^y[n+2]>>>8)),p.putByte(255&(r[255&k]^y[n+2])),p.putByte(255&(s[255&l>>>24]^y[n+3]>>>24)),p.putByte(255&(t[255&l>>>16]^y[n+3]>>>16)),p.putByte(255&(q[255&l>>>8]^y[n+3]>>>8)),p.putByte(255&(r[255&l]^y[n+3])),d[0]=p.getInt32(),d[1]=p.getInt32(),d[2]=p.getInt32(),d[3]=p.getInt32()}function n(a){a=a||{};var c,d=(a.mode||"CBC").toUpperCase(),e="ARIA-"+d;c=a.decrypt?b.cipher.createDecipher(e,a.key):b.cipher.createCipher(e,a.key);var f=c.start;return c.start=function(a,d){var e=null;d instanceof b.util.ByteBuffer&&(e=d,d={}),d=d||{},d.output=e,d.iv=a,f.call(c,d)},c}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"aria");b.aria=b.aria||{},b.aria.startEncrypting=function(a,b,c,d){var e=n({key:a,output:c,decrypt:!1,mode:d});return e.start(b),e},b.aria.createEncryptionCipher=function(a,b){return n({key:a,output:null,decrypt:!1,mode:b})},b.aria.startDecrypting=function(a,b,c,d){var e=n({key:a,output:c,decrypt:!0,mode:d});return e.start(b),e},b.aria.createDecryptionCipher=function(a,b){return n({key:a,output:null,decrypt:!0,mode:b})},b.aria.Algorithm=function(b,c){a();var d=this;d.name=b,d.mode=new c({blockSize:16,cipher:{encrypt:function(a,b){return m(d._w,a,b,!1)},decrypt:function(a,b){return m(d._w,a,b,!0)}}}),d._init=!1},b.aria.Algorithm.prototype.initialize=function(a){if(!this._init){var c,d=a.key;if("string"==typeof d){if(16!==d.length&&24!==d.length&&32!==d.length)throw new Error("The "+d.length+" bytes key length is not valid for aria algorithm.");d=b.util.createBuffer(d)}else if(b.util.isArray(d)){if(16!==d.length&&24!==d.length&&32!==d.length)throw new Error("The "+d.length+" bytes key length is not valid for aria algorithm.");c=d,d=b.util.createBuffer();for(var e=0;e<c.length;++e)d.putByte(c[e])}if(!b.util.isArray(d)){c=d,d=[];var f=c.length();if(16===f||24===f||32===f){f>>>=2;for(var e=0;f>e;++e)d.push(c.getInt32())}}if(!b.util.isArray(d)||4!==d.length&&6!==d.length&&8!==d.length)throw new Error("Invalid key parameter.");var g=this.mode.name,h=-1!==b.util.arrayIndexOf(["CFB","OFB","CTR","GCM"],g);this._w=l(d,a.decrypt&&!h),this._init=!0}},b.aria._expandKey=function(a,b){return l(a,b)},b.aria._updateBlock=m,c("ARIA-ECB",b.cipher.modes.ecb),c("ARIA-CBC",b.cipher.modes.cbc);var o,p=[[1367130551,656542356,4262702056,4204424928],[1840335564,2653014048,4280857045,4015907504],[3683792669,556198256,52729717,82364686]],q=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],r=[226,78,84,252,148,194,74,204,98,13,106,70,60,77,139,209,94,250,100,203,180,151,190,43,188,119,46,3,211,25,89,193,29,6,65,107,85,240,153,105,234,156,24,174,99,223,231,187,0,115,102,251,150,76,133,228,58,9,69,170,15,238,16,235,45,127,244,41,172,207,173,145,141,120,200,149,249,47,206,205,8,122,136,56,92,131,42,40,71,219,184,199,147,164,18,83,255,135,14,49,54,33,88,72,1,142,55,116,50,202,233,177,183,171,12,215,196,86,66,38,7,152,96,217,182,185,17,64,236,32,140,189,160,201,132,4,73,35,241,79,80,31,19,220,216,192,158,87,227,195,123,101,59,2,143,62,232,37,146,229,21,221,253,23,169,191,212,154,126,197,57,103,254,118,157,67,167,225,208,245,104,242,27,52,112,5,163,138,213,121,134,168,48,198,81,75,30,166,39,246,53,210,110,36,22,130,95,218,230,117,162,239,44,178,28,159,93,111,128,10,114,68,155,108,144,11,91,51,125,90,82,243,97,161,247,176,214,63,124,109,237,20,224,165,61,34,179,248,137,222,113,26,175,186,181,129],s=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],t=[48,104,153,27,135,185,33,120,80,57,219,225,114,9,98,60,62,126,94,142,241,160,204,163,42,29,251,182,214,32,196,141,129,101,245,137,203,157,119,198,87,67,86,23,212,64,26,77,192,99,108,227,183,200,100,106,83,170,56,152,12,244,155,237,127,34,118,175,221,58,11,88,103,136,6,195,53,13,1,139,140,194,230,95,2,36,117,147,102,30,229,226,84,216,16,206,122,232,8,44,18,151,50,171,180,39,10,35,223,239,202,217,184,250,220,49,107,209,173,25,73,189,81,150,238,228,168,65,218,255,205,85,134,54,190,97,82,248,187,14,130,72,105,154,224,71,158,92,4,75,52,21,121,38,167,222,41,174,146,215,132,233,210,186,93,243,197,176,191,164,59,113,68,70,43,252,235,111,213,246,20,254,124,112,90,125,253,47,24,131,22,165,145,31,5,149,116,169,193,91,74,133,109,19,7,79,78,69,178,15,201,28,166,188,236,115,144,123,207,89,143,161,249,45,242,177,0,148,55,159,208,46,156,110,40,63,128,240,61,211,37,138,181,231,66,179,199,234,247,76,17,51,3,162,172,96],u=[6513507,8158332,7829367,8092539,15921906,7039851,7303023,12961221,3158064,65793,6776679,2829099,16711422,14145495,11250603,7763574,13290186,8553090,13224393,8224125,16448250,5855577,4671303,15790320,11382189,13948116,10658466,11513775,10263708,10790052,7500402,12632256,12040119,16645629,9671571,2500134,3552822,4144959,16250871,13421772,3421236,10855845,15066597,15856113,7434609,14211288,3223857,1381653,263172,13092807,2302755,12829635,1579032,9868950,328965,10132122,460551,1184274,8421504,14869218,15461355,2565927,11711154,7697781,592137,8618883,2894892,1710618,1776411,7237230,5921370,10526880,5395026,3881787,14079702,11776947,2697513,14935011,3092271,8684676,5460819,13750737,0,15592941,2105376,16579836,11645361,5987163,6974058,13355979,12500670,3750201,4868682,5000268,5789784,13619151,13684944,15724527,11184810,16514043,4408131,5066061,3355443,8750469,4539717,16382457,131586,8355711,5263440,3947580,10461087,11053224,5329233,10724259,4210752,9408399,9605778,10329501,3684408,16119285,12369084,11974326,14342874,2171169,1052688,16777215,15987699,13816530,13487565,789516,1250067,15527148,6250335,9934743,4473924,1513239,12895428,10987431,8289918,4013373,6579300,6118749,1644825,7566195,6316128,8487297,5197647,14474460,2236962,2763306,9474192,8947848,4605510,15658734,12105912,1315860,14606046,6184542,723723,14408667,14737632,3289650,3815994,657930,4802889,394758,2368548,6052956,12763842,13882323,11316396,6447714,9539985,9803157,15000804,7960953,15198183,13158600,3618615,7171437,9276813,14013909,5131854,11119017,7105644,5658198,16053492,15395562,6645093,8026746,11447982,526344,12237498,7895160,2434341,3026478,1842204,10921638,11842740,13027014,15263976,14540253,7631988,2039583,4934475,12434877,9145227,9079434,7368816,4079166,11908533,6710886,4737096,197379,16185078,921102,6381921,3487029,5723991,12171705,8816262,12698049,1907997,10395294,14803425,16316664,10000536,1118481,6908265,14277081,9342606,9737364,10197915,1973790,8882055,15329769,13553358,5592405,2631720,14671839,9211020,10592673,9013641,855309,12566463,15132390,4342338,6842472,4276545,10066329,2960685,986895,11579568,5526612,12303291,1447446],v=[3791708898,1308642894,1409307732,4227923196,2483066004,3254829762,1241533002,3422604492,1644192354,218107149,1778412138,1174423110,1006648380,1291865421,2332068747,3506491857,1577082462,4194368250,1677747300,3405827019,3019945140,2533398423,3187719870,721431339,3154164924,1996519287,771763758,50332419,3540046803,419436825,1493195097,3238052289,486546717,100664838,1090535745,1795189611,1426085205,4026593520,2566953369,1761634665,3925928682,2617285788,402659352,2919280302,1660969827,3741376479,3875596263,3137387451,0,1929409395,1711302246,4211145723,2516620950,1275087948,2231403909,3825263844,973093434,150997257,1157645637,2852170410,251662095,3993038574,268439568,3942706155,754986285,2130739071,4093703412,687876393,2885725356,3472936911,2902502829,2432733585,2365623693,2013296760,3355494600,2499843477,4177590777,788541231,3456159438,3439381965,134219784,2046851706,2281736328,939538488,1543527516,2197848963,704653866,671098920,1191200583,3674266587,3087055032,3338717127,2466288531,2751505572,301994514,1392530259,4278255615,2264958855,234884622,822096177,905983542,553656609,1476417624,1207978056,16777473,2382401166,922761015,1946186868,838873650,3389049546,3909151209,2969612721,3070277559,2868947883,201329676,3607156695,3288384708,1442862678,1107313218,637543974,117442311,2550175896,1610637408,3640711641,3053500086,3103832505,285217041,1073758272,3959483628,536879136,2348846220,3170942397,2684395680,3372272073,2214626436,67109892,1224755529,587211555,4043370993,1325420367,1342197840,520101663,318771987,3691044060,3623934168,3221274816,2650840734,1459640151,3808486371,3271607235,2063629179,1694524773,989870907,33554946,2399178639,1040203326,3892373736,620766501,2449511058,3842041317,352326933,3707821533,4244700669,385881879,2835392937,3204497343,3556824276,2583730842,2113961598,3305162181,956315961,1728079719,4261478142,1979741814,2634063261,1124090691,2801837991,3774931425,3489714384,4110480885,1744857192,4060148466,452991771,872428596,1879076976,83887365,2734728099,2315291274,3573601749,2030074233,2248181382,2818615464,805318704,3321939654,1358975313,1258310475,503324190,2785060518,654321447,4127258358,889206069,3523269330,1845522030,603989028,369104406,2181071490,1593859935,3657489114,3858818790,1962964341,2717950626,4009816047,738208812,2986390194,469769244,2667618207,1560304989,1862299503,2147516544,167774730,1912631922,1140868164,2600508315,1811967084,2415956112,184552203,1526750043,855651123,2097184125,1509972570,1375752786,4076925939,1627414881,2701173153,4144035831,2952835248,3590379222,1056980799,2080406652,1828744557,3976261101,335549460,3758153952,2768283045,1023425853,570434082,3003167667,4160813304,2298513801,3724599006,1895854449,436214298,2936057775,3120609978,3036722613,2164294017],w=[1381105746,151584777,1785331818,3587506389,808452144,909508662,2779054245,943194168,3216965823,1077936192,2745368739,2661154974,2172715137,4092788979,3621191895,4227531003,2088501372,3823304931,960036921,2189557890,2610626715,791609391,4294902015,2273771655,875823156,2391670926,1128464451,1145307204,3301179588,3739091166,3924361449,3419078859,1414791252,2071658619,2492727444,842137650,2795896998,3267494082,589496355,1027407933,4008575214,1280049228,2509570197,185270283,1111621698,4210688250,3284336835,1313734734,134742024,774766638,2711683233,1717960806,673710120,3654877401,606339108,2998010034,1987444854,1532690523,2728525986,1229520969,1835860077,2341142667,3520135377,623181861,1920073842,4177002744,4143317238,1684275300,2256928902,1751646312,2560098456,370540566,3570663636,2762211492,1549533276,3435921612,1566376029,1701118053,3065381046,2459041938,1819017324,1886388336,1212678216,1347420240,4261216509,3991732461,3115909305,3671720154,1583218782,353697813,1178992710,1465319511,2812739751,2374828173,2644312221,2223243396,2425356432,3638034648,2880110763,0,2357985420,3166437564,3553820883,168427530,4160159991,3840147684,1482162264,84213765,3099066552,3014852787,1162149957,101056518,3503292624,741081132,505282590,2408513679,3402236106,1061093439,252641295,33685506,3250651329,2947481775,3183280317,50528259,16842753,320012307,2324299914,1802174571,976879674,2442199185,286326801,1094778945,1330577487,1734803559,3705405660,3941204202,2543255703,4075946226,3486449871,3469607118,4042260720,3031695540,3873833190,1936916595,2526412950,2896953516,1953759348,572653602,3890675943,2913796269,892665909,2240086149,3806462178,4193845497,926351415,3907518696,471597084,1970602101,3755933919,1852702830,1195835463,4059103473,437911578,1903231089,488439837,690552873,3318022341,2307457161,1869545583,3082223799,1650589794,235798542,2863268010,404226072,3200123070,454754331,4244373756,1448476758,1044250686,1263206475,3334865094,3536978130,2037973113,538968096,2593783962,3688562907,3233808576,4278059262,2021130360,3452764365,1515847770,4109631732,522125343,3722248413,2829582504,858980403,2290614408,117899271,3351707847,825294897,2981167281,303169554,269484048,1499005017,656867367,2155872384,3974889708,1600061535,1616904288,1364262993,2139029631,2846425257,421068825,3048538293,1246363722,218955789,757923885,3856990437,2054815866,2677997727,2475884691,3385393353,2627469468,4025417967,2694840480,3772776672,993722427,1296891981,2930639022,707395626,4126474485,2964324528,3368550600,3958046955,3149594811,1010565180,2206400643,1397948499,2576941209,1633747041,387383319,724238379,67371012,2122186878,3132752058,2004287607,3604349142,640024614,3789619425,1768489065,336855060,1667432547,1431634005,555810849,202113036,2105344125],x=[808464384,1751672832,2576980224,454761216,2273806080,3115956480,555819264,2021160960,1347440640,960051456,3688618752,3789676800,1920102912,151587072,1650614784,1010580480,1044266496,2122219008,1583242752,2391707136,4059164928,2694881280,3435973632,2745410304,707406336,488447232,4227595008,3065427456,3604403712,538976256,3301229568,2374864128,2172748032,1701143808,4126536960,2307492096,3419130624,2644352256,2004317952,3334915584,1465341696,1128481536,1448498688,387389184,3570717696,1077952512,437918208,1296911616,3233857536,1667457792,1819044864,3823362816,3082270464,3368601600,1684300800,1785358848,1397969664,2863311360,943208448,2560137216,202116096,4109693952,2610666240,3991792896,2139062016,572662272,1987474944,2947526400,3722304768,976894464,185273088,1482184704,1734829824,2290649088,101058048,3284386560,892679424,218959104,16843008,2341178112,2358021120,3267543552,3873891840,1600085760,33686016,606348288,1970631936,2475922176,1717986816,505290240,3857048832,3806519808,1414812672,3638089728,269488128,3469659648,2054846976,3907577856,134744064,741092352,303174144,2543294208,842150400,2880154368,3031741440,656877312,168430080,589505280,3755990784,4025478912,3402287616,3654932736,3099113472,4210752e3,3705461760,825307392,1802201856,3520188672,2913840384,421075200,1229539584,3183328512,1364283648,2526451200,4008635904,3840205824,2829625344,1094795520,3671775744,4294967040,3452816640,1431655680,2256963072,909522432,3200171520,1633771776,1381126656,4177065984,3149642496,235802112,2189591040,1212696576,1768515840,2593823232,3772833792,1195853568,2661195264,1549556736,67372032,1263225600,875836416,353703168,2038003968,640034304,2812782336,3739147776,690563328,2930683392,2459079168,3621246720,2223277056,3924420864,3537031680,3132799488,1566399744,4092850944,3318072576,2964369408,3217014528,2762253312,993737472,1903259904,1145324544,1179010560,724249344,4244438016,3958106880,1869573888,3587560704,4143379968,336860160,4278124032,2088532992,1886416896,1515870720,2105376e3,4261281024,791621376,404232192,2206434048,370546176,2779096320,2442236160,522133248,84215040,2509608192,1953788928,2846468352,3250700544,1532713728,1246382592,2240120064,1835887872,320017152,117901056,1330597632,1313754624,1162167552,2998055424,252645120,3385444608,471604224,2795939328,3166485504,3974949888,1936945920,2425393152,2071689984,3486502656,1499027712,2408550144,2711724288,4193908992,757935360,4076007936,2981212416,0,2492765184,926365440,2678038272,3503345664,774778368,2627509248,1852730880,673720320,1061109504,2155905024,4042321920,1027423488,3553874688,623191296,2324335104,3048584448,3890734848,1111638528,3014898432,3351758592,3941263872,4160222976,1280068608,286331136,858993408,50529024,2728567296,2896997376,1616928768];
}var b="aria";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./cipher","./cipherModes","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a,c){var d=function(){return new b.des.Algorithm(a,c)};b.cipher.registerAlgorithm(a,d)}function d(a){for(var b,c=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],d=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],e=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],f=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],g=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],h=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],i=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],j=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],k=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],l=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],m=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],n=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],o=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],p=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],q=a.length()>8?3:1,r=[],s=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],t=0,u=0;q>u;u++){var v=a.getInt32(),w=a.getInt32();b=252645135&(v>>>4^w),w^=b,v^=b<<4,b=65535&(w>>>-16^v),v^=b,w^=b<<-16,b=858993459&(v>>>2^w),w^=b,v^=b<<2,b=65535&(w>>>-16^v),v^=b,w^=b<<-16,b=1431655765&(v>>>1^w),w^=b,v^=b<<1,b=16711935&(w>>>8^v),v^=b,w^=b<<8,b=1431655765&(v>>>1^w),w^=b,v^=b<<1,b=v<<8|w>>>20&240,v=w<<24|w<<8&16711680|w>>>8&65280|w>>>24&240,w=b;for(var x=0;x<s.length;++x){s[x]?(v=v<<2|v>>>26,w=w<<2|w>>>26):(v=v<<1|v>>>27,w=w<<1|w>>>27),v&=-15,w&=-15;var y=c[v>>>28]|d[v>>>24&15]|e[v>>>20&15]|f[v>>>16&15]|g[v>>>12&15]|h[v>>>8&15]|i[v>>>4&15],z=j[w>>>28]|k[w>>>24&15]|l[w>>>20&15]|m[w>>>16&15]|n[w>>>12&15]|o[w>>>8&15]|p[w>>>4&15];b=65535&(z>>>16^y),r[t++]=y^b,r[t++]=z^b<<16}}return r}function e(a,b,c,d){var e,f=32===a.length?3:9;e=3===f?d?[30,-2,-2]:[0,32,2]:d?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var o,p=b[0],q=b[1];o=252645135&(p>>>4^q),q^=o,p^=o<<4,o=65535&(p>>>16^q),q^=o,p^=o<<16,o=858993459&(q>>>2^p),p^=o,q^=o<<2,o=16711935&(q>>>8^p),p^=o,q^=o<<8,o=1431655765&(p>>>1^q),q^=o,p^=o<<1,p=p<<1|p>>>31,q=q<<1|q>>>31;for(var r=0;f>r;r+=3){for(var s=e[r+1],t=e[r+2],u=e[r];u!=s;u+=t){var v=q^a[u],w=(q>>>4|q<<28)^a[u+1];o=p,p=q,q=o^(h[v>>>24&63]|j[v>>>16&63]|l[v>>>8&63]|n[63&v]|g[w>>>24&63]|i[w>>>16&63]|k[w>>>8&63]|m[63&w])}o=p,p=q,q=o}p=p>>>1|p<<31,q=q>>>1|q<<31,o=1431655765&(p>>>1^q),q^=o,p^=o<<1,o=16711935&(q>>>8^p),p^=o,q^=o<<8,o=858993459&(q>>>2^p),p^=o,q^=o<<2,o=65535&(p>>>16^q),q^=o,p^=o<<16,o=252645135&(p>>>4^q),q^=o,p^=o<<4,c[0]=p,c[1]=q}function f(a){a=a||{};var c=(a.mode||"CBC").toUpperCase(),d=24==a.key.length?"3DES-":"DES-";d+=c;var e;e=a.decrypt?b.cipher.createDecipher(d,a.key):b.cipher.createCipher(d,a.key);var f=e.start;return e.start=function(a,c){var d=null;c instanceof b.util.ByteBuffer&&(d=c,c={}),c=c||{},c.output=d,c.iv=a,f.call(e,c)},e}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"des");b.des=b.des||{},b.des.startEncrypting=function(a,b,c,d){var e=f({key:a,output:c,decrypt:!1,mode:d||(null===b?"ECB":"CBC")});return e.start(b),e},b.des.createEncryptionCipher=function(a,b){return f({key:a,output:null,decrypt:!1,mode:b})},b.des.startDecrypting=function(a,b,c,d){var e=f({key:a,output:c,decrypt:!0,mode:d||(null===b?"ECB":"CBC")});return e.start(b),e},b.des.createDecryptionCipher=function(a,b){return f({key:a,output:null,decrypt:!0,mode:b})},b.des.Algorithm=function(b,c){a();var d=this;d.name=b,d.mode=new c({blockSize:8,cipher:{encrypt:function(a,b){return e(d._keys,a,b,!1)},decrypt:function(a,b){return e(d._keys,a,b,!0)}}}),d._init=!1},b.des.Algorithm.prototype.initialize=function(a){if(!this._init){var c=b.util.createBuffer(a.key);if(0===this.name.indexOf("3DES")&&24!==c.length())throw new Error("Invalid Triple-DES key size: "+8*c.length());this._keys=d(c),this._init=!0}},c("DES-ECB",b.cipher.modes.ecb),c("DES-CBC",b.cipher.modes.cbc),c("DES-CFB",b.cipher.modes.cfb),c("DES-OFB",b.cipher.modes.ofb),c("DES-CTR",b.cipher.modes.ctr),c("3DES-ECB",b.cipher.modes.ecb),c("3DES-CBC",b.cipher.modes.cbc),c("3DES-CFB",b.cipher.modes.cfb),c("3DES-OFB",b.cipher.modes.ofb),c("3DES-CTR",b.cipher.modes.ctr);var g=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],h=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],i=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],j=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],k=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],l=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],m=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],n=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696]}var b="des";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./cipher","./cipherModes","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"rc2");var c=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],d=[1,2,3,5],e=function(a,b){return a<<b&65535|(65535&a)>>16-b},f=function(a,b){return(65535&a)>>b|a<<16-b&65535};b.rc2=b.rc2||{},b.rc2.expandKey=function(a,d){"string"==typeof a&&(a=b.util.createBuffer(a)),d=d||128;var e,f=a,g=a.length(),h=d,i=Math.ceil(h/8),j=255>>(7&h);for(e=g;128>e;e++)f.putByte(c[f.at(e-1)+f.at(e-g)&255]);for(f.setAt(128-i,c[f.at(128-i)&j]),e=127-i;e>=0;e--)f.setAt(e,c[f.at(e+1)^f.at(e+i)]);return f};var g=function(c,g,h){a();var i,j,k,l,m=!1,n=null,o=null,p=null,q=[];for(c=b.rc2.expandKey(c,g),k=0;64>k;k++)q.push(c.getInt16Le());h?(i=function(a){for(k=0;4>k;k++)a[k]+=q[l]+(a[(k+3)%4]&a[(k+2)%4])+(~a[(k+3)%4]&a[(k+1)%4]),a[k]=e(a[k],d[k]),l++},j=function(a){for(k=0;4>k;k++)a[k]+=q[63&a[(k+3)%4]]}):(i=function(a){for(k=3;k>=0;k--)a[k]=f(a[k],d[k]),a[k]-=q[l]+(a[(k+3)%4]&a[(k+2)%4])+(~a[(k+3)%4]&a[(k+1)%4]),l--},j=function(a){for(k=3;k>=0;k--)a[k]-=q[63&a[(k+3)%4]]});var r=function(a){var b=[];for(k=0;4>k;k++){var c=n.getInt16Le();null!==p&&(h?c^=p.getInt16Le():p.putInt16Le(c)),b.push(65535&c)}l=h?0:63;for(var d=0;d<a.length;d++)for(var e=0;e<a[d][0];e++)a[d][1](b);for(k=0;4>k;k++)null!==p&&(h?p.putInt16Le(b[k]):b[k]^=p.getInt16Le()),o.putInt16Le(b[k])},s=null;return s={start:function(a,c){a&&"string"==typeof a&&(a=b.util.createBuffer(a)),m=!1,n=b.util.createBuffer(),o=c||new b.util.createBuffer,p=a,s.output=o},update:function(a){for(m||n.putBuffer(a);n.length()>=8;)r([[5,i],[1,j],[6,i],[1,j],[5,i]])},finish:function(a){var b=!0;if(h)if(a)b=a(8,n,!h);else{var c=8===n.length()?8:8-n.length();n.fillWithByte(c,c)}if(b&&(m=!0,s.update()),!h&&(b=0===n.length()))if(a)b=a(8,o,!h);else{var d=o.length(),e=o.at(d-1);e>d?b=!1:o.truncate(e)}return b}}};b.rc2.startEncrypting=function(a,c,d){var e=b.rc2.createEncryptionCipher(a,128);return e.start(c,d),e},b.rc2.createEncryptionCipher=function(a,b){return g(a,b,!0)},b.rc2.startDecrypting=function(a,c,d){var e=b.rc2.createDecryptionCipher(a,128);return e.start(c,d),e},b.rc2.createDecryptionCipher=function(a,b){return g(a,b,!1)}}var b="rc2";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a,c,d){if(!a.gf){var e=20;if(!a.filter){if(!a.s)throw Error("2");var f=parseInt(a.s.substr(0,2),16),g=f*e+2+e;if(a.s.length!=g)throw Error("3");for(var h=2,i="",j=[],k=0;f>k;k++)j.push(a.s.substr(h,e)),h+=e;var i=a.s.substr(0,h),l=a.s.substr(h,e);h+=e;var m=dreamsecurity.util.bytesToHex(b.intg.create(i));if(l!=m.substr(0,e))throw Error("4");a.s="",a.filter=j}for(var n=d.substr(0,e),k=0;k<a.filter.length;k++)if(a.filter[k]==n)return 0;throw Error("5")}if(new Date>b.vi.na)throw Error("1");a.list||(a.list={},a.tbi={}),a.list[c]=d}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"pki");b.vi={},b.chkIntegrity=function(a,d){var e=b.vi;e.na=new Date(1503652046294);var f=null;f=a.toString(),f=f.replace(/ |\t|\r\n|;/gm,"");var g=dreamsecurity.util.bytesToHex(b.intg.create(f));try{c(e,d,g)}catch(h){var i=new Error("It does not allow the use MagicJS. ("+h.message+")");throw i.type=b.err.license,i}};var d=b.asn1,e=b.pki=b.pki||{},f=e.oids;e.pemToDer=function(a){var c=b.pem.decode(a)[0];if(c.procType&&"ENCRYPTED"===c.procType.type)throw new Error("Could not convert PEM to DER; PEM is encrypted.");return b.util.createBuffer(c.body)};var g=b.pki.algIdValidator=function(a,b,c,e,f){return{name:a,tagClass:d.Class.UNIVERSAL,type:d.Type.SEQUENCE,constructed:!0,value:[{name:b,tagClass:d.Class.UNIVERSAL,type:d.Type.OID,constructed:!1,capture:c},{name:e,tagClass:d.Class.UNIVERSAL,optional:!0,captureAsn1:f}]}},h={name:"PrivateKeyInfo",tagClass:d.Class.UNIVERSAL,type:d.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:d.Class.UNIVERSAL,type:d.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},g("PrivateKeyInfo.privateKeyAlgorithm","AlgorithmIdentifier.algorithm","privateKeyOid","AlgorithmIdentifier.parameter","parameters"),{name:"PrivateKeyInfo",tagClass:d.Class.UNIVERSAL,type:d.Type.OCTETSTRING,constructed:!1,capture:"privateKey"},{name:"PrivateKeyInfo.attributes",tagClass:d.Class.CONTEXT_SPECIFIC,type:0,capture:"priKeyAttributes",optional:!0}]},i=b.pki.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:d.Class.UNIVERSAL,type:d.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[g("SubjectPublicKeyInfo.AlgorithmIdentifier","AlgorithmIdentifier.algorithm","publicKeyOid","AlgorithmIdentifier.parameter","parameters"),{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:d.Class.UNIVERSAL,type:d.Type.BITSTRING,constructed:!1,capture:"publicKey"}]};e.privateKeyFromPem=function(a){var c=b.pem.decode(a)[0];if("PRIVATE KEY"!==c.type&&"RSA PRIVATE KEY"!==c.type&&"KCDSA PRIVATE KEY"!==c.type){var f=new Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY" or "KCDSA PRIVATE KEY".');throw f.headerType=c.type,f}if(c.procType&&"ENCRYPTED"===c.procType.type)throw new Error("Could not convert private key from PEM; PEM is encrypted.");var g=d.fromDer(c.body);return e.privateKeyFromAsn1(g)},e.privateKeyFromAsn1=function(c){a();var g={},i=[];if(!d.validate(c,h,g,i)){var j=new Error("Cannot read private key.");throw j.errors=i,j}c=d.fromDer(b.util.createBuffer(g.privateKey));var k=d.derToOid(g.privateKeyOid),l=null;if(k===f.rsaEncryption)l=e.rsa.privateKeyFromAsn1(c),l.algName="rsa";else if(k===f.kcdsa1)l=e.kcdsa.privateKeyFromAsn1(c,g.parameters),l.algName="kcdsa";else{var j=new Error("Not supported key.key oid="+k);j.errors=i}l.randomNum=null;var m=g.priKeyAttributes;if(void 0!=m&&null!=m)for(var n=0;n<m.length;++n){var o=b.pkcs7.attrFromAsn1(m[n]);if(o.oid===f.randomNum){var p=b.util.createBuffer(o.values[0].value);++p.read,l.randomNum=p.getBytes();break}}return l},e.publicKeyFromAsn1=function(b){a();var c={},g=[];if(!d.validate(b,i,c,g)){var h=new Error("Cannot read public key.");throw h.errors=g,h}b=c.publicKey[0];var j=d.derToOid(c.publicKeyOid),k=null;if(j===f.rsaEncryption)k=e.rsa.publicKeyFromAsn1(b),k.algName="rsa";else if(j===f.kcdsa1)k=e.kcdsa.publicKeyFromAsn1(b,c.parameters),k.algName="kcdsa";else{var h=new Error("Not supported key.key oid="+j);h.errors=g}return k},e.priKeyToPriKeyInfo=function(c){a();var f=null,g=null,h=null;if("rsa"==c.algName)f=b.pki.privateKeyToRSAPrivateKey(c),h=e.oids.rsaEncryption,g=d.create(d.Class.UNIVERSAL,d.Type.NULL,!1,"");else if("kcdsa"==c.algName)f=b.pki.privateKeyToKCDSAPrivateKey(c),h=e.oids.kcdsa1,g=b.pki.toKCDSAParam(c);else{var i=new Error("Not supported key. ("+c.algName+")");i.errors=errors}var j=d.create(d.Class.UNIVERSAL,d.Type.INTEGER,!1,d.integerToDer(0).getBytes()),k=d.create(d.Class.UNIVERSAL,d.Type.SEQUENCE,!0,[d.create(d.Class.UNIVERSAL,d.Type.OID,!1,d.oidToDer(h).getBytes()),g]),l=d.create(d.Class.UNIVERSAL,d.Type.OCTETSTRING,!1,d.toDer(f).getBytes()),m=null;return void 0!=c.randomNum&&null!=c.randomNum?(m=d.create(d.Class.CONTEXT_SPECIFIC,0,!0,[d.create(d.Class.UNIVERSAL,d.Type.SEQUENCE,!0,[d.create(d.Class.UNIVERSAL,d.Type.OID,!1,d.oidToDer(e.oids.randomNum).getBytes()),d.create(d.Class.UNIVERSAL,d.Type.SET,!0,[d.create(d.Class.UNIVERSAL,d.Type.BITSTRING,!1,String.fromCharCode(0)+c.randomNum)])])]),d.create(d.Class.UNIVERSAL,d.Type.SEQUENCE,!0,[j,k,l,m])):d.create(d.Class.UNIVERSAL,d.Type.SEQUENCE,!0,[j,k,l])},e.publicKeyToAsn1=e.publicKeyToSubjectPublicKeyInfo=function(c){a();var f=null,g=null,h=null;if("rsa"==c.algName)f=b.pki.publicKeyToRSAPublicKey(c),h=e.oids.rsaEncryption,g=d.create(d.Class.UNIVERSAL,d.Type.NULL,!1,"");else if("kcdsa"==c.algName)f=b.pki.publicKeyToKCDSAPublicKey(c),h=e.oids.kcdsa1,g=b.pki.toKCDSAParam(c);else{var i=new Error("Not supported key. ("+c.algName+")");i.errors=errors}return d.create(d.Class.UNIVERSAL,d.Type.SEQUENCE,!0,[d.create(d.Class.UNIVERSAL,d.Type.SEQUENCE,!0,[d.create(d.Class.UNIVERSAL,d.Type.OID,!1,d.oidToDer(h).getBytes()),g]),d.create(d.Class.UNIVERSAL,d.Type.BITSTRING,!1,[f])])},e.privateKeyToPem=function(a,c){var f={type:"RSA PRIVATE KEY",body:d.toDer(e.privateKeyToAsn1(a)).getBytes()};return b.pem.encode(f,{maxline:c})},e.privateKeyInfoToPem=function(a,c){var e={type:"PRIVATE KEY",body:d.toDer(a).getBytes()};return b.pem.encode(e,{maxline:c})}}var b="pki";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./oids","./pbe","./pem","./pbkdf2","./pkcs12","./pss","./rsa","./util","./x509"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"pbkdf2");var c=b.pkcs5=b.pkcs5||{};b.pbkdf1=c.pbkdf1=function(c,d,e,f,g){a();var h=0;if("undefined"!=typeof g&&null!==g||(g=b.md.sha1.create()),f>g.digestLength)throw new Error("Derived key is too long.");g.start(),g.update(c),g.update(d);var i=g.digest();for(h=1;e>h;h++)g.start(),g.update(i.getBytes()),i=g.digest();return i.getBytes(f)},b.pbkdf2=c.pbkdf2=function(c,d,e,f,g,h){function i(){return t>m?h(null,s):(o.start(null,null),o.update(d),o.update(b.util.int32ToBytes(t)),p=r=o.digest().getBytes(),u=2,void j())}function j(){return e>=u?(o.start(null,null),o.update(r),q=o.digest().getBytes(),p=b.util.xorBytes(p,q,k),r=q,++u,b.util.setImmediate(j)):(s+=m>t?p:p.substr(0,n),++t,void i())}a(),"function"==typeof g&&(h=g,g=null),"undefined"!=typeof g&&null!==g||(g=b.md.sha1.create());var k=g.digestLength;if(f>4294967295*k){var l=new Error("Derived key is too long.");if(h)return h(l);throw l}var m=Math.ceil(f/k),n=f-(m-1)*k,o=b.hmac.create();o.start(g,c);var p,q,r,s="";if(!h){for(var t=1;m>=t;++t){o.start(null,null),o.update(d),o.update(b.util.int32ToBytes(t)),p=r=o.digest().getBytes();for(var u=2;e>=u;++u)o.start(null,null),o.update(r),q=o.digest().getBytes(),p=b.util.xorBytes(p,q,k),r=q;s+=m>t?p:p.substr(0,n)}return s}var u,t=1;i()}}var b="pbkdf2";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./hmac","./md","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a,b){return a.start().update(b).digest().getBytes()}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"pbe");if("undefined"==typeof d)var d=b.jsbn.BigInteger;var e=b.asn1,f=b.pki=b.pki||{};f.pbe=b.pbe=b.pbe||{};var g=f.oids,h={name:"EncryptedPrivateKeyInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]};f.pbe.encryptedPrivateKeyValidator=h;var i={name:"PBES2Algorithms",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,onstructed:!0,capture:"kdfIterationCount"}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},j={name:"pkcs-12PbeParams",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"iterations"}]};f.pbe.getEncPriKeyInfoForPBES2=function(a,c,d){var f,h,i,j,k,l=b.random.getBytesSync(d.saltSize),m=d.count,n=e.integerToDer(m);switch(d.algorithm){case"aes128":f=16,h=16,j=g["aes128-CBC"],k=b.aes.createEncryptionCipher;break;case"aes192":f=24,h=16,j=g["aes192-CBC"],k=b.aes.createEncryptionCipher;break;case"aes256":f=32,h=16,j=g["aes256-CBC"],k=b.aes.createEncryptionCipher;break;case"des":f=8,h=8,j=g.desCBC,k=b.des.createEncryptionCipher;break;case"seed":f=16,h=16,j=g.seedCBC,k=b.seed.createEncryptionCipher;break;case"aria":case"aria128":f=16,h=16,j=g.ariaCBC,k=b.aria.createEncryptionCipher;break;case"aria192":f=24,h=16,j=g["aria192-CBC"],k=b.aria.createEncryptionCipher;break;case"aria256":f=32,h=16,j=g["aria256-CBC"],k=b.aria.createEncryptionCipher;break;case"des-EDE3":case"3des":f=24,h=8,j=g["des-EDE3-CBC"],k=b.des.createEncryptionCipher;break;default:var o=new Error("Cannot encrypt private key. Unsupported PKCS5 pbe2 encryption algorithm. : "+d.algorithm);throw o.type=b.err.unsupported,o.algorithm=d.algorithm,o}var p=b.pkcs5.pbkdf2(c,l,m,f),q=b.random.getBytesSync(h),r=k(p);return r.start(q),r.update(a),r.finish(),i=r.output.getBytes(),encryptionAlgorithm=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(g.pkcs5PBES2).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(g.pkcs5PBKDF2).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,l),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,n.getBytes())])]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(j).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,q)])])]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[encryptionAlgorithm,e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,i)])},f.pbe.getEncPriKeyInfoForPBES1=function(a,c,d){var g,h,i,j,k,l=b.random.getBytesSync(d.saltSize),m=d.count,n=e.integerToDer(m);switch(d.algorithm){case"seed":g=16,d.fixedIv?(h=0,j=f.oids.seedCBC):(h=16,j=f.oids.seedCBCWithSHA1),k=b.seed.createEncryptionCipher,md=b.md.sha1.create();break;default:var o=new Error("Cannot encrypt private key. Unsupported PKCS5 pbe encryption algorithm. : "+d.algorithm);throw o.type=b.err.unsupported,o.algorithm=d.algorithm,o}var p="",q=null,r=null;if(g+h<=md.digestLength)p=b.pkcs5.pbkdf1(c,l,m,g+h,md),q=p.substr(0,g),r=h>0?p.substr(g,h):"0123456789012345";else{p=b.pkcs5.pbkdf1(c,l,m,md.digestLength,md),q=p.substr(0,g),md.start(),md.update(p.substr(g,md.digestLength-h));var s=md.digest();r=s.getBytes(h)}var t=k(q);return t.start(r),t.update(a),t.finish(),i=t.output.getBytes(),encryptionAlgorithm=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(j).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,l),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,n.getBytes())])]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[encryptionAlgorithm,e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,i)])},_encryptForPKCS12PBE=function(a,c,d,e){if("3des"!==e.algorithm&&"des-EDE3"!==e.algorithm){var g=new Error("Cannot encrypt private key. Unsupported PKCS12 pbe algorithm. : "+e.algorithm);throw g.type=b.err.unsupported,g}var h=e.count,i=24,j=8,k=new b.util.ByteBuffer(d),l=f.pbe.generatePkcs12Key(c,k,1,h,i),m=f.pbe.generatePkcs12Key(c,k,2,h,j),n=b.des.createEncryptionCipher(l);return n.start(m),n.update(a),n.finish(),n.output.getBytes()},_pkcs12PbeAlgToASN1=function(a,b){return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(g["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,a),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(b).getBytes())])])},f.pbe.getEncDataForPKCS12PBE=function(a,c,d){var g=b.random.getBytesSync(d.saltSize),h=_encryptForPKCS12PBE(a,c,g,d),i=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(f.oids.data).getBytes()),_pkcs12PbeAlgToASN1(g,d.count),e.create(e.Class.CONTEXT_SPECIFIC,0,!1,h)]);return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(f.oids.encryptedData).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(0).getBytes()),i])])])},f.pbe.getEncPriKeyInfoForPKCS12PBE=function(a,c,d){var f=b.random.getBytesSync(d.saltSize),g=_encryptForPKCS12PBE(a,c,f,d);return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[_pkcs12PbeAlgToASN1(f,d.count),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,g)])},f.encryptPrivateKeyInfo=function(a,b,c){c=c||{},c.version=c.version||20,c.saltSize=c.saltSize||8,c.count=c.count||20==c.version?2048:1024,c.algorithm=c.algorithm||"aes128";return void 0!==c.usePkcs12&&c.usePkcs12?f.pbe.getEncPriKeyInfoForPKCS12PBE(e.toDer(a),b,c):20==c.version?f.pbe.getEncPriKeyInfoForPBES2(e.toDer(a),b,c):f.pbe.getEncPriKeyInfoForPBES1(e.toDer(a),b,c)},f.encryptDataWithPBE=function(a,b,c){return c.saltSize=c.saltSize||8,c.count=c.count||20==c.version?2048:1024,c.algorithm=c.algorithm||"aes128",f.pbe.getEncDataForPKCS12PBE(e.toDer(a),b,c)},f.decryptPrivateKeyInfo=function(a,c,d){var g=null,i={},j=[];if(!e.validate(a,h,i,j)){var k=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw k.errors=j,k.type=b.err.decode,k}var l=null,m=!1,n=e.derToOid(i.encryptionOid);n==f.oids.pkcs5PBES2?l=20:(l=15,n==f.oids.seedCBC&&(m=!0));var o=f.pbe.getCipher(n,i.encryptionParams,c),p=b.util.createBuffer(i.encryptedData);if(o.update(p),o.finish())try{g=e.fromDer(o.output)}catch(q){throw q.type=b.err.wrongPasswd,q.message="Confirm password.",q}return null!=d&&1==d&&(g={privateKey:g,pbeAlg:"",pkcs5Version:l,fixedIv:m},"AES-CBC"==o.algorithm.name?g.pbeAlg="AES"+8*o.keySize+"-CBC":"ARIA-CBC"==o.algorithm.name?g.pbeAlg="ARIA"+8*o.keySize+"-CBC":g.pbeAlg=o.algorithm.name),
g},f.encryptedPrivateKeyToPem=function(a,c){var d={type:"ENCRYPTED PRIVATE KEY",body:e.toDer(a).getBytes()};return b.pem.encode(d,{maxline:c})},f.encryptedPrivateKeyFromPem=function(a){var c=b.pem.decode(a)[0];if("ENCRYPTED PRIVATE KEY"!==c.type){var d=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw d.headerType=c.type,d}if(c.procType&&"ENCRYPTED"===c.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return e.fromDer(c.body)},f.encryptPrivateKey=function(c,d,g){if(a(),g=g||{},!g.legacy)return rval=f.encryptPrivateKeyInfo(c,d,g),e.toDer(rval);var h,i,j,k;switch(g.algorithm){case"aes128":h="AES-128-CBC",j=16,i=b.random.getBytesSync(16),k=b.aes.createEncryptionCipher;break;case"aes192":h="AES-192-CBC",j=24,i=b.random.getBytesSync(16),k=b.aes.createEncryptionCipher;break;case"aes256":h="AES-256-CBC",j=32,i=b.random.getBytesSync(16),k=b.aes.createEncryptionCipher;break;case"3des":h="DES-EDE3-CBC",j=24,i=b.random.getBytesSync(8),k=b.des.createEncryptionCipher;break;case"des":h="DES-CBC",j=8,i=b.random.getBytesSync(8),k=b.des.createEncryptionCipher;break;default:var l=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+g.algorithm+'".');throw l.algorithm=g.algorithm,l}var m=b.pbe.opensslDeriveBytes(d,i.substr(0,8),j),n=k(m);n.start(i),n.update(e.toDer(f.privateKeyToAsn1(c))),n.finish();var o={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:h,parameters:b.util.bytesToHex(i).toUpperCase()},body:n.output.getBytes()};return b.pem.encode(o)},f.decryptRsaPrivateKey=function(c,d){a();var g=null,h=b.pem.decode(c)[0];if("ENCRYPTED PRIVATE KEY"!==h.type&&"PRIVATE KEY"!==h.type&&"RSA PRIVATE KEY"!==h.type){var i=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw i.headerType=i,i}if(h.procType&&"ENCRYPTED"===h.procType.type){var j,k;switch(h.dekInfo.algorithm){case"DES-CBC":j=8,k=b.des.createDecryptionCipher;break;case"DES-EDE3-CBC":j=24,k=b.des.createDecryptionCipher;break;case"AES-128-CBC":j=16,k=b.aes.createDecryptionCipher;break;case"AES-192-CBC":j=24,k=b.aes.createDecryptionCipher;break;case"AES-256-CBC":j=32,k=b.aes.createDecryptionCipher;break;case"RC2-40-CBC":j=5,k=function(a){return b.rc2.createDecryptionCipher(a,40)};break;case"RC2-64-CBC":j=8,k=function(a){return b.rc2.createDecryptionCipher(a,64)};break;case"RC2-128-CBC":j=16,k=function(a){return b.rc2.createDecryptionCipher(a,128)};break;default:var i=new Error('Could not decrypt private key; unsupported encryption algorithm "'+h.dekInfo.algorithm+'".');throw i.algorithm=h.dekInfo.algorithm,i}var l=b.util.hexToBytes(h.dekInfo.parameters),m=b.pbe.opensslDeriveBytes(d,l.substr(0,8),j),n=k(m);if(n.start(l),n.update(b.util.createBuffer(h.body)),!n.finish())return g;g=n.output.getBytes()}else g=h.body;return g="ENCRYPTED PRIVATE KEY"===h.type?f.decryptPrivateKeyInfo(e.fromDer(g),d):e.fromDer(g),null!==g&&(g=f.privateKeyFromAsn1(g)),g},f.pbe.generatePkcs12Key=function(a,c,d,e,f,g){var h,i;"undefined"!=typeof g&&null!==g||(g=b.md.sha1.create());var j=g.digestLength,k=g.blockLength,l=new b.util.ByteBuffer,m=new b.util.ByteBuffer;if(null!==a&&void 0!==a){if("string"!=typeof a)throw new Error("The password is not a string type.");for(i=0;i<a.length;i++)m.putInt16(a.charCodeAt(i));m.putInt16(0)}var n=m.length(),o=c.length(),p=new b.util.ByteBuffer;p.fillWithByte(d,k);var q=k*Math.ceil(o/k),r=new b.util.ByteBuffer;for(i=0;q>i;i++)r.putByte(c.at(i%o));var s=k*Math.ceil(n/k),t=new b.util.ByteBuffer;for(i=0;s>i;i++)t.putByte(m.at(i%n));var u=r;u.putBuffer(t);for(var v=Math.ceil(f/j),w=1;v>=w;w++){var x=new b.util.ByteBuffer;x.putBytes(p.bytes()),x.putBytes(u.bytes());for(var y=0;e>y;y++)g.start(),g.update(x.getBytes()),x=g.digest();var z=new b.util.ByteBuffer;for(i=0;k>i;i++)z.putByte(x.at(i%j));var A=Math.ceil(o/k)+Math.ceil(n/k),B=new b.util.ByteBuffer;for(h=0;A>h;h++){var C=new b.util.ByteBuffer(u.getBytes(k)),D=511;for(i=z.length()-1;i>=0;i--)D>>=8,D+=z.at(i)+C.at(i),C.setAt(i,255&D);B.putBuffer(C)}u=B,l.putBuffer(x)}return l.truncate(l.length()-f),l},f.pbe.getCipher=function(a,b,c){switch(a){case f.oids.pkcs5PBES2:return f.pbe.getDecCipherForPBES2(a,b,c);case f.oids.seedCBCWithSHA1:case f.oids.seedCBC:return f.pbe.getDecCipherForPBES1(a,b,c);case f.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case f.oids["pbewithSHAAnd40BitRC2-CBC"]:return f.pbe.getDecCipherForPKCS12PBE(a,b,c);default:var d=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw d.oid=a,d.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","seedCBCWithSHA1","pbewithSHAAnd40BitRC2-CBC"],d}},f.pbe.getDecCipherForPBES2=function(a,c,d){var g={},h=[];if(!e.validate(c,i,g,h)){var j=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw j.errors=h,j}if(a=e.derToOid(g.kdfOid),a!==f.oids.pkcs5PBKDF2){var j=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw j.oid=a,j.supportedOids=["pkcs5PBKDF2"],j}a=e.derToOid(g.encOid);var k=g.kdfSalt,l=b.util.createBuffer(g.kdfIterationCount);l=l.getInt(l.length()<<3);var m,n;switch(f.oids[a]){case"aes128-CBC":m=16,n=b.aes.createDecryptionCipher;break;case"aes192-CBC":m=24,n=b.aes.createDecryptionCipher;break;case"aes256-CBC":m=32,n=b.aes.createDecryptionCipher;break;case"des-EDE3-CBC":m=24,n=b.des.createDecryptionCipher;break;case"desCBC":m=8,n=b.des.createDecryptionCipher;break;case"seedCBC":m=16,n=b.seed.createDecryptionCipher;break;case"ariaCBC":case"aria128-CBC":m=16,n=b.aria.createDecryptionCipher;break;case"aria192-CBC":m=24,n=b.aria.createDecryptionCipher;break;case"aria256-CBC":m=32,n=b.aria.createDecryptionCipher;break;default:throw new Error("Cannot read encrypted private key. Unsupported encryption scheme OID. : "+a)}var o=b.pkcs5.pbkdf2(d,k,l,m),p=g.encIv,q=n(o);return q.start(p),q.keySize=m,q},f.pbe.getDecCipherForPBES1=function(a,c,d){var g={},h=[];if(!e.validate(c,j,g,h)){var i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw i.errors=h,i}var k=g.salt,l=b.util.createBuffer(g.iterations);l=l.getInt(l.length()<<3);var m,n,o,p=null;switch(a){case f.oids.seedCBCWithSHA1:m=16,n=16,o=b.seed.startDecrypting,p=b.md.sha1.create();break;case f.oids.seedCBC:m=16,n=0,o=b.seed.startDecrypting,p=b.md.sha1.create();break;default:var i=new Error("Cannot read PBES1 data block. Unsupported OID.");throw i.oid=a,i}var q="",r=null,s=null;if(m+n<=p.digestLength)q=b.pkcs5.pbkdf1(d,k,l,m+n,p),r=q.substr(0,m),s=n>0?q.substr(m,n):"0123456789012345";else{q=b.pkcs5.pbkdf1(d,k,l,p.digestLength,p),r=q.substr(0,m),p.start(),p.update(q.substr(m,p.digestLength-m));var t=p.digest();s=t.getBytes(n)}return o(r,s)},f.pbe.getDecCipherForPKCS12PBE=function(a,c,d){var g={},h=[];if(!e.validate(c,j,g,h)){var i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw i.errors=h,i}var k=b.util.createBuffer(g.salt),l=b.util.createBuffer(g.iterations);l=l.getInt(l.length()<<3);var m,n,o;switch(a){case f.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:m=24,n=8,o=b.des.startDecrypting;break;case f.oids.seedCBCWithSHA1:m=16,n=16,o=b.seed.startDecrypting;break;case f.oids["pbewithSHAAnd40BitRC2-CBC"]:m=5,n=8,o=function(a,c){var d=b.rc2.createDecryptionCipher(a,40);return d.start(c,null),d};break;default:var i=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw i.oid=a,i}var p=f.pbe.generatePkcs12Key(d,k,1,l,m),q=f.pbe.generatePkcs12Key(d,k,2,l,n);return o(p,q)},f.pbe.opensslDeriveBytes=function(a,d,e,f){"undefined"!=typeof f&&null!==f||(f=b.md.md5.create()),null===d&&(d="");for(var g=[c(f,a+d)],h=16,i=1;e>h;++i,h+=16)g.push(c(f,g[i-1]+a+d));return g.join("").substr(0,e)}}var b="pbe";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./asn1","./des","./md","./oids","./pem","./pbkdf2","./random","./rc2","./rsa","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a,b){"string"==typeof b&&(b={shortName:b});for(var c,d=null,e=0;null===d&&e<a.attributes.length;++e)c=a.attributes[e],b.type&&b.type===c.type?d=c:b.name&&b.name===c.name?d=c:b.shortName&&b.shortName===c.shortName&&(d=c);return d}function d(a){var b=k.fromDer(a.value);a.onlyContainsUserCerts=!1,a.onlyContainsCACerts=!1,a.indirectCRL=!1,a.onlyContainsAttributeCerts=!1;for(var c=0;c<b.value.length;++c)switch(b.value[c].type){case 0:a.distributionPoint=[];var d=b.value[c].value[0];if(0==d.type){var e={};l.processGeneralName(d.value[0],e),a.distributionPoint.push(e)}break;case 1:a.onlyContainsUserCerts=0!==b.value[c].value.charCodeAt(0);break;case 2:a.onlyContainsCACerts=0!==b.value[c].value.charCodeAt(0);break;case 3:break;case 4:a.indirectCRL=0!==b.value[c].value.charCodeAt(0);break;case 5:a.onlyContainsAttributeCerts=0!==b.value[c].value.charCodeAt(0)}}function e(a){a.altNames=[];for(var b,c=k.fromDer(a.value),d=0;d<c.value.length;++d){b=c.value[d];var e={type:b.type,value:b.value};a.altNames.push(e),l.processGeneralName(b,e)}}function f(a){for(var c=k.fromDer(a.value),d=0;d<c.value.length;++d)switch(c.value[d].type){case 0:a.keyIdentifier=c.value[d].value;break;case 1:a.authorityCertIssuer={};var e=b.md.sha1.create();a.authorityCertIssuer.attributes=b.pki.RDNAttributesAsArray(c.value[d].value[0].value[0],e);break;case 2:a.authorityCertSerialNumber=c.value[d].value}}function g(a){for(var c,d,e=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[]),f=a.attributes,g=0;g<f.length;++g){c=f[g];var h=c.value,i=k.Type.PRINTABLESTRING;"valueTagClass"in c&&(i=c.valueTagClass,i===k.Type.UTF8&&(h=b.util.encodeUtf8(h))),d=k.create(k.Class.UNIVERSAL,k.Type.SET,!0,[k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(c.type).getBytes()),k.create(k.Class.UNIVERSAL,i,!1,h)])]),e.value.push(d)}return e}function h(a){for(var b,c=0;c<a.length;++c){if(b=a[c],"undefined"==typeof b.name&&(b.type&&b.type in l.oids?b.name=l.oids[b.type]:b.shortName&&b.shortName in n&&(b.name=l.oids[n[b.shortName]])),"undefined"==typeof b.type){if(!(b.name&&b.name in l.oids)){var d=new Error("Attribute type not specified.");throw d.attribute=b,d}b.type=l.oids[b.name]}if("undefined"==typeof b.shortName&&b.name&&b.name in n&&(b.shortName=n[b.name]),b.type===m.extensionRequest&&(b.valueConstructed=!0,b.valueTagClass=k.Type.SEQUENCE,!b.value&&b.extensions)){b.value=[];for(var e=0;e<b.extensions.length;++e)b.value.push(l.certificateExtensionToAsn1(i(b.extensions[e])))}if("undefined"==typeof b.value){var d=new Error("Attribute value not specified.");throw d.attribute=b,d}}}function i(a,c){if(c=c||{},"undefined"==typeof a.name&&a.id&&a.id in l.oids&&(a.name=l.oids[a.id]),"undefined"==typeof a.id){if(!(a.name&&a.name in l.oids)){var d=new Error("Extension ID not specified.");throw d.extension=a,d}a.id=l.oids[a.name]}if("undefined"==typeof a.value){if("keyUsage"===a.name){var e=0,f=0,g=0;a.digitalSignature&&(f|=128,e=7),a.nonRepudiation&&(f|=64,e=6),a.keyEncipherment&&(f|=32,e=5),a.dataEncipherment&&(f|=16,e=4),a.keyAgreement&&(f|=8,e=3),a.keyCertSign&&(f|=4,e=2),a.cRLSign&&(f|=2,e=1),a.encipherOnly&&(f|=1,e=0),a.decipherOnly&&(g|=128,e=7);var h=String.fromCharCode(e);0!==g?h+=String.fromCharCode(f)+String.fromCharCode(g):0!==f&&(h+=String.fromCharCode(f)),a.value=k.create(k.Class.UNIVERSAL,k.Type.BITSTRING,!1,h)}else if("basicConstraints"===a.name)a.value=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[]),a.cA&&a.value.value.push(k.create(k.Class.UNIVERSAL,k.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in a&&a.value.value.push(k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,k.integerToDer(a.pathLenConstraint).getBytes()));else if("extKeyUsage"===a.name){a.value=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[]);var i=a.value.value;for(var j in a)a[j]===!0&&(j in m?i.push(k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(m[j]).getBytes())):-1!==j.indexOf(".")&&i.push(k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(j).getBytes())))}else if("nsCertType"===a.name){var e=0,f=0;a.client&&(f|=128,e=7),a.server&&(f|=64,e=6),a.email&&(f|=32,e=5),a.objsign&&(f|=16,e=4),a.reserved&&(f|=8,e=3),a.sslCA&&(f|=4,e=2),a.emailCA&&(f|=2,e=1),a.objCA&&(f|=1,e=0);var h=String.fromCharCode(e);0!==f&&(h+=String.fromCharCode(f)),a.value=k.create(k.Class.UNIVERSAL,k.Type.BITSTRING,!1,h)}else if("subjectAltName"===a.name||"issuerAltName"===a.name){a.value=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[]);for(var n,o=0;o<a.altNames.length;++o){n=a.altNames[o];var h=n.value;if(7===n.type&&n.ip){if(h=b.util.bytesFromIP(n.ip),null===h){var d=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw d.extension=a,d}}else 8===n.type&&(h=n.oid?k.oidToDer(k.oidToDer(n.oid)):k.oidToDer(h));a.value.value.push(k.create(k.Class.CONTEXT_SPECIFIC,n.type,!1,h))}}else if("subjectKeyIdentifier"===a.name&&c.cert){var p=c.cert.generateSubjectKeyIdentifier();a.subjectKeyIdentifier=p.toHex(),a.value=k.create(k.Class.UNIVERSAL,k.Type.OCTETSTRING,!1,p.getBytes())}if("undefined"==typeof a.value){var d=new Error("Extension value not specified.");throw d.extension=a,d}return a}}function j(a){var c=k.create(k.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===a.attributes.length)return c;for(var d=a.attributes,e=0;e<d.length;++e){var f=d[e],g=f.value,h=k.Type.UTF8;"valueTagClass"in f&&(h=f.valueTagClass),h===k.Type.UTF8&&(g=b.util.encodeUtf8(g));var i=!1;"valueConstructed"in f&&(i=f.valueConstructed);var j=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(f.type).getBytes()),k.create(k.Class.UNIVERSAL,k.Type.SET,!0,[k.create(k.Class.UNIVERSAL,h,i,g)])]);c.value.push(j)}return c}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"x509");var k=b.asn1,l=b.pki=b.pki||{},m=l.oids,n={};n.CN=m.commonName,n.commonName="CN",n.C=m.countryName,n.countryName="C",n.L=m.localityName,n.localityName="L",n.ST=m.stateOrProvinceName,n.stateOrProvinceName="ST",n.O=m.organizationName,n.organizationName="O",n.OU=m.organizationalUnitName,n.organizationalUnitName="OU",n.E=m.emailAddress,n.emailAddress="E";var o=b.pki.publicKeyValidator,p=b.pki.algIdValidator,q={name:"Certificate",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:k.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},p("Certificate.TBSCertificate.signature","Certificate.TBSCertificate.signature.algorithm","certinfoSignatureOid","Certificate.TBSCertificate.signature.parameters","certinfoSignatureParams"),{name:"Certificate.TBSCertificate.issuer",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:k.Class.UNIVERSAL,type:k.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:k.Class.UNIVERSAL,type:k.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:k.Class.UNIVERSAL,type:k.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:k.Class.UNIVERSAL,type:k.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},o,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:k.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:k.Class.UNIVERSAL,type:k.Type.BITSTRING,constructed:!1,capture:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:k.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:k.Class.UNIVERSAL,type:k.Type.BITSTRING,constructed:!1,capture:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:k.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},p("Certificate.signatureAlgorithm","Certificate.signatureAlgorithm.algorithm","certSignatureOid","Certificate.TBSCertificate.signature.parameters","certSignatureParams"),{name:"Certificate.signatureValue",tagClass:k.Class.UNIVERSAL,type:k.Type.BITSTRING,constructed:!1,capture:"certSignature"}]},r={name:"CertificateList",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"CertificateList.TBSCertList",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertList",value:[{name:"CertificateList.TBSCertList.version",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,capture:"crlVersion"},p("CertificateList.TBSCertList.signature","CertificateList.TBSCertList.signature.algorithm","crlSignatureOid","CertificateList.TBSCertList.signature.parameters","crlSignatureParams"),{name:"CertificateList.TBSCertList.issuer",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,captureAsn1:"crlIssuer"},{name:"CertificateList.TBSCertList.thisTime (utc)",tagClass:k.Class.UNIVERSAL,type:k.Type.UTCTIME,constructed:!1,optional:!0,capture:"thisUpdate_utcTime"},{name:"CertificateList.TBSCertList.thisTime (generalizedTime)",tagClass:k.Class.UNIVERSAL,type:k.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"thisUpdate_generalizedTime"},{name:"CertificateList.TBSCertList.nextTime (utc)",tagClass:k.Class.UNIVERSAL,type:k.Type.UTCTIME,constructed:!1,optional:!0,capture:"nextUpdate_utcTime"},{name:"CertificateList.TBSCertList.nextTime (generalizedTime)",tagClass:k.Class.UNIVERSAL,type:k.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"nextUpdate_generalizedTime"},{name:"CertificateList.TBSCertList.revokedCertificates",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"revokedCertificates"},{name:"CertificateList.TBSCertList.extensions",tagClass:k.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"crlExtensions"}]},{name:"CertificateList.signatureAlgorithm",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"CertificateList.signatureAlgorithm.algorithm",tagClass:k.Class.UNIVERSAL,type:k.Type.OID,constructed:!1,capture:"crlSignatureOid"},{name:"CertificateList.signatureAlgorithm.parameters",tagClass:k.Class.UNIVERSAL,optional:!0,captureAsn1:"crlSignatureParams"}]},{name:"CertificateList.signatureValue",tagClass:k.Class.UNIVERSAL,type:k.Type.BITSTRING,constructed:!1,capture:"signatureValue"}]},s={name:"rsapss",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:k.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:k.Class.UNIVERSAL,type:k.Class.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:k.Class.UNIVERSAL,type:k.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:k.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:k.Class.UNIVERSAL,type:k.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:k.Class.UNIVERSAL,type:k.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:k.Class.UNIVERSAL,type:k.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:k.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:k.Class.UNIVERSAL,type:k.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:k.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:k.Class.UNIVERSAL,type:k.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},t={name:"CertificationRequestInfo",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},o,{name:"CertificationRequestInfo.attributes",tagClass:k.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:k.Class.UNIVERSAL,type:k.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:k.Class.UNIVERSAL,type:k.Type.SET,constructed:!0}]}]}]},u={name:"CertificationRequest",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[t,p("CertificationRequest.signatureAlgorithm","CertificationRequest.signatureAlgorithm.algorithm","csrSignatureOid","CertificationRequest.signatureAlgorithm.parameters","csrSignatureParams"),{name:"CertificationRequest.signature",tagClass:k.Class.UNIVERSAL,type:k.Type.BITSTRING,constructed:!1,capture:"csrSignature"}]};l.RDNAttributesAsArray=function(a,b){for(var c,d,e,f=[],g=0;g<a.value.length;++g){c=a.value[g];for(var h=0;h<c.value.length;++h)e={},d=c.value[h],e.type=k.derToOid(d.value[0].value),e.value=d.value[1].value,e.valueTagClass=d.value[1].type,e.type in m&&(e.name=m[e.type],e.name in n&&(e.shortName=n[e.name])),b&&(b.update(e.type),b.update(e.value)),f.push(e)}return f},l.CRIAttributesAsArray=function(a){for(var b=[],c=0;c<a.length;++c)for(var d=a[c],e=k.derToOid(d.value[0].value),f=d.value[1].value,g=0;g<f.length;++g){var h={};if(h.type=e,h.value=f[g].value,h.valueTagClass=f[g].type,h.type in m&&(h.name=m[h.type],h.name in n&&(h.shortName=n[h.name])),h.type===m.extensionRequest){h.extensions=[];for(var i=0;i<h.value.length;++i)h.extensions.push(l.certificateExtensionFromAsn1(h.value[i]))}b.push(h)}return b},l.processGeneralName=function(a,c){switch(a.type){case 0:if(k.derToOid(a.value[0].value)==b.pki.oids.kisa_identifyData){c.otherName={};var d=a.value[1].value[0].value;if(c.otherName.realName=b.util.decodeUtf8(d[0].value),2==d.length)for(var e=0;e<d[1].value.length;e++){var f=d[1].value[e].value;if(k.derToOid(f[0].value)==b.pki.oids.VID){var g=f[1].value;c.otherName.vid={},c.otherName.vid.hashAlg=b.pki.oids[k.derToOid(g[0].value[0].value)],c.otherName.vid.value=b.util.createBuffer(g[1].value[0].value)}else if(k.derToOid(f[0].value)==b.pki.oids.kiec_hashedIDNInfo){var h=f[1].value;c.otherName.hashedIdn={},c.otherName.hashedIdn.hashAlg=b.pki.oids[k.derToOid(h[0].value[0].value)],c.otherName.hashedIdn.value=b.util.createBuffer(h[1].value)}}}break;case 1:break;case 2:break;case 4:var i=b.md.sha1.create();c.dn={},c.dn.attributes=l.RDNAttributesAsArray(a.value[0],i),c.dn.hash=i.digest().toHex();break;case 6:c.uri=a.value;break;case 7:c.ip=b.util.bytesToIP(a.value);break;case 8:c.oid=k.derToOid(a.value)}},l.processCertPolicies=function(a){for(var c=[],d=0;d<a.value.length;++d){var e={},f=a.value[d].value;if(e.policyIdentifier=k.derToOid(f[0].value),2==f.length){e.policyQualifiers={};for(var g=f[1].value,h=0;h<g.length;h++){var i=g[h].value,j=k.derToOid(i[0].value);if(j===b.pki.oids.cps)e.cps=i[1].value;else if(j===b.pki.oids.unotice){e.unotice={};var l=i[1].value.length,m=0;if(l>0&&i[1].value[m].type===k.Type.SEQUENCE){var n=i[1].value[m].value;n[0].type===k.Type.UTF8?e.unotice.organization=b.util.decodeUtf8(n[0].value):e.unotice.organization=n[0].value;n.length>1,l--,m++}if(l>0){var o=i[1].value[m];o.type===k.Type.UTF8?e.unotice.explicitText=b.util.decodeUtf8(o.value):e.unotice.explicitText=o.value}}}}return c.push(e),c}},l.readSignatureParameters=function(a,b,c){var d={},e={},f=[];if(a===m.RSASSA_PSS){if(c&&(d={hash:{algorithmOid:m.sha1},mgf:{algorithmOid:m.mgf1,hash:{algorithmOid:m.sha1}},saltLength:20}),!k.validate(b,s,e,f)){var g=new Error("Cannot read RSASSA-PSS parameter block.");throw g.errors=f,g}void 0!==e.hashOid&&(d.hash=d.hash||{},d.hash.algorithmOid=k.derToOid(e.hashOid)),void 0!==e.maskGenOid&&(d.mgf=d.mgf||{},d.mgf.algorithmOid=k.derToOid(e.maskGenOid),d.mgf.hash=d.mgf.hash||{},d.mgf.hash.algorithmOid=k.derToOid(e.maskGenHashOid)),void 0!==e.saltLength&&(d.saltLength=e.saltLength.charCodeAt(0))}else a==m.kcdsa1&&(d.domainParam=l.kcdsa.domainParamFromAsn1(b));return d},l.verifySignature=function(a,c,d,e,f,g){var h;switch(a){case m.RSASSA_PSS:var i,j,k;if(i=m[c.mgf.hash.algorithmOid],void 0===i||void 0===b.md[i]){var l=new Error("Unsupported MGF hash function.");throw l.oid=c.mgf.hash.algorithmOid,l.name=i,l}if(j=m[c.mgf.algorithmOid],void 0===j||void 0===b.mgf[j]){var l=new Error("Unsupported MGF function.");throw l.oid=c.mgf.algorithmOid,l.name=j,l}if(j=b.mgf[j].create(b.md[i].create()),i=m[c.hash.algorithmOid],void 0===i||void 0===b.md[i]){var l=new Error("Unsupported RSASSA-PSS hash function.");throw l.oid=c.hash.algorithmOid,l.name=i,l}i=b.md[i].create(),k=c.saltLength,20===k&&(k=i.digestLength),h=b.pss.create(i,j,k);break;case m.sha1WithRSAEncryption:case m.sha256WithRSAEncryption:case m.sha384WithRSAEncryption:case m.sha512WithRSAEncryption:case m.rsaEncryption:case m.kcdsa1:case m.kcdsa1WithSHA1:case m.kcdsa1WithSHA256:break;default:var l=new Error("Unsupported signature algorithm.");throw l.oid=a,l}return"rsa"==e.algName?(d.start(),d.update(f),e.verify(d.digest().getBytes(),g,h)):"kcdsa"==e.algName?e.verify(f,d.algorithm,g):void 0};var v=function(a){switch(a){case m.sha1WithRSAEncryption:return b.md.sha1.create();case m.md5WithRSAEncryption:return b.md.md5.create();case m.sha256WithRSAEncryption:return b.md.sha256.create();case m.RSASSA_PSS:return b.md.sha256.create()}var c=new Error("Unknown signature oid("+a+")");throw c.signatureOid=a,c};l.certificateFromPem=function(a,c,d){var e=b.pem.decode(a)[0];if("CERTIFICATE"!==e.type&&"X509 CERTIFICATE"!==e.type&&"TRUSTED CERTIFICATE"!==e.type){var f=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw f.headerType=e.type,f}if(e.procType&&"ENCRYPTED"===e.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var g=k.fromDer(e.body,d);return l.certificateFromAsn1(g,c)},l.certificateToPem=function(a,c){var d={type:"CERTIFICATE",body:k.toDer(l.certificateToAsn1(a)).getBytes()};return b.pem.encode(d,{maxline:c})},l.publicKeyFromPem=function(a){var c=b.pem.decode(a)[0];if("PUBLIC KEY"!==c.type&&"RSA PUBLIC KEY"!==c.type){var d=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw d.headerType=c.type,d}if(c.procType&&"ENCRYPTED"===c.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");var e=k.fromDer(c.body);return l.publicKeyFromAsn1(e)},l.publicKeyToPem=function(a,c){var d={type:"PUBLIC KEY",body:k.toDer(l.publicKeyToAsn1(a)).getBytes()};return b.pem.encode(d,{maxline:c})},l.publicKeyToRSAPublicKeyPem=function(a,c){var d={type:"RSA PUBLIC KEY",body:k.toDer(l.publicKeyToRSAPublicKey(a)).getBytes()};return b.pem.encode(d,{maxline:c})},l.getPublicKeyFingerprint=function(a,c){c=c||{};var d,e=c.md||b.md.sha1.create(),f=c.type||"RSAPublicKey";switch(f){case"RSAPublicKey":d=k.toDer(l.publicKeyToRSAPublicKey(a)).getBytes();break;case"SubjectPublicKeyInfo":d=k.toDer(l.publicKeyToAsn1(a)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+c.type+'".')}e.start(),e.update(d);var g=e.digest();if("hex"===c.encoding){var h=g.toHex();return c.delimiter?h.match(/.{2}/g).join(c.delimiter):h}if("binary"===c.encoding)return g.getBytes();if(c.encoding)throw new Error('Unknown encoding "'+c.encoding+'".');return g},l.certificationRequestFromPem=function(a,c,d){var e=b.pem.decode(a)[0];if("CERTIFICATE REQUEST"!==e.type){var f=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw f.headerType=e.type,f}if(e.procType&&"ENCRYPTED"===e.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var g=k.fromDer(e.body,d);return l.certificationRequestFromAsn1(g,c)},l.certificationRequestToPem=function(a,c){var d={type:"CERTIFICATE REQUEST",body:k.toDer(l.certificationRequestToAsn1(a)).getBytes()};return b.pem.encode(d,{maxline:c})},l.createCertificate=function(){var a={};return a.version=2,a.serialNumber="00",a.signatureOid=null,a.signature=null,a.siginfo={},a.siginfo.algorithmOid=null,a.validity={},a.validity.notBefore=new Date,a.validity.notAfter=new Date,a.issuer={},a.issuer.getField=function(b){return c(a.issuer,b)},a.issuer.addField=function(b){h([b]),a.issuer.attributes.push(b)},a.issuer.attributes=[],a.issuer.hash=null,a.subject={},a.subject.getField=function(b){return c(a.subject,b)},a.subject.addField=function(b){h([b]),a.subject.attributes.push(b)},a.subject.attributes=[],a.subject.hash=null,a.extensions=[],a.publicKey=null,a.md=null,a.setSubject=function(b,c){h(b),a.subject.attributes=b,delete a.subject.uniqueId,c&&(a.subject.uniqueId=c),a.subject.hash=null},a.setIssuer=function(b,c){h(b),a.issuer.attributes=b,delete a.issuer.uniqueId,c&&(a.issuer.uniqueId=c),a.issuer.hash=null},a.setExtensions=function(b){for(var c=0;c<b.length;++c)i(b[c],{cert:a});a.extensions=b},a.getExtension=function(b){"string"==typeof b&&(b={name:b});for(var c,d=null,e=0;null===d&&e<a.extensions.length;++e)c=a.extensions[e],b.id&&c.id===b.id?d=c:b.name&&c.name===b.name&&(d=c);return d},a.sign=function(c,d){a.md=d||b.md.sha1.create();var e=m[a.md.algorithm+"WithRSAEncryption"];if(!e){var f=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw f.algorithm=a.md.algorithm,f}a.signatureOid=a.siginfo.algorithmOid=e,a.tbsCertificate=l.getTBSCertificate(a);var g=k.toDer(a.tbsCertificate);a.md.update(g.getBytes()),a.signature=c.sign(a.md)},a.verify=function(c){var d=!1;if(!a.issued(c)){var e=c.issuer,f=a.subject,g=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");
throw g.expectedIssuer=e.attributes,g.actualIssuer=f.attributes,g}var h=c.md;if(null===h){if(c.signatureOid in m){var i=m[c.signatureOid];switch(i){case"sha1WithRSAEncryption":h=b.md.sha1.create();break;case"md5WithRSAEncryption":h=b.md.md5.create();break;case"sha256WithRSAEncryption":h=b.md.sha256.create();break;case"RSASSA_PSS":h=b.md.sha256.create()}}if(null===h){var g=new Error("Could not compute certificate digest. Unknown signature OID.");throw g.signatureOid=c.signatureOid,g}var j=c.tbsCertificate||l.getTBSCertificate(c)}return null!==h&&(d=l.verifySignature(c.signatureOid,c.signatureParameters,h,a.publicKey,k.toDer(j).getBytes(),c.signature)),d},a.isIssuer=function(b){var c=!1,d=a.issuer,e=b.subject;if(d.hash&&e.hash)c=d.hash===e.hash;else if(d.attributes.length===e.attributes.length){c=!0;for(var f,g,h=0;c&&h<d.attributes.length;++h)f=d.attributes[h],g=e.attributes[h],f.type===g.type&&f.value===g.value||(c=!1)}return c},a.issued=function(b){return b.isIssuer(a)},a.generateSubjectKeyIdentifier=function(){return l.getPublicKeyFingerprint(a.publicKey,{type:"RSAPublicKey"})},a.verifySubjectKeyIdentifier=function(){for(var c=m.subjectKeyIdentifier,d=0;d<a.extensions.length;++d){var e=a.extensions[d];if(e.id===c){var f=a.generateSubjectKeyIdentifier().getBytes();return b.util.hexToBytes(e.subjectKeyIdentifier)===f}}return!1},a},l.certificateFromAsn1=function(d,e){a();var f={},g=[];if(!k.validate(d,q,f,g)){var i=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw i.errors=g,i}if("string"!=typeof f.certSignature){for(var j="\x00",n=0;n<f.certSignature.length;++n)j+=k.toDer(f.certSignature[n]).getBytes();f.certSignature=j}var o=k.derToOid(f.publicKeyOid);if(o!==l.oids.rsaEncryption&&o!==l.oids.kcdsa1)throw new Error("Cannot read public key. OID is unknown.");var p=l.createCertificate();p.version=f.certVersion?f.certVersion.charCodeAt(0):0;var r=b.util.createBuffer(f.certSerialNumber);p.serialNumber=r.toHex(),p.signatureOid=b.asn1.derToOid(f.certSignatureOid),p.signatureParameters=b.pki.readSignatureParameters(p.signatureOid,f.certSignatureParams,!0),p.siginfo.algorithmOid=b.asn1.derToOid(f.certinfoSignatureOid),p.siginfo.parameters=b.pki.readSignatureParameters(p.siginfo.algorithmOid,f.certinfoSignatureParams,!1);var s=b.util.createBuffer(f.certSignature);++s.read,p.signature=s.getBytes();var t=[];if(void 0!==f.certValidity1UTCTime&&t.push(k.utcTimeToDate(f.certValidity1UTCTime)),void 0!==f.certValidity2GeneralizedTime&&t.push(k.generalizedTimeToDate(f.certValidity2GeneralizedTime)),void 0!==f.certValidity3UTCTime&&t.push(k.utcTimeToDate(f.certValidity3UTCTime)),void 0!==f.certValidity4GeneralizedTime&&t.push(k.generalizedTimeToDate(f.certValidity4GeneralizedTime)),t.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(t.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(p.validity.notBefore=t[0],p.validity.notAfter=t[1],p.tbsCertificate=f.tbsCertificate,e){if(p.md=null,p.signatureOid in m){var o=m[p.signatureOid];switch(o){case"sha1WithRSAEncryption":p.md=b.md.sha1.create();break;case"md5WithRSAEncryption":p.md=b.md.md5.create();break;case"sha256WithRSAEncryption":p.md=b.md.sha256.create();break;case"RSASSA_PSS":p.md=b.md.sha256.create()}}if(null===p.md){var i=new Error("Could not compute certificate digest. Unknown signature OID.");throw i.signatureOid=p.signatureOid,i}var u=k.toDer(p.tbsCertificate);p.md.update(u.getBytes())}var v=b.md.sha1.create();p.issuer.getField=function(a){return c(p.issuer,a)},p.issuer.addField=function(a){h([a]),p.issuer.attributes.push(a)},p.issuer.attributes=l.RDNAttributesAsArray(f.certIssuer,v),f.certIssuerUniqueId&&(p.issuer.uniqueId=f.certIssuerUniqueId),p.issuer.hash=v.digest().toHex();var w=b.md.sha1.create();return p.subject.getField=function(a){return c(p.subject,a)},p.subject.addField=function(a){h([a]),p.subject.attributes.push(a)},p.subject.attributes=l.RDNAttributesAsArray(f.certSubject,w),f.certSubjectUniqueId&&(p.subject.uniqueId=f.certSubjectUniqueId),p.subject.hash=w.digest().toHex(),f.certExtensions?p.extensions=l.certificateExtensionsFromAsn1(f.certExtensions):p.extensions=[],p.publicKey=l.publicKeyFromAsn1(f.subjectPublicKeyInfo),p},l.certificateExtensionsFromAsn1=function(a){for(var b=[],c=0;c<a.value.length;++c)for(var d=a.value[c],e=0;e<d.value.length;++e)b.push(l.certificateExtensionFromAsn1(d.value[e]));return b},l.certificateExtensionFromAsn1=function(a){var c={};if(c.id=k.derToOid(a.value[0].value),c.critical=!1,a.value[1].type===k.Type.BOOLEAN?(c.critical=0!==a.value[1].value.charCodeAt(0),c.value=a.value[2].value):c.value=a.value[1].value,c.id in m)if(c.name=m[c.id],"keyUsage"===c.name){var d=k.fromDer(c.value),g=0,h=0;d.value.length>1&&(g=d.value.charCodeAt(1),h=d.value.length>2?d.value.charCodeAt(2):0),c.digitalSignature=128===(128&g),c.nonRepudiation=64===(64&g),c.keyEncipherment=32===(32&g),c.dataEncipherment=16===(16&g),c.keyAgreement=8===(8&g),c.keyCertSign=4===(4&g),c.cRLSign=2===(2&g),c.encipherOnly=1===(1&g),c.decipherOnly=128===(128&h)}else if("basicConstraints"===c.name){var d=k.fromDer(c.value);d.value.length>0&&d.value[0].type===k.Type.BOOLEAN?c.cA=0!==d.value[0].value.charCodeAt(0):c.cA=!1;var i=null;d.value.length>0&&d.value[0].type===k.Type.INTEGER?i=d.value[0].value:d.value.length>1&&(i=d.value[1].value),null!==i&&(c.pathLenConstraint=k.derToInteger(i))}else if("extKeyUsage"===c.name)for(var d=k.fromDer(c.value),j=0;j<d.value.length;++j){var n=k.derToOid(d.value[j].value);n in m?c[m[n]]=!0:c[n]=!0}else if("nsCertType"===c.name){var d=k.fromDer(c.value),g=0;d.value.length>1&&(g=d.value.charCodeAt(1)),c.client=128===(128&g),c.server=64===(64&g),c.email=32===(32&g),c.objsign=16===(16&g),c.reserved=8===(8&g),c.sslCA=4===(4&g),c.emailCA=2===(2&g),c.objCA=1===(1&g)}else if("subjectAltName"===c.name||"issuerAltName"===c.name)e(c);else if("subjectKeyIdentifier"===c.name){var d=k.fromDer(c.value);c.subjectKeyIdentifier=b.util.bytesToHex(d.value)}else if("authorityKeyIdentifier"===c.name)f(c);else if("certificatePolicies"===c.name)c.certificatePolicies=l.processCertPolicies(k.fromDer(c.value));else if("policyConstraints"===c.name){var d=k.fromDer(c.value);c.policyConstraints={};for(var o=0;o<d.value.length;++o)switch(d.value[o].type){case 0:c.policyConstraints.requireExplicitPolicy=k.derToInteger(d.value[o].value);break;case 1:c.policyConstraints.inhibitPolicyMapping=k.derToInteger(d.value[o].value)}}else if("cRLDistributionPoints"===c.name){var d=k.fromDer(c.value);c.cRLDistributionPoints=[];for(var p={},o=0;o<d.value.length;++o){for(var q=d.value[o].value,r=0;r<q.length;r++)switch(q[r].type){case 0:p.distributionPoint=[];var s=q[r].value[0];if(0==s.type){var t={};l.processGeneralName(s.value[0],t),p.distributionPoint.push(t)}break;case 1:break;case 2:}c.cRLDistributionPoints.push(p)}}else if("authorityInfoAccess"===c.name){var d=k.fromDer(c.value);c.authorityInfoAccess={};for(var o=0;o<d.value.length;++o){var u=d.value[o],v=k.derToOid(u.value[0].value);v==b.pki.oids.ad_ocsp?(c.authorityInfoAccess.ocsp={},l.processGeneralName(u.value[1],c.authorityInfoAccess.ocsp)):v==b.pki.oids.ad_caIssuers&&(c.authorityInfoAccess.caIssuers={},l.processGeneralName(u.value[1],c.authorityInfoAccess.caIssuers))}}return c},l.certificateRevocationListFromPem=function(a,c){var d=b.pem.decode(a)[0];if("X509 CRL"!==d.type){var e=new Error('Could not convert certificate revocation list from PEM; PEM header type is not "X509 CRL".');throw e.headerType=d.type,e}if(d.procType&&"ENCRYPTED"===d.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var f=k.fromDer(d.body);return l.certificateRevocationListFromAsn1(f,c)},l.createCertificateRevocationList=function(){var a={};return a.version=1,a.signatureOid=null,a.signatureParam=null,a.signature=null,a.thisUpdate=null,a.nextUpdate=null,a.issuer={},a.issuer.attributes=[],a.issuer.hash=null,a.extensions=[],a.verify=function(c){var d=!1;if(!a.isIssuer(c)){var e=a.issuer,f=c.subject,g=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw g.expectedIssuer=e.attributes,g.actualIssuer=f.attributes,g}md=v(a.signatureOid),d=b.pki.verifySignature(a.signatureOid,a.signatureParam,md,c.publicKey,k.toDer(a.tbsCertList).getBytes(),a.signature);var h=new Date;if(h>a.nextUpdate){var g=new Error("The crl has expired. current : "+h+", expiredDate : "+a.nextUpdate);throw g.type=b.err.expired,g}if(h<a.thisUpdate)throw new Error("The crl is not valid yet. cuurent : "+h+", validDate : "+a.thisUpdate);return d},a.isRevoked=function(b){for(var c=[],d=0;d<a.revokedCertsAsn1.value.length;d++)if(c=l.revokedCertFromAsn1(a.revokedCertsAsn1.value[d],b.toLowerCase()),null!==c){for(var d=0;d<c.exts.length;d++)if(void 0!==c.exts[d].cRLReason)return{revocationDate:c.revocationDate,reasonCode:c.exts[d].cRLReason};return{revocationDate:c.revocationDate,reasonCode:0}}return null},a.isIssuer=function(b){var c=!1,d=a.issuer,e=b.subject;if(d.hash&&e.hash)c=d.hash===e.hash;else if(d.attributes.length===e.attributes.length){c=!0;for(var f,g,h=0;c&&h<d.attributes.length;++h)f=d.attributes[h],g=e.attributes[h],f.type===g.type&&f.value===g.value||(c=!1)}return c},a},l.certificateRevocationListFromAsn1=function(c,d){a();var e={},f=[];if(!k.validate(c,r,e,f)){var g=new Error("Cannot read X.509 certificate revocation list. ASN.1 object is not an X509v2 Certificate Revocation List.");throw g.errors=f,g}if("string"!=typeof e.signatureValue){for(var h="\x00",i=0;i<e.signatureValue.length;++i)h+=k.toDer(e.signatureValue[i]).getBytes();e.signatureValue=h}var j=l.createCertificateRevocationList();j.version=e.crlVersion?e.crlVersion.charCodeAt(0):0,j.signatureOid=b.asn1.derToOid(e.crlSignatureOid),j.signatureParam=b.pki.readSignatureParameters(j.signatureOid,e.crlSignatureParams,!0);var m=b.util.createBuffer(e.signatureValue);++m.read,j.signature=m.getBytes();var n=b.md.sha1.create();return j.issuer.attributes=l.RDNAttributesAsArray(e.crlIssuer,n),j.issuer.hash=n.digest().toHex(),void 0!==e.thisUpdate_utcTime&&(j.thisUpdate=k.utcTimeToDate(e.thisUpdate_utcTime)),void 0!==e.thisUpdate_generalizedTime&&(j.thisUpdate=k.generalizedTimeToDate(e.thisUpdate_generalizedTime)),void 0!==e.nextUpdate_utcTime&&(j.nextUpdate=k.utcTimeToDate(e.nextUpdate_utcTime)),void 0!==e.nextUpdate_generalizedTime&&(j.nextUpdate=k.generalizedTimeToDate(e.nextUpdate_generalizedTime)),j.tbsCertList=e.tbsCertList,j.revokedCertsAsn1=e.revokedCertificates,e.crlExtensions?j.extensions=l.crlExtensionsFromAsn1(e.crlExtensions):j.extensions=[],j},l.crlExtensionsFromAsn1=function(a){for(var b=[],c=0;c<a.value.length;++c)for(var d=a.value[c],e=0;e<d.value.length;++e)b.push(l.crlExtensionFromAsn1(d.value[e]));return b},l.revokedCertificatesFromAsn1=function(a){for(var b=[],c=0;c<a.value.length;c++)b.push(l.revokedCertFromAsn1(a.value[c]));return b},l.revokedCertFromAsn1=function(a,c){var d={},e=a.value[0];if(e.type!=k.Type.INTEGER)throw new Error("Wrong revoked certificates in CRL.");if(d.userCertificate=b.util.createBuffer(e.value).toHex(),void 0!==c&&null!==c&&d.userCertificate!==c)return null;var f=a.value[1];if(f.type==k.Type.UTCTIME)d.revocationDate=k.utcTimeToDate(f.value);else{if(f.type!=k.Type.GENERALIZEDTIME)throw new Error("Wrong revoked certificates in CRL.");d.revocationDate=k.generalizedTimeToDate(f.value)}if(d.exts=[],3===a.value.length)for(var g=a.value[2],h=0;h<g.value.length;h++)d.exts.push(l.crlExtensionFromAsn1(g.value[h]));return d},l.crlExtensionFromAsn1=function(a){var b={};if(b.id=k.derToOid(a.value[0].value),b.critical=!1,a.value[1].type===k.Type.BOOLEAN?(b.critical=0!==a.value[1].value.charCodeAt(0),b.value=a.value[2].value):b.value=a.value[1].value,b.id in m)if(b.name=m[b.id],"authorityKeyIdentifier"===b.name)f(b);else if("issuerAltName"===b.name)e(b);else if("cRLNumber"===b.name){var c=k.fromDer(b.value);b.cRLNumber=k.derToInteger(c.value)}else if("issuingDistributionPoint"===b.name)d(b);else if("cRLReason"===b.name){var c=k.fromDer(b.value);b.cRLReason=k.derToInteger(c.value)}else if("invalidityDate"===b.name){var c=k.fromDer(b.value);b.invalidityDate=k.generalizedTimeToDate(c.value)}return b},l.certificationRequestFromAsn1=function(d,e){a();var f={},g=[];if(!k.validate(d,u,f,g)){var i=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw i.errors=g,i}if("string"!=typeof f.csrSignature){for(var j="\x00",n=0;n<f.csrSignature.length;++n)j+=k.toDer(f.csrSignature[n]).getBytes();f.csrSignature=j}var o=k.derToOid(f.publicKeyOid);if(o!==l.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var p=l.createCertificationRequest();p.version=f.csrVersion?f.csrVersion.charCodeAt(0):0,p.signatureOid=b.asn1.derToOid(f.csrSignatureOid),p.signatureParameters=b.pki.readSignatureParameters(p.signatureOid,f.csrSignatureParams,!0),p.siginfo.algorithmOid=b.asn1.derToOid(f.csrSignatureOid),p.siginfo.parameters=b.pki.readSignatureParameters(p.siginfo.algorithmOid,f.csrSignatureParams,!1);var q=b.util.createBuffer(f.csrSignature);if(++q.read,p.signature=q.getBytes(),p.certificationRequestInfo=f.certificationRequestInfo,e){if(p.md=null,p.signatureOid in m){var o=m[p.signatureOid];switch(o){case"sha1WithRSAEncryption":p.md=b.md.sha1.create();break;case"md5WithRSAEncryption":p.md=b.md.md5.create();break;case"sha256WithRSAEncryption":p.md=b.md.sha256.create();break;case"RSASSA_PSS":p.md=b.md.sha256.create()}}if(null===p.md){var i=new Error("Could not compute certification request digest. Unknown signature OID.");throw i.signatureOid=p.signatureOid,i}var r=k.toDer(p.certificationRequestInfo);p.md.update(r.getBytes())}var s=b.md.sha1.create();return p.subject.getField=function(a){return c(p.subject,a)},p.subject.addField=function(a){h([a]),p.subject.attributes.push(a)},p.subject.attributes=l.RDNAttributesAsArray(f.certificationRequestInfoSubject,s),p.subject.hash=s.digest().toHex(),p.publicKey=l.publicKeyFromAsn1(f.subjectPublicKeyInfo),p.getAttribute=function(a){return c(p,a)},p.addAttribute=function(a){h([a]),p.attributes.push(a)},p.attributes=l.CRIAttributesAsArray(f.certificationRequestInfoAttributes||[]),p},l.createCertificationRequest=function(){var a={};return a.version=0,a.signatureOid=null,a.signature=null,a.siginfo={},a.siginfo.algorithmOid=null,a.subject={},a.subject.getField=function(b){return c(a.subject,b)},a.subject.addField=function(b){h([b]),a.subject.attributes.push(b)},a.subject.attributes=[],a.subject.hash=null,a.publicKey=null,a.attributes=[],a.getAttribute=function(b){return c(a,b)},a.addAttribute=function(b){h([b]),a.attributes.push(b)},a.md=null,a.setSubject=function(b){h(b),a.subject.attributes=b,a.subject.hash=null},a.setAttributes=function(b){h(b),a.attributes=b},a.sign=function(c,d){a.md=d||b.md.sha1.create();var e=m[a.md.algorithm+"WithRSAEncryption"];if(!e){var f=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw f.algorithm=a.md.algorithm,f}a.signatureOid=a.siginfo.algorithmOid=e,a.certificationRequestInfo=l.getCertificationRequestInfo(a);var g=k.toDer(a.certificationRequestInfo);a.md.update(g.getBytes()),a.signature=c.sign(a.md)},a.verify=function(){var c=!1,d=a.md;if(null===d){if(a.signatureOid in m){var e=m[a.signatureOid];switch(e){case"sha1WithRSAEncryption":d=b.md.sha1.create();break;case"md5WithRSAEncryption":d=b.md.md5.create();break;case"sha256WithRSAEncryption":d=b.md.sha256.create();break;case"RSASSA_PSS":d=b.md.sha256.create()}}if(null===d){var f=new Error("Could not compute certification request digest. Unknown signature OID.");throw f.signatureOid=a.signatureOid,f}var g=a.certificationRequestInfo||l.getCertificationRequestInfo(a)}return null!==d&&(c=l.verifySignature(a.signatureOid,a.signatureParameters,d,a.publicKey,k.toDer(g).getBytes(),a.signature)),c},a},l.signatureParametersToAsn1=function(a,b){switch(a){case m.RSASSA_PSS:var c=[];return void 0!==b.hash.algorithmOid&&b.hash.algorithmOid!==m.sha1&&c.push(k.create(k.Class.CONTEXT_SPECIFIC,0,!0,[k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(b.hash.algorithmOid).getBytes()),k.create(k.Class.UNIVERSAL,k.Type.NULL,!1,"")])])),void 0===b.mgf.algorithmOid||b.mgf.algorithmOid===m.mgf1&&b.mgf.hash.algorithmOid===m.sha1||c.push(k.create(k.Class.CONTEXT_SPECIFIC,1,!0,[k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(b.mgf.algorithmOid).getBytes()),k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(b.mgf.hash.algorithmOid).getBytes()),k.create(k.Class.UNIVERSAL,k.Type.NULL,!1,"")])])])),void 0!==b.saltLength&&20!==b.saltLength&&c.push(k.create(k.Class.CONTEXT_SPECIFIC,2,!0,[k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,k.integerToDer(b.saltLength).getBytes())])),k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,c);case m.kcdsa1:return l.toKCDSAParam(b.domainParam);default:return k.create(k.Class.UNIVERSAL,k.Type.NULL,!1,"")}},l.getTBSCertificate=function(a){var c=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.CONTEXT_SPECIFIC,0,!0,[k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,k.integerToDer(a.version).getBytes())]),k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,b.util.hexToBytes(a.serialNumber)),k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(a.siginfo.algorithmOid).getBytes()),l.signatureParametersToAsn1(a.siginfo.algorithmOid,a.siginfo.parameters)]),g(a.issuer),k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.UTCTIME,!1,k.dateToUtcTime(a.validity.notBefore)),k.create(k.Class.UNIVERSAL,k.Type.UTCTIME,!1,k.dateToUtcTime(a.validity.notAfter))]),g(a.subject),l.publicKeyToAsn1(a.publicKey)]);return a.issuer.uniqueId&&c.value.push(k.create(k.Class.CONTEXT_SPECIFIC,1,!0,[k.create(k.Class.UNIVERSAL,k.Type.BITSTRING,!1,String.fromCharCode(0)+a.issuer.uniqueId)])),a.subject.uniqueId&&c.value.push(k.create(k.Class.CONTEXT_SPECIFIC,2,!0,[k.create(k.Class.UNIVERSAL,k.Type.BITSTRING,!1,String.fromCharCode(0)+a.subject.uniqueId)])),a.extensions.length>0&&c.value.push(l.certificateExtensionsToAsn1(a.extensions)),c},l.getCertificationRequestInfo=function(a){var b=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,k.integerToDer(a.version).getBytes()),g(a.subject),l.publicKeyToAsn1(a.publicKey),j(a)]);return b},l.distinguishedNameToAsn1=function(a){return g(a)},l.certificateToAsn1=function(a){var b=a.tbsCertificate||l.getTBSCertificate(a);return k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[b,k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(a.signatureOid).getBytes()),l.signatureParametersToAsn1(a.signatureOid,a.signatureParameters)]),k.create(k.Class.UNIVERSAL,k.Type.BITSTRING,!1,String.fromCharCode(0)+a.signature)])},l.certificateExtensionsToAsn1=function(a){var b=k.create(k.Class.CONTEXT_SPECIFIC,3,!0,[]),c=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[]);b.value.push(c);for(var d=0;d<a.length;++d)c.value.push(l.certificateExtensionToAsn1(a[d]));return b},l.certificateExtensionToAsn1=function(a){var b=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[]);b.value.push(k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(a.id).getBytes())),a.critical&&b.value.push(k.create(k.Class.UNIVERSAL,k.Type.BOOLEAN,!1,String.fromCharCode(255)));var c=a.value;return"string"!=typeof a.value&&(c=k.toDer(c).getBytes()),b.value.push(k.create(k.Class.UNIVERSAL,k.Type.OCTETSTRING,!1,c)),b},l.certificationRequestToAsn1=function(a){var b=a.certificationRequestInfo||l.getCertificationRequestInfo(a);return k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[b,k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(a.signatureOid).getBytes()),l.signatureParametersToAsn1(a.signatureOid,a.signatureParameters)]),k.create(k.Class.UNIVERSAL,k.Type.BITSTRING,!1,String.fromCharCode(0)+a.signature)])},l.createCaStore=function(a){var c={certs:{}};if(c.getIssuer=function(a){var d=null;if(!a.issuer.hash){var e=b.md.sha1.create();a.issuer.attributes=l.RDNAttributesAsArray(g(a.issuer),e),a.issuer.hash=e.digest().toHex()}if(a.issuer.hash in c.certs&&(d=c.certs[a.issuer.hash],b.util.isArray(d)))throw new Error("Resolving multiple issuer matches not implemented yet.");return d},c.addCertificate=function(a){if("string"==typeof a&&(a=b.pki.certificateFromPem(a)),!a.subject.hash){var d=b.md.sha1.create();a.subject.attributes=l.RDNAttributesAsArray(g(a.subject),d),a.subject.hash=d.digest().toHex()}if(a.subject.hash in c.certs){var e=c.certs[a.subject.hash];b.util.isArray(e)||(e=[e]),e.push(a)}else c.certs[a.subject.hash]=a},a)for(var d=0;d<a.length;++d){var e=a[d];c.addCertificate(e)}return c},l.certificateError={bad_certificate:"dreamsecurity.pki.BadCertificate",unsupported_certificate:"dreamsecurity.pki.UnsupportedCertificate",certificate_revoked:"dreamsecurity.pki.CertificateRevoked",certificate_expired:"dreamsecurity.pki.CertificateExpired",certificate_unknown:"dreamsecurity.pki.CertificateUnknown",unknown_ca:"dreamsecurity.pki.UnknownCertificateAuthority"},l.verifyCertificateChain=function(c,d,e){a(),d=d.slice(0);var f=d.slice(0),g=new Date,h=!0,i=null,j=0,k=null;do{var m=d.shift();if(g<m.validity.notBefore||g>m.validity.notAfter)i={error:l.certificateError.certificate_expired,notBefore:m.validity.notBefore,notAfter:m.validity.notAfter,now:g},g>m.validity.notAfter?(i.type=b.err.expired,i.message="Certificate has expired. current : "+g+", expiredDate : "+m.validity.notAfter):i.message="Certificate is not valid yet. cuurent : "+g+", validDate : "+m.validity.notBefore;else{var n=!1;if(d.length>0){k=d[0];try{n=k.verify(m)}catch(o){}}else{var p=c.getIssuer(m);if(null===p)i={message:"Certificate is not trusted.",error:l.certificateError.unknown_ca};else for(b.util.isArray(p)||(p=[p]);!n&&p.length>0;){k=p.shift();try{n=k.verify(m)}catch(o){}}}null!==i||n||(i={message:"Certificate signature is invalid.",error:l.certificateError.bad_certificate})}if(null!==i||m.isIssuer(k)||(i={message:"Certificate issuer is invalid.",error:l.certificateError.bad_certificate}),null===i)for(var q={keyUsage:!0,basicConstraints:!0,certificatePolicies:!0,policyConstraints:!0},r=0;null===i&&r<m.extensions.length;++r){var s=m.extensions[r];!s.critical||s.name in q||(i={message:"Certificate has an unsupported critical extension.",error:l.certificateError.unsupported_certificate})}if(null===i&&(!h||0===d.length&&!k)){var t=m.getExtension("basicConstraints"),u=m.getExtension("keyUsage");if(null!==u&&(u.keyCertSign&&null!==t||(i={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:l.certificateError.bad_certificate})),null!==i||null===t||t.cA||(i={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:l.certificateError.bad_certificate}),null===i&&null!==u&&"pathLenConstraint"in t){for(var v=0,r=1;r<d.length-1;++r)d[r].isIssuer(d[r])&&++v;var w=t.pathLenConstraint+1;d.length-v>w&&(i={message:"Certificate basicConstraints pathLenConstraint violated.",error:l.certificateError.bad_certificate})}}var x=null===i?!0:i.error,y=e?e(x,j,f):x;if(y!==!0)throw x===!0&&(i={message:"The application rejected the certificate.",error:l.certificateError.bad_certificate}),(y||0===y)&&("object"!=typeof y||b.util.isArray(y)?"string"==typeof y&&(i.error=y):(y.message&&(i.message=y.message),y.error&&(i.error=y.error))),i;i=null,h=!1,++j}while(d.length>0);return!0}}var b="x509";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e.pki}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./asn1","./des","./md","./mgf","./oids","./pem","./pss","./rsa","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(a){if(void 0==a&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"pkc7asn1");var b=a.asn1,c=a.pkcs7asn1=a.pkcs7asn1||{};a.pkcs7=a.pkcs7||{},a.pkcs7.asn1=c;var d=a.pki.algIdValidator,e={name:"ContentInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:b.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};c.contentInfoValidator=e;var f={name:"EncryptedContentInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"contentType"},d("EncryptedContentInfo.contentEncryptionAlgorithm","EncryptedContentInfo.contentEncryptionAlgorithm.algorithm","encAlgorithm","EncryptedContentInfo.contentEncryptionAlgorithm.parameter","encParameter"),{name:"EncryptedContentInfo.encryptedContent",tagClass:b.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};c.envelopedDataValidator={name:"EnvelopedData",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:b.Class.UNIVERSAL,type:b.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(f)},c.encryptedDataValidator={name:"EncryptedData",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"version"}].concat(f)},c.attributeValidator={name:"Attribute",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:b.Class.UNIVERSAL,type:b.Type.SET,constructed:!0,capture:"values"}]},c.signerValidator={name:"SignerInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.Version",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignerInfo.IssuerAndSerialNumber",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerial.issuer",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerial.serialNumber",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.DigestAlgorithm",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,capture:"digestAlgorithm"},{name:"SignerInfo.AuthenticatedAttributes",tagClass:b.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.DigestEncryptionAlgorithm",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,capture:"digestEncAlgorithm"},{name:"SignerInfo.EncryptedDigest",tagClass:b.Class.UNIVERSAL,type:b.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.UnauthenticatedAttributes",tagClass:b.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0}]},c.signedDataValidator={name:"SignedData",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:b.Class.UNIVERSAL,type:b.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},e,{name:"SignedData.Certificates",tagClass:b.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:b.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:b.Class.UNIVERSAL,type:b.Type.SET,capture:"signerInfos",constructed:!0,optional:!0}]},c.recipientInfoValidator={name:"RecipientInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,capture:"keyEncryptionAlgorithm"},{name:"RecipientInfo.encryptedKey",tagClass:b.Class.UNIVERSAL,type:b.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]},c.signedAndEnvelopedDataValidator={name:"SignedAndEnvelopedData",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"SignedAndEnvelopedData.Version",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedAndEnvelopedData.RecipientInfos",tagClass:b.Class.UNIVERSAL,type:b.Type.SET,constructed:!0,captureAsn1:"recipientInfos"},{name:"SignedAndEnvelopedData.DigestAlgorithms",tagClass:b.Class.UNIVERSAL,type:b.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},f,{name:"SignedAndEnvelopedData.Certificates",tagClass:b.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedAndEnvelopedData.CertificateRevocationLists",tagClass:b.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedAndEnvelopedData.SignerInfos",tagClass:b.Class.UNIVERSAL,type:b.Type.SET,capture:"signerInfos",constructed:!0,optional:!0}]}}var b="pkcs7asn1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"pkcs7");var c=b.asn1,d=b.pkcs7=b.pkcs7||{};d.messageFromPem=function(a){var e=b.pem.decode(a)[0];if("PKCS7"!==e.type){var f=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw f.headerType=e.type,f}if(e.procType&&"ENCRYPTED"===e.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var g=c.fromDer(e.body);return d.messageFromAsn1(g)},d.messageToPem=function(a,d){var e={type:"PKCS7",body:c.toDer(a.toAsn1()).getBytes()
};return b.pem.encode(e,{maxline:d})},d.messageFromAsn1=function(a){var e={},f=[];if(!c.validate(a,d.asn1.contentInfoValidator,e,f)){var g=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw g.errors=f,g}var h,i=c.derToOid(e.contentType);switch(i){case b.pki.oids.envelopedData:h=d.createEnvelopedData();break;case b.pki.oids.encryptedData:h=d.createEncryptedData();break;case b.pki.oids.signedData:h=d.createSignedData();break;case b.pki.oids.signedAndEnvelopedData:h=d.createSignedAndEnvelopedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+i+" is not (yet) supported.")}return h.fromAsn1(e.content.value[0]),h};var e=function(a){var d={},e=[];if(!c.validate(a,b.pki.algIdValidator("mdAlg","mdOid","mdOid","mdParam","mdParam"),d,e)){var f=new Error("Cannot read PKCS#7 message. ASN.1 object is not an MessageDigestAlgorithm.");throw f.errors=e,f}var g=c.derToOid(d.mdOid);return g},f=function(a){var e={},f=[];if(!c.validate(a,d.asn1.recipientInfoValidator,e,f)){var g=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 EnvelopedData.");throw g.errors=f,g}var h=c.derToOid(e.keyEncryptionAlgorithm[0].value),i=null;if(h===b.pki.oids.RSAES_OAEP){var j={};if(!c.validate(e.keyEncryptionAlgorithm[1],b.pkcs1.asn1.rsaoaepParamValidator,j,f)){var g=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 EnvelopedData.");throw g.errors=f,g}var k="sha1";if(void 0!==j.hashAlgorithm){var l=c.derToOid(j.hashAlgorithm[0].value);k=b.pki.oids[l].toLowerCase()}i={md:b.md.algorithms[k].create()}}return{version:e.version.charCodeAt(0),issuer:b.pki.RDNAttributesAsArray(e.issuer),serialNumber:b.util.createBuffer(e.serial).toHex(),encryptedContent:{algorithm:h,parameter:i,content:e.encKey}}},g=function(a){return c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.INTEGER,!1,c.integerToDer(a.version).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[b.pki.distinguishedNameToAsn1({attributes:a.issuer}),c.create(c.Class.UNIVERSAL,c.Type.INTEGER,!1,b.util.hexToBytes(a.serialNumber))]),c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(a.encryptedContent.algorithm).getBytes()),u(a.encryptedContent.parameter)]),c.create(c.Class.UNIVERSAL,c.Type.OCTETSTRING,!1,a.encryptedContent.content)])},h=function(a){for(var b=[],c=0;c<a.length;c++)b.push(f(a[c]));return b},i=function(a){for(var b=[],c=0;c<a.length;c++)b.push(g(a[c]));return b},j=function(a){return[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(b.pki.oids.data).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(a.algorithm).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.OCTETSTRING,!1,a.parameter.getBytes())]),c.create(c.Class.CONTEXT_SPECIFIC,0,!1,a.content.getBytes())]},k=function(a){for(var b=[],c=0;c<a.length;c++)b.push(e(a[c]));return b},l=function(a){for(var b=[],d=0;d<a.length;d++)b.push(c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(a[d]).getBytes())]));return b},m=function(a){var e={},f=[];if(!c.validate(a,d.asn1.signerValidator,e,f)){var g=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 SignedData.");throw g.errors=f,g}var h=null;if(void 0!=e.authenticatedAttributes&&null!=e.authenticatedAttributes){var i=null,j=null,k=null,l=null,m=null;if(e.authenticatedAttributes.length)for(var o=0;o<e.authenticatedAttributes.length;o++)i=n(e.authenticatedAttributes[o]),i.oid===b.pki.oids.contentType?l=c.derToOid(i.values[0].value):i.oid===b.pki.oids.messageDigest?k=i.values[0].value:i.oid===b.pki.oids.signingTime?j=c.utcTimeToDate(i.values[0].value):i.oid!==b.pki.oids.signingCertificate&&i.oid!==b.pki.oids.signingCertificateV2||(m={},m.oid=i.oid,m.value=i.values[0].value);var p=c.create(c.Class.UNIVERSAL,c.Type.SET,!0,e.authenticatedAttributes);h={derEncoded:c.toDer(p).getBytes(),contentType:l,messageDigest:k,signingTime:j,signingCert:m}}var q=c.derToOid(e.digestEncAlgorithm[0].value),r=b.pki.readSignatureParameters(q,e.digestEncAlgorithm[1],!0);return{version:e.version.charCodeAt(0),issuer:b.pki.RDNAttributesAsArray(e.issuer),serialNumber:b.util.createBuffer(e.serial).toHex(),signedAttrs:h,signature:{algorithm:q,parameter:r,digestAlgorithm:c.derToOid(e.digestAlgorithm[0].value),content:e.signature},certificate:null}};d.attrFromAsn1=function(a){return n(a)};var n=function(a){var b={},e=[];if(!c.validate(a,d.asn1.attributeValidator,b,e)){var f=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 SignedData.");throw f.errors=e,f}return{oid:c.derToOid(b.oid),values:[b.values[0]]}},o=function(a){var d=c.create(c.Class.UNIVERSAL,c.Type.INTEGER,!1,c.integerToDer(a.version).getBytes()),e=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[b.pki.distinguishedNameToAsn1({attributes:a.issuer}),c.create(c.Class.UNIVERSAL,c.Type.INTEGER,!1,b.util.hexToBytes(a.serialNumber))]),f=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(a.signature.digestAlgorithm).getBytes())]),g=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(a.signature.algorithm).getBytes()),b.pki.signatureParametersToAsn1(a.signature.algorithm,a.signature.parameter)]),h=c.create(c.Class.UNIVERSAL,c.Type.OCTETSTRING,!1,a.signature.content);return void 0==a.signedAttrs||null==a.signedAttrs?c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[d,e,f,g,h]):c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[d,e,f,c.create(c.Class.CONTEXT_SPECIFIC,0,!0,x(a.signedAttrs.contentType,a.signedAttrs.signingTime,a.signedAttrs.messageDigest,a.signedAttrs.signingCert)),g,h])},p=function(a){var d=b.pki.oids[a];return c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(d).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.NULL,!1,"")])},q=function(a){for(var b=[],c=0;c<a.length;c++)b.push(m(a[c]));return b},r=function(a){for(var b=[],c=0;c<a.length;c++)b.push(o(a[c]));return b},s=function(a,b,c){if(a.length!==b.length)return!1;for(var d=0;d<b.length;++d)if(c){if(a[d].value!==b[d].value)return!1}else if(a[d].type!==b[d].type||a[d].value!==b[d].value)return!1;return!0},t=function(a,b){for(var c=0;c<b.length;++c){var d=b[c];if(a.serialNumber===d.serialNumber){if(s(d.issuer.attributes,a.issuer,!1))return c;if(s(d.subject.attributes,a.issuer,!0))return c}}throw new Error("The signer certificate is not exist.")},u=function(a){if(void 0!==a&&null!==a){var d=[];return"sha1"!==a.md.algorithm&&(d.push(c.create(c.Class.CONTEXT_SPECIFIC,0,!0,[p(a.md.algorithm)])),d.push(c.create(c.Class.CONTEXT_SPECIFIC,1,!0,[c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(b.pki.oids.mgf1).getBytes()),p(a.md.algorithm)])]))),c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,d)}return c.create(c.Class.UNIVERSAL,c.Type.NULL,!1,"")},v=function(a,d,e){var f={},g=[];if(!c.validate(d,e,f,g)){var h=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw h.errors=h,h}if(a.contentType=c.derToOid(f.contentType),f.encryptedContent){var i="";if(b.util.isArray(f.encryptedContent))for(var j=0;j<f.encryptedContent.length;++j){if(f.encryptedContent[j].type!==c.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");i+=f.encryptedContent[j].value}else i=f.encryptedContent;a.encryptedContent={algorithm:c.derToOid(f.encAlgorithm),parameter:b.util.createBuffer(f.encParameter.value),content:b.util.createBuffer(i)}}if(f.content){var i="";if(b.util.isArray(f.content))for(var j=0;j<f.content.length;++j){if(f.content[j].type!==c.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");i+=f.content[j].value}else i=f.content;a.content=b.util.createBuffer(i)}return a.version=f.version.charCodeAt(0),a.rawCapture=f,f},w=function(a){if(void 0===a.encryptedContent.key)throw new Error("Symmetric key not available.");if(void 0===a.content||null==a.content){var c;switch(a.encryptedContent.algorithm){case b.pki.oids["aes128-CBC"]:case b.pki.oids["aes192-CBC"]:case b.pki.oids["aes256-CBC"]:c=b.aes.createDecryptionCipher(a.encryptedContent.key);break;case b.pki.oids.desCBC:case b.pki.oids["des-EDE3-CBC"]:c=b.des.createDecryptionCipher(a.encryptedContent.key);break;case b.pki.oids.seedCBC:c=b.seed.createDecryptionCipher(a.encryptedContent.key);break;case b.pki.oids.ariaCBC:case b.pki.oids["aria128-CBC"]:case b.pki.oids["aria192-CBC"]:case b.pki.oids["aria256-CBC"]:c=b.aria.createDecryptionCipher(a.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+a.encryptedContent.algorithm)}if(c.start(a.encryptedContent.parameter),c.update(a.encryptedContent.content),!c.finish())throw new Error("Symmetric decryption failed.");a.content=c.output}},x=function(a,d,e,f){var g=[];return g.push(c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(b.pki.oids.contentType).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.SET,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(a).getBytes())])])),d&&g.push(c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(b.pki.oids.signingTime).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.SET,!0,[c.create(c.Class.UNIVERSAL,c.Type.UTCTIME,!1,c.dateToUtcTime(d))])])),g.push(c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(b.pki.oids.messageDigest).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.SET,!0,[c.create(c.Class.UNIVERSAL,c.Type.OCTETSTRING,!1,e)])])),f&&g.push(c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(f.oid).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.SET,!0,[c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,f.value)])])),y(g)},y=function(a){var b=[],d=[],e=0,f=0;for(e=0;e<a.length;++e)b[e]={idx:e,bytes:c.toDer(a[e]).getBytes()};for(e=b.length-1;e>0;e--)for(f=0;e>f;f++)if(z(b[f].bytes,b[f+1].bytes)>0){var g={idx:b[f].idx,bytes:b[f].bytes};b[f].idx=b[f+1].idx,b[f].bytes=b[f+1].bytes,b[f+1].idx=g.idx,b[f+1].bytes=g.bytes}for(e=0;e<b.length;e++)d.push(a[b[e].idx]);return d},z=function(a,b){var c=0;c=a.length>b.length?b.length:a.length;for(var d=0;c>d;d++)if(a[d]!=b[d])return a[d]>b[d]?1:-1;return a.length==b.length?0:a.length>b.length?1:-1};d.createSignedData=function(){a();var e=null;return e={type:b.pki.oids.signedData,version:1,certificates:[],crls:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(a){v(e,a,d.asn1.signedDataValidator),e.certificates=[],e.crls=[],e.digestAlgorithmIdentifiers=[],e.contentInfo=null,e.signerInfos=[];for(var c=e.rawCapture,f=c.certificates.value,g=0;g<f.length;++g)16==f[g].type&&e.certificates.push(b.pki.certificateFromAsn1(f[g]));void 0!=c.content?e.content=c.content.value[0].value:e.content=null,e.digestAlgorithmIdentifiers=k(c.digestAlgorithms.value),c.signerInfos&&(e.signerInfos=q(c.signerInfos))},toAsn1:function(){e.contentInfo||e.sign();for(var a=[],d=0;d<e.certificates.length;++d)a.push(b.pki.certificateToAsn1(e.certificates[d]));return c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(e.type).getBytes()),c.create(c.Class.CONTEXT_SPECIFIC,0,!0,[c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.INTEGER,!1,c.integerToDer(e.version).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.SET,!0,l(e.digestAlgorithmIdentifiers)),e.contentInfo,c.create(c.Class.CONTEXT_SPECIFIC,0,!0,a),c.create(c.Class.UNIVERSAL,c.Type.SET,!0,r(e.signerInfos))])])])},sign:function(a,d,f,g,h){"object"!=typeof e.content&&(e.contentInfo=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(b.pki.oids.data).getBytes())]),2&h||"content"in e&&e.contentInfo.value.push(c.create(c.Class.CONTEXT_SPECIFIC,0,!0,[c.create(c.Class.UNIVERSAL,c.Type.OCTETSTRING,!1,e.content)])));var i=0,j=!1;for(i=0;i<e.digestAlgorithmIdentifiers.length;i++)if(e.digestAlgorithmIdentifiers[i]==b.pki.oids[f.algorithm]){j=!0;break}j||e.digestAlgorithmIdentifiers.push(b.pki.oids[f.algorithm]);var k=null;if(4&h){if(16&h)throw new Error("The SignGateFormat and messageDigestContent is not supported.");k=e.content}else{var l=null;16&h?l=e.content:(f.update(e.content),l=f.digest().getBytes());var m=new Date,n=x(b.pki.oids.data,m,l,null),o=c.create(c.Class.UNIVERSAL,c.Type.SET,!0,n);k=c.toDer(o).getBytes()}var p="",q={},r=null;if("rsa"==d.algName){if("string"==typeof g)p=b.pki.oids.rsaEncryption;else{p=b.pki.oids.RSASSA_PSS;var s=g.mgf.split("-");q={hash:{algorithmOid:b.pki.oids[g.md]},mgf:{algorithmOid:b.pki.oids[s[0]],hash:{algorithmOid:b.pki.oids[s[1]]}},saltLength:g.saltLength}}f.start(),f.update(k),r=d.sign(f,g)}else{if("kcdsa"!=d.algName)throw new Error("The algorithm("+d.algName+") is not supported.");p=b.pki.oids.kcdsa1,q={domainParam:a.publicKey},r=d.sign(k,f.algorithm,a.publicKey.y)}var t={algorithm:p,parameter:q,digestAlgorithm:b.pki.oids[f.algorithm],content:r},u=null;u=4&h?{version:1,issuer:a.subject.attributes,serialNumber:a.serialNumber,signature:t}:{version:1,issuer:a.issuer.attributes,serialNumber:a.serialNumber,signedAttrs:{contentType:b.pki.oids.data,signingTime:m,messageDigest:l},signature:t},e.signerInfos.push(u),e.certificates.push(a)},verify:function(){for(var a=0;a<e.signerInfos.length;a++){var c=e.signerInfos[a],d=c.signedAttrs,f=null;c.certIndex=t(c,e.certificates);var g=b.oids[c.signature.digestAlgorithm];if(!g)throw new Error("The digest algorithm("+c.signature.digestAlgorithm+") is not supported.");f=b.md.algorithms[g].create();var h=null;if(null==d)h=e.content;else{f.update(e.content);var i=f.digest().toHex(),j=b.util.bytesToHex(d.messageDigest);if(i!==j)throw new Error("The data integrity is damaged.")}if(!b.pki.verifySignature(c.signature.algorithm,c.signature.parameter,f,e.certificates[c.certIndex].publicKey,d.derEncoded,c.signature.content))return!1}return!0},getSignerInfos:function(){var a=0,b=[];for(a=0;a<e.signerInfos.length;a++){var c=e.signerInfos[a].signedAttrs;b.push({certIndex:e.signerInfos[a].certIndex,signingTime:null!=c?c.signingTime:null})}return b},addCertificate:function(a){"string"==typeof a&&(a=b.pki.certificateFromPem(a)),e.certificates.push(a)},addCertificateRevokationList:function(a){throw new Error("PKCS#7 CRL support not yet implemented.")}}},d.createEncryptedData=function(){a();var c=null;return c={type:b.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:b.pki.oids["aes256-CBC"]},fromAsn1:function(a){v(c,a,d.asn1.encryptedDataValidator)},decrypt:function(a){void 0!==a&&(c.encryptedContent.key=a),w(c)}}},d.createEnvelopedData=function(){a();var e=null;return e={type:b.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:b.pki.oids["aes256-CBC"]},fromAsn1:function(a){var b=v(e,a,d.asn1.envelopedDataValidator);e.recipients=h(b.recipientInfos.value)},toAsn1:function(){return c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(e.type).getBytes()),c.create(c.Class.CONTEXT_SPECIFIC,0,!0,[c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.INTEGER,!1,c.integerToDer(e.version).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.SET,!0,i(e.recipients)),c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,j(e.encryptedContent))])])])},findRecipient:function(a){for(var b=a.issuer.attributes,c=0;c<e.recipients.length;++c){var d=e.recipients[c],f=d.issuer;if(d.serialNumber===a.serialNumber&&f.length===b.length){for(var g=!0,h=0;h<b.length;++h)if(f[h].type!==b[h].type||f[h].value!==b[h].value){g=!1;break}if(g)return d}}return null},decrypt:function(a,c){if(void 0===e.encryptedContent.key&&void 0!==a&&void 0!==c)switch(a.encryptedContent.algorithm){case b.pki.oids.rsaEncryption:case b.pki.oids.desCBC:var d=c.decrypt(a.encryptedContent.content);e.encryptedContent.key=b.util.createBuffer(d);break;case b.pki.oids.RSAES_OAEP:var d=c.decrypt(a.encryptedContent.content,"RSA-OAEP",a.encryptedContent.parameter);e.encryptedContent.key=b.util.createBuffer(d);break;default:throw new Error("Unsupported asymmetric cipher, OID "+a.encryptedContent.algorithm)}w(e)},addRecipient:function(a,c,d){var f=null,g=void 0;void 0===c||null===c||"RSAES-PKCS1-V1_5"===c?f=b.pki.oids.rsaEncryption:(f=b.pki.oids.RSAES_OAEP,g=d),e.recipients.push({version:0,issuer:a.issuer.attributes,serialNumber:a.serialNumber,encryptedContent:{algorithm:f,parameter:g,key:a.publicKey}})},encrypt:function(a,c){if(void 0===e.encryptedContent.content){c=c||e.encryptedContent.algorithm,a=a||e.encryptedContent.key;var d,f,g;switch(c){case b.pki.oids["aes128-CBC"]:d=16,f=16,g=b.aes.createEncryptionCipher;break;case b.pki.oids["aes192-CBC"]:d=24,f=16,g=b.aes.createEncryptionCipher;break;case b.pki.oids["aes256-CBC"]:d=32,f=16,g=b.aes.createEncryptionCipher;break;case b.pki.oids["des-EDE3-CBC"]:d=24,f=8,g=b.des.createEncryptionCipher;break;case b.pki.oids.seedCBC:d=16,f=16,g=b.seed.createEncryptionCipher;break;case b.pki.oids.ariaCBC:case b.pki.oids["aria128-CBC"]:d=16,f=16,g=b.aria.createEncryptionCipher;break;case b.pki.oids["aria192-CBC"]:d=24,f=16,g=b.aria.createEncryptionCipher;break;case b.pki.oids["aria256-CBC"]:d=32,f=16,g=b.aria.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+c)}if(void 0===a)a=b.util.createBuffer(b.random.getBytes(d));else if(a.length()!=d)throw new Error("Symmetric key has wrong length; got "+a.length()+" bytes, expected "+d+".");e.encryptedContent.algorithm=c,e.encryptedContent.key=a,e.encryptedContent.parameter=b.util.createBuffer(b.random.getBytes(f));var h=g(a);if(h.start(e.encryptedContent.parameter.copy()),h.update(e.content),!h.finish())throw new Error("Symmetric encryption failed.");e.encryptedContent.content=h.output}for(var i=0;i<e.recipients.length;i++){var j=e.recipients[i];if(void 0===j.encryptedContent.content)switch(j.encryptedContent.algorithm){case b.pki.oids.rsaEncryption:j.encryptedContent.content=j.encryptedContent.key.encrypt(e.encryptedContent.key.data);break;case b.pki.oids.RSAES_OAEP:j.encryptedContent.content=j.encryptedContent.key.encrypt(e.encryptedContent.key.data,"RSA-OAEP",j.encryptedContent.parameter);break;default:throw new Error("Unsupported asymmetric cipher, OID "+j.encryptedContent.algorithm)}}}}},d.createSignedAndEnvelopedData=function(){a();var e=null;return e={type:b.pki.oids.signedAndEnvelopedData,version:1,recipients:[],digestAlgorithmIdentifiers:[],encryptedContent:{algorithm:b.pki.oids["aes256-CBC"]},certificates:[],crls:[],signerInfos:[],fromAsn1:function(a){var c=v(e,a,d.asn1.signedAndEnvelopedDataValidator);e.recipients=h(c.recipientInfos.value),e.digestAlgorithmIdentifiers=[],e.certificates=[],e.crls=[],e.signerInfos=[];for(var f=e.rawCapture.certificates.value,g=0;g<f.length;++g)e.certificates.push(b.pki.certificateFromAsn1(f[g]));void 0!=e.rawCapture.content?e.content=e.rawCapture.content.value[0].value:e.content=null,e.rawCapture.signerInfos&&(e.signerInfos=q(e.rawCapture.signerInfos))},toAsn1:function(){for(var a=[],d=0;d<e.certificates.length;++d)a.push(b.pki.certificateToAsn1(e.certificates[d]));return c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(e.type).getBytes()),c.create(c.Class.CONTEXT_SPECIFIC,0,!0,[c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.INTEGER,!1,c.integerToDer(e.version).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.SET,!0,i(e.recipients)),c.create(c.Class.UNIVERSAL,c.Type.SET,!0,l(e.digestAlgorithmIdentifiers)),c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,j(e.encryptedContent)),c.create(c.Class.CONTEXT_SPECIFIC,0,!0,a),c.create(c.Class.UNIVERSAL,c.Type.SET,!0,r(e.signerInfos))])])])},signAndEnv:function(a,c,d,f,g,h,i){e.digestAlgorithmIdentifiers.push(b.pki.oids[d.algorithm]);var j=null;j=e.content.getBytes();var k="",l={},m=null;if("rsa"==c.algName){if("string"==typeof f)k=b.pki.oids.rsaEncryption;else{k=b.pki.oids.RSASSA_PSS;var n=f.mgf.split("-");l={hash:{algorithmOid:b.pki.oids[f.md]},mgf:{algorithmOid:b.pki.oids[n[0]],hash:{algorithmOid:b.pki.oids[n[1]]}},saltLength:f.saltLength}}d.start(),d.update(j),m=c.sign(d,f)}else{if("kcdsa"!=c.algName)throw new Error("The algorithm("+c.algName+") is not supported.");k=b.pki.oids.kcdsa1,l={domainParam:a.publicKey},m=c.sign(j,d.algorithm,a.publicKey.y)}var o=null,p=null;if(void 0===e.encryptedContent.content){i=i||e.encryptedContent.algorithm,h=h||e.encryptedContent.key;var q,r,s;switch(i){case b.pki.oids["aes128-CBC"]:q=16,r=16,s=b.aes.createEncryptionCipher;break;case b.pki.oids["aes192-CBC"]:q=24,r=16,s=b.aes.createEncryptionCipher;break;case b.pki.oids["aes256-CBC"]:q=32,r=16,s=b.aes.createEncryptionCipher;break;case b.pki.oids["des-EDE3-CBC"]:q=24,r=8,s=b.des.createEncryptionCipher;break;case b.pki.oids.seedCBC:q=16,r=16,s=b.seed.createEncryptionCipher;break;case b.pki.oids.ariaCBC:case b.pki.oids["aria128-CBC"]:q=16,r=16,s=b.aria.createEncryptionCipher;break;case b.pki.oids["aria192-CBC"]:q=24,r=16,s=b.aria.createEncryptionCipher;break;case b.pki.oids["aria256-CBC"]:q=32,r=16,s=b.aria.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+i)}if(void 0===h)h=b.util.createBuffer(b.random.getBytes(q));else if(h.length()!=q)throw new Error("Symmetric key has wrong length; got "+h.length()+" bytes, expected "+q+".");e.encryptedContent.algorithm=i,e.encryptedContent.key=h,e.encryptedContent.parameter=b.util.createBuffer(b.random.getBytes(r));var t=s(h);if(t.start(e.encryptedContent.parameter.copy()),t.update(b.util.createBuffer(j)),!t.finish())throw new Error("Symmetric encryption failed.");if(p=t.output,t.start(e.encryptedContent.parameter.copy()),t.update(b.util.createBuffer(m)),!t.finish())throw new Error("Symmetric encryption failed.");o=t.output}for(var u=0;u<e.recipients.length;u++){var v=e.recipients[u];if(void 0===v.encryptedContent.content)switch(v.encryptedContent.algorithm){case b.pki.oids.rsaEncryption:v.encryptedContent.content=v.encryptedContent.key.encrypt(e.encryptedContent.key.data);break;case b.pki.oids.RSAES_OAEP:v.encryptedContent.content=v.encryptedContent.key.encrypt(e.encryptedContent.key.data,"RSA-OAEP",v.encryptedContent.parameter);break;default:throw new Error("Unsupported asymmetric cipher, OID "+v.encryptedContent.algorithm)}}var w={algorithm:k,parameter:l,digestAlgorithm:b.pki.oids[d.algorithm],content:o.getBytes()},x={version:0,issuer:a.issuer.attributes,serialNumber:a.serialNumber,signature:w};e.signerInfos.push(x),e.certificates.push(a),e.encryptedContent.content=p},verifyAndDec:function(a,c){if(void 0===e.encryptedContent.key&&void 0!==a&&void 0!==c)switch(a.encryptedContent.algorithm){case b.pki.oids.rsaEncryption:case b.pki.oids.desCBC:var d=c.decrypt(a.encryptedContent.content);e.encryptedContent.key=b.util.createBuffer(d);break;case b.pki.oids.RSAES_OAEP:var d=c.decrypt(a.encryptedContent.content,"RSA-OAEP",a.encryptedContent.parameter);e.encryptedContent.key=b.util.createBuffer(d);break;default:throw new Error("Unsupported asymmetric cipher, OID "+a.encryptedContent.algorithm)}if(void 0===e.encryptedContent.key)throw new Error("Symmetric key not available.");var f=null;if(void 0===e.content||null==e.content){switch(e.encryptedContent.algorithm){case b.pki.oids["aes128-CBC"]:case b.pki.oids["aes192-CBC"]:case b.pki.oids["aes256-CBC"]:f=b.aes.createDecryptionCipher(e.encryptedContent.key);break;case b.pki.oids.desCBC:case b.pki.oids["des-EDE3-CBC"]:f=b.des.createDecryptionCipher(e.encryptedContent.key);break;case b.pki.oids.seedCBC:f=b.seed.createDecryptionCipher(e.encryptedContent.key);break;case b.pki.oids.ariaCBC:case b.pki.oids["aria128-CBC"]:case b.pki.oids["aria192-CBC"]:case b.pki.oids["aria256-CBC"]:f=b.aria.createDecryptionCipher(e.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+e.encryptedContent.algorithm)}if(f.start(e.encryptedContent.parameter.copy()),f.update(e.encryptedContent.content),!f.finish())throw new Error("Symmetric decryption failed.");e.content=f.output}for(var g=0;g<e.signerInfos.length;g++){var h=e.signerInfos[g],i=null;if(h.certIndex=t(h,e.certificates),h.signature.digestAlgorithm===b.pki.oids.sha1)i=b.md.sha1.create();else{if(h.signature.digestAlgorithm!==b.pki.oids.sha256)throw new Error("The digest algorithm("+h.signature.digestAlgorithm+") is not supported.");i=b.md.sha256.create()}var j=e.content.copy();if(f.start(e.encryptedContent.parameter.copy()),f.update(b.util.createBuffer(h.signature.content)),!f.finish())throw new Error("Symmetric decryption failed.");var k=f.output;if(!b.pki.verifySignature(h.signature.algorithm,h.signature.parameter,i,e.certificates[h.certIndex].publicKey,j.getBytes(),k.getBytes()))return!1}return!0},getSignerInfos:function(){var a=0,b=[];for(a=0;a<e.signerInfos.length;a++){var c=e.signerInfos[a].signedAttrs;b.push({certIndex:e.signerInfos[a].certIndex,signingTime:null!=c?c.signingTime:null})}return b},addCertificate:function(a){"string"==typeof a&&(a=b.pki.certificateFromPem(a)),e.certificates.push(a)},addCertificateRevokationList:function(a){throw new Error("PKCS#7 CRL support not yet implemented.")},findRecipient:function(a){for(var b=a.issuer.attributes,c=0;c<e.recipients.length;++c){var d=e.recipients[c],f=d.issuer;if(d.serialNumber===a.serialNumber&&f.length===b.length){for(var g=!0,h=0;h<b.length;++h)if(f[h].type!==b[h].type||f[h].value!==b[h].value){g=!1;break}if(g)return d}}return null},addRecipient:function(a,c,d){var f=null,g=void 0;void 0===c||null===c||"RSAES-PKCS1-V1_5"===c?f=b.pki.oids.rsaEncryption:(f=b.pki.oids.RSAES_OAEP,g=d),e.recipients.push({version:0,issuer:a.issuer.attributes,serialNumber:a.serialNumber,encryptedContent:{algorithm:f,parameter:g,key:a.publicKey}})},encrypt:function(a,c){if(void 0===e.encryptedContent.content){c=c||e.encryptedContent.algorithm,a=a||e.encryptedContent.key;var d,f,g;switch(c){case b.pki.oids["aes128-CBC"]:d=16,f=16,g=b.aes.createEncryptionCipher;break;case b.pki.oids["aes192-CBC"]:d=24,f=16,g=b.aes.createEncryptionCipher;break;case b.pki.oids["aes256-CBC"]:d=32,f=16,g=b.aes.createEncryptionCipher;break;case b.pki.oids["des-EDE3-CBC"]:d=24,f=8,g=b.des.createEncryptionCipher;break;case b.pki.oids.seedCBC:d=16,f=16,g=b.seed.createEncryptionCipher;break;case b.pki.oids.ariaCBC:case b.pki.oids["aria128-CBC"]:d=16,f=16,g=b.aria.createEncryptionCipher;break;case b.pki.oids["aria192-CBC"]:d=24,f=16,g=b.aria.createEncryptionCipher;break;case b.pki.oids["aria256-CBC"]:d=32,f=16,g=b.aria.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+c)}if(void 0===a)a=b.util.createBuffer(b.random.getBytes(d));else if(a.length()!=d)throw new Error("Symmetric key has wrong length; got "+a.length()+" bytes, expected "+d+".");e.encryptedContent.algorithm=c,e.encryptedContent.key=a,e.encryptedContent.parameter=b.util.createBuffer(b.random.getBytes(f));var h=g(a);if(h.start(e.encryptedContent.parameter.copy()),h.update(e.content),!h.finish())throw new Error("Symmetric encryption failed.");e.encryptedContent.content=h.output}for(var i=0;i<e.recipients.length;i++){var j=e.recipients[i];if(void 0===j.encryptedContent.content)switch(j.encryptedContent.algorithm){case b.pki.oids.rsaEncryption:j.encryptedContent.content=j.encryptedContent.key.encrypt(e.encryptedContent.key.data);break;case b.pki.oids.RSAES_OAEP:j.encryptedContent.content=j.encryptedContent.key.encrypt(e.encryptedContent.key.data,"RSA-OAEP",j.encryptedContent.parameter);break;default:throw new Error("Unsupported asymmetric cipher, OID "+j.encryptedContent.algorithm)}}}}}}var b="pkcs7";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./asn1","./des","./oids","./pem","./pkcs7asn1","./random","./util","./x509"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a,b,c,d){for(var e=[],f=0;f<a.length;f++)for(var g=0;g<a[f].safeBags.length;g++){var h=a[f].safeBags[g];void 0!==d&&h.type!==d||(null!==b?void 0!==h.attributes[b]&&h.attributes[b].indexOf(c)>=0&&e.push(h):e.push(h))}return e}function d(a){if(a.composed||a.constructed){for(var c=b.util.createBuffer(),d=0;d<a.value.length;++d)c.putBytes(a.value[d].value);a.composed=a.constructed=!1,a.value=c.getBytes()}return a}function e(a,b,c,e,h){if(b=i.fromDer(b,c),b.tagClass!==i.Class.UNIVERSAL||b.type!==i.Type.SEQUENCE||b.constructed!==!0)throw new Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var k=0;k<b.value.length;k++){var m=b.value[k],n={},o=[];if(!i.validate(m,l,n,o)){var p=new Error("Cannot read ContentInfo.");throw p.errors=o,p}var q={encrypted:!1},r=null,s=n.content.value[0];switch(i.derToOid(n.contentType)){case j.oids.data:if(s.tagClass!==i.Class.UNIVERSAL||s.type!==i.Type.OCTETSTRING)throw new Error("PKCS#12 SafeContents Data is not an OCTET STRING.");r=d(s).value;break;case j.oids.encryptedData:r=f(s,e),q.encrypted=!0;break;default:var p=new Error("Unsupported PKCS#12 contentType.");throw p.contentType=i.derToOid(n.contentType),p}q.safeBags=g(r,c,e,h),a.safeContents.push(q)}}function f(a,c){var e={},f=[];if(!i.validate(a,b.pkcs7.asn1.encryptedDataValidator,e,f)){var g=new Error("Cannot read EncryptedContentInfo.");throw g.errors=f,g}var h=i.derToOid(e.contentType);if(h!==j.oids.data){var g=new Error("PKCS#12 EncryptedContentInfo ContentType is not Data.");throw g.oid=h,g}h=i.derToOid(e.encAlgorithm);var k=j.pbe.getCipher(h,e.encParameter,c),l=d(e.encryptedContentAsn1),m=b.util.createBuffer(l.value);if(k.update(m),!k.finish())throw new Error("Failed to decrypt PKCS#12 SafeContents.");return k.output.getBytes()}function g(a,b,c,d){if(!b&&0===a.length)return[];if(a=i.fromDer(a,b),a.tagClass!==i.Class.UNIVERSAL||a.type!==i.Type.SEQUENCE||a.constructed!==!0)throw new Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(var e=[],f=0;f<a.value.length;f++){var g=a.value[f],k={},l=[];if(!i.validate(g,n,k,l)){var m=new Error("Cannot read SafeBag.");throw m.errors=l,m}var o={type:i.derToOid(k.bagId),attributes:h(k.bagAttributes)};e.push(o);var q,r,s=k.bagValue.value[0];switch(o.type){case j.oids.pkcs8ShroudedKeyBag:if(!(d&&d.format&&1&d.format)&&(s=j.decryptPrivateKeyInfo(s,c),null===s))throw new Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case j.oids.keyBag:d&&d.format&&1&d.format?o.key=s:o.key=j.privateKeyFromAsn1(s);continue;case j.oids.certBag:q=p,r=function(){if(i.derToOid(k.certId)!==j.oids.x509Certificate){var a=new Error("Unsupported certificate type, only X.509 supported.");throw a.oid=i.derToOid(k.certId),a}o.cert=j.certificateFromAsn1(i.fromDer(k.cert,b),!0)};break;default:var m=new Error("Unsupported PKCS#12 SafeBag type.");throw m.oid=o.type,m}if(void 0!==q&&!i.validate(s,q,k,l)){var m=new Error("Cannot read PKCS#12 "+q.name);throw m.errors=l,m}r()}return e}function h(a){var b={};if(void 0!==a)for(var c=0;c<a.length;++c){var d={},e=[];if(!i.validate(a[c],o,d,e)){var f=new Error("Cannot read PKCS#12 BagAttribute.");throw f.errors=e,f}var g=i.derToOid(d.oid);if(void 0!==j.oids[g]){b[j.oids[g]]=[];for(var h=0;h<d.values.length;++h)b[j.oids[g]].push(d.values[h].value);
}}return b}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"pkcs12");var i=b.asn1,j=b.pki,k=b.pkcs12=b.pkcs12||{},l={name:"ContentInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:i.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},m={name:"PFX",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"},l,{name:"PFX.macData",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:i.Class.UNIVERSAL,optional:!0,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},n={name:"SafeBag",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:i.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},o={name:"Attribute",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,constructed:!0,capture:"values"}]},p={name:"CertBag",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:i.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:i.Class.UNIVERSAL,type:i.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};k.pkcs12FromAsn1=function(f,g,h,l){a(),"string"==typeof g?(h=g,g=!0):void 0===g&&(g=!0);var n={},o=[];if(!i.validate(f,m,n,o)){var p=new Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.");throw p.errors=o,p}var q={version:n.version.charCodeAt(0),safeContents:[],getBags:function(a){var d,e={};return"localKeyId"in a?d=a.localKeyId:"localKeyIdHex"in a&&(d=b.util.hexToBytes(a.localKeyIdHex)),void 0===d&&!("friendlyName"in a)&&"bagType"in a&&(e[a.bagType]=c(q.safeContents,null,null,a.bagType)),void 0!==d&&(e.localKeyId=c(q.safeContents,"localKeyId",d,a.bagType)),"friendlyName"in a&&(e.friendlyName=c(q.safeContents,"friendlyName",a.friendlyName,a.bagType)),e},getBagsByFriendlyName:function(a,b){return c(q.safeContents,"friendlyName",a,b)},getBagsByLocalKeyId:function(a,b){return c(q.safeContents,"localKeyId",a,b)}};if(3!==n.version.charCodeAt(0)){var p=new Error("PKCS#12 PFX of version other than 3 not supported.");throw p.version=n.version.charCodeAt(0),p}if(i.derToOid(n.contentType)!==j.oids.data){var p=new Error("Only PKCS#12 PFX in password integrity mode supported.");throw p.oid=i.derToOid(n.contentType),p}var r=n.content.value[0];if(r.tagClass!==i.Class.UNIVERSAL||r.type!==i.Type.OCTETSTRING)throw new Error("PKCS#12 authSafe content data is not an OCTET STRING.");if(r=d(r),n.mac){var s=null,t=0,u=i.derToOid(n.macAlgorithm);switch(u){case j.oids.sha1:s=b.md.sha1.create(),t=20;break;case j.oids.sha256:s=b.md.sha256.create(),t=32}if(null===s)throw new Error("PKCS#12 uses unsupported MAC algorithm: "+u);var v=new b.util.ByteBuffer(n.macSalt),w="macIterations"in n?parseInt(b.util.bytesToHex(n.macIterations),16):1,x=k.generateKey(h,v,3,w,t,s),y=b.hmac.create();y.start(s,x),y.update(r.value);var z=y.getMac();if(z.getBytes()!==n.macDigest){var p=new Error("Confirm pfx password.");throw p.type=b.err.wrongPasswd,p}}return e(q,r.value,g,h,l),q},k.makeBagAttr=function(a,b){var c=[];return c.push(i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(j.oids.localKeyId).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,a)])])),"friendlyName"in b&&c.push(i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(j.oids.friendlyName).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[i.create(i.Class.UNIVERSAL,i.Type.BMPSTRING,!1,b.friendlyName)])])),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,c)},k.toPkcs12Asn1=function(c,d,e,f){a(),f=f||{},f.saltSize=f.saltSize||8,f.count=f.count||2048,f.algorithm=f.algorithm||f.encAlgorithm||"aes128",f.format=f.format||0,"useMac"in f||(f.useMac=!0),f.usePkcs12=!0;for(var g=[],h=[],l=[],m=0;m<c.length;m++)l.push(k.makeBagAttr(c[m].keyId,f));for(var m=0;m<c.length+d.length;m++){var n=null;n=m<c.length?c[m].cert:d[m-c.length];var o=m<c.length?l[m]:void 0,p=j.certificateToAsn1(n),q=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(j.oids.certBag).getBytes()),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(j.oids.x509Certificate).getBytes()),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,i.toDer(p).getBytes())])])]),o]);h.push(q)}for(var r=[],s=null,m=0;m<c.length;++m){var t=null;if(1&f.format){var u={},v=[],w=b.asn1.fromDer(c[m].priKey);if(!i.validate(w,j.pbe.encryptedPrivateKeyValidator,u,v)){var x=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw x.errors=v,x.type=b.err.decode,x}t=w}else t=j.priKeyToPriKeyInfo(c[m].priKey);s=null===e?i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(j.oids.keyBag).getBytes()),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[t]),l[m]]):i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(j.oids.pkcs8ShroudedKeyBag).getBytes()),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[1&f.format?t:j.encryptPrivateKeyInfo(t,e,f)]),l[m]]),1&f.format?h.push(s):r.push(s)}if(r.length>0){var y=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,r),z=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(j.oids.data).getBytes()),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,i.toDer(y).getBytes())])]);g.push(z)}if(h.length>0){var A=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,h),B=null;B=2&f.format?i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(j.oids.data).getBytes()),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,i.toDer(A).getBytes())])]):j.encryptDataWithPBE(A,e,f),g.push(B)}var C,D=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,g);if(f.useMac){var E=b.md.sha1.create(),F=new b.util.ByteBuffer(b.random.getBytes(f.saltSize)),G=f.count,H=k.generateKey(e,F,3,G,20),I=b.hmac.create();I.start(E,H),I.update(i.toDer(D).getBytes());var J=I.getMac();C=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(j.oids.sha1).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")]),i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,J.getBytes())]),i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,F.getBytes()),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(G).getBytes())])}return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(3).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(j.oids.data).getBytes()),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,i.toDer(D).getBytes())])]),C])},k.generateKey=b.pbe.generatePkcs12Key}var b="pkcs12";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./hmac","./oids","./pkcs7asn1","./pbe","./random","./rsa","./sha1","./util","./x509"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"tsp");var c=b.tsp=dreamsecurity.tsp||{},d=b.asn1,e=b.pki,f=(e.oids,{name:"TSTInfo",tagClass:d.Class.UNIVERSAL,type:d.Type.SEQUENCE,constructed:!0,value:[{name:"TSTInfo.version",tagClass:d.Class.UNIVERSAL,type:d.Type.INTEGER,constructed:!1,capture:"version"},{name:"TSTInfo.policy",tagClass:d.Class.UNIVERSAL,type:d.Type.OID,constructed:!1,capture:"policy"},{name:"TSTInfo.messageImprint",tagClass:d.Class.UNIVERSAL,type:d.Type.SEQUENCE,constructed:!0,captureAsn1:"messageImprint",value:[e.algIdValidator("TSTInfo.messageImprint.hashAlgorithm","TSTInfo.messageImprint.hashAlgorithm","hashAlgorithm","TSTInfo.messageImprint.parameters","hashAlgorithmParameters"),{name:"TSTInfo.messageImprint.hashedMessage",tagClass:d.Class.UNIVERSAL,type:d.Type.OCTETSTRING,constructed:!1,capture:"hashedMessage"}]},{name:"TSTInfo.serialNumber",tagClass:d.Class.UNIVERSAL,type:d.Type.INTEGER,constructed:!1,capture:"serialNumber"},{name:"TSTInfo.genTime",tagClass:d.Class.UNIVERSAL,type:d.Type.GENERALIZEDTIME,constructed:!1,capture:"genTime"},{name:"TSTInfo.accuracy",tagClass:d.Class.UNIVERSAL,type:d.Type.SEQUENCE,constructed:!0,optional:!0,capture:"accuracy",value:[{name:"TSTInfo.accuracy.seconds",tagClass:d.Class.UNIVERSAL,type:d.Type.INTEGER,constructed:!1,optional:!0,capture:"seconds"},{name:"TSTInfo.accuracy.millis",tagClass:d.Class.UNIVERSAL,type:d.Type.INTEGER,constructed:!1,optional:!0,capture:"millis"},{name:"TSTInfo.accuracy.micros",tagClass:d.Class.UNIVERSAL,type:d.Type.INTEGER,constructed:!1,optional:!0,capture:"micros"}]},{name:"TSTInfo.ordering",tagClass:d.Class.UNIVERSAL,type:d.Type.BOOLEAN,constructed:!1,optional:!0,capture:"ordering"},{name:"TSTInfo.nonce",tagClass:d.Class.UNIVERSAL,type:d.Type.INTEGER,constructed:!1,optional:!0,capture:"nonce"},{name:"TSTInfo.tsa",tagClass:d.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"tsa"},{name:"TSTInfo.extensions",tagClass:d.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,captureAsn1:"certExtensions"}]});c.tstInfoFromAsn1=function(b){a();var c={},g=[];if(!d.validate(b,f,c,g)){var h=new Error("Cannot read time stamp token. ASN.1 object is not an time stamp token.");throw h.errors=g,h}var i={};return i.msgImprint={},i.tsa={},i.version=c.version.charCodeAt(0),i.policy=d.derToOid(c.policy),i.msgImprint.hashAlg=d.derToOid(c.hashAlgorithm),i.msgImprint.hashedMessage=c.hashedMessage,i.serialNumber=c.serialNumber,i.genTime=d.generalizedTimeToDate(c.genTime),i.nonce=c.nonce,e.processGeneralName(c.tsa[0],i.tsa),i}}var b="tsp";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./oids","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a){if(a.type==j.Type.GENERALIZEDTIME)return j.generalizedTimeToDate(a.value);if(a.type==j.Type.NULL)return null;throw new Error("ASN.1 object is not an CertDateOfExpiration")}function d(a){var b={},c=[];if(a.type==j.Type.SEQUENCE){if(!j.validate(a,o,b,c)){var d=new Error("Cannot read ARCCertRequest. ASN.1 object is not an ARCCertRequest.");throw d.errors=c,d}var e={};if(e.version=b.version.charCodeAt(0),b.requester.type==j.Type.SEQUENCE){e.requester=[];for(var h=0;h<b.requester.value.length;h++){var i={};k.processGeneralName(b.requester.value[h],i),e.requester.push(i)}}else{if(b.requester.type!=j.Type.NULL)throw new Error("ASN.1 object is not an ARCCertRequest (invalid requester)");e.requester=null}if(b.requestTime.type==j.Type.GENERALIZEDTIME)e.requestTime=j.generalizedTimeToDate(b.requestTime.value);else{if(b.requester.type!=j.Type.NULL)throw new Error("ASN.1 object is not an ARCCertRequest (invalid requestTime)");e.requestTime=null}return e.policy=k.processCertPolicies(b.policy),e.target=f(b.target),e.nonce=b.nonce,e.extensions=g(b.extensions[0]),e}if(a.type==j.Type.NULL)return null;throw new Error("ASN.1 object is not an RequestInfo")}function e(a,c){var d={},e=[];if(!j.validate(a,p,d,e)){var f=new Error("Cannot read HashedDataInfo. ASN.1 object is not an HashedDataInfo.");throw f.errors=e,f}if(c.hashAlg=b.pki.oids[b.asn1.derToOid(d.hashAlgOid)],"string"!=typeof d.hashedData){for(var g="\x00",h=0;h<d.hashedData.length;++h)g+=j.toDer(d.hashedData[h]).getBytes();d.hashedData=g}var i=b.util.createBuffer(d.hashedData);++i.read,c.hashedData=i.getBytes()}function f(a){var b={};if(a.type==j.Type.SEQUENCE)throw b.choice="targetRecord",new Error("targetRecord in Target is not supported.");if(a.tagClass!=j.Class.CONTEXT_SPECIFIC)throw new Error("ASN.1 object is not an Target");if(0!=a.type)throw 1==a.type?(b.choice="targetDocInfo",new Error("targetDocInfo in Target is not supported.")):new Error("ASN.1 object is not an Target");return b.choice="targetHash",e(a.value[0],b),b}function g(a){for(var b=[],c=0;c<a.value.length;++c){var d=a.value[c],e={};if(e.id=j.derToOid(d.value[0].value),e.critical=!1,d.value[1].type===j.Type.BOOLEAN?(e.critical=0!==d.value[1].value.charCodeAt(0),e.value=d.value[2].value):e.value=d.value[1].value,!(e.id in l))throw new Error("Extension("+e.name+") is not supported.");e.name=l[e.id];var f=j.fromDer(e.value);if("kiec_usageType"===e.name){var g=0;f.value.length>1&&(g=f.value.charCodeAt(1)),e.online=128===(128&g),e.mobile=64===(64&g),e.paperEnable=32===(32&g)}b.push(e)}return b}function h(a){var b={};if(a.tagClass!=j.Class.CONTEXT_SPECIFIC)throw new Error("ASN.1 object is not an Target");if(0==a.type)throw b.choice="opRecord",new Error("opRecord in TargetToCertify is not supported.");if(1==a.type)throw b.choice="orgAndIssued",new Error("orgAndIssued in TargetToCertify is not supported.");if(2!=a.type)throw new Error("ASN.1 object is not an Target");return b.choice="dataHash",e(a.value[0],b),b}if(void 0==b&&"function"==typeof dreamsecurity.chkIntegrity)return void dreamsecurity.chkIntegrity(arguments.callee,"arccert");var i=b.arcCert=dreamsecurity.arcCert||{},j=b.asn1,k=b.pki,l=k.oids,m=b.pki.algIdValidator,n={name:"ARCCertInfo",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,value:[{name:"ARCCertInfo.version",tagClass:j.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"ARCCertInfo.version.integer",tagClass:j.Class.UNIVERSAL,type:j.Type.INTEGER,constructed:!1,capture:"version"}]},{name:"ARCCertInfo.serialNumber",tagClass:j.Class.UNIVERSAL,type:j.Type.INTEGER,constructed:!1,capture:"serialNumber"},{name:"ARCCertInfo.issuer",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,capture:"issuer"},{name:"ARCCertInfo.dateOfIssue",tagClass:j.Class.UNIVERSAL,type:j.Type.GENERALIZEDTIME,constructed:!1,capture:"dateOfIssue"},{name:"ARCCertInfo.dateOfExpiration",captureAsn1:"dateOfExpiration"},{name:"ARCCertInfo.policy",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,captureAsn1:"policy"},{name:"ARCCertInfo.requestInfo",captureAsn1:"requestInfo"},{name:"ARCCertInfo.target",captureAsn1:"target"},{name:"ARCCertInfo.extensions",tagClass:j.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"extensions"}]},o={name:"ARCCertReq",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,value:[{name:"ARCCertReq.version",tagClass:j.Class.UNIVERSAL,type:j.Type.INTEGER,constructed:!1,options:!0,capture:"version"},{name:"ARCCertReq.requester",captureAsn1:"requester"},{name:"ARCCertReq.requestTime",captureAsn1:"requestTime"},{name:"ARCCertReq.policy",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,captureAsn1:"policy"},{name:"ARCCertReq.target",captureAsn1:"target"},{name:"ARCCertReq.nonce",tagClass:j.Class.UNIVERSAL,type:j.Type.INTEGER,constructed:!1,capture:"nonce"},{name:"ARCCertReq.extensions",tagClass:j.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"extensions"}]},p={name:"HashedDataInfo",tagClass:j.Class.UNIVERSAL,type:j.Type.SEQUENCE,constructed:!0,value:[m("HashedDataInfo.hashAlg","AlgorithmIdentifier.algorithm","hashAlgOid","AlgorithmIdentifier.parameter","parameters"),{name:"HashedDataInfo.hashedData",tagClass:j.Class.UNIVERSAL,type:j.Type.BITSTRING,constructed:!1,capture:"hashedData"}]};i.arcCertResFromAsn1=function(e){a();var f={},i=[],l=new Error("Cannot read ARCCertResponse. ASN.1 object is not an ARCCertResponse.");if(e.tagClass!==j.Class.CONTEXT_SPECIFIC)throw l;var m={};if(0!=e.type)throw 1==e.type?new Error("The ARCCertResponse is an arcErrorNotice."):l;if(!j.validate(e.value[0],n,f,i))throw l.errors=i,l;m.version=f.version.charCodeAt(0);var o=b.util.createBuffer(f.serialNumber);m.serialNumber=o.toHex(),m.issuer=[];for(var p=0;p<f.issuer.length;p++){var q={};k.processGeneralName(f.issuer[p],q),m.issuer.push(q)}return m.dateOfIssue=j.generalizedTimeToDate(f.dateOfIssue),m.dateOfExpiration=c(f.dateOfExpiration),m.policy=k.processCertPolicies(f.policy),m.requestInfo=d(f.requestInfo),m.target=h(f.target),m.extensions=g(f.extensions[0]),m}}var b="arccert";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),a(dreamsecurity);var c=!0;define=function(a,b){b(require,module)}}var d,e=function(c,e){e.exports=function(e){var f=d.map(function(a){return c(a)}).concat(a);if(e=e||{},e.defined=e.defined||{},e.defined[b])return e[b];e.defined[b]=!0;for(var g=0;g<f.length;++g)f[g](e);return e[b]}},f=define;define=function(a,b){return d="string"==typeof a?b.slice(2):a.slice(2),c?(delete define,f.apply(null,Array.prototype.slice.call(arguments,0))):(define=f,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./oids","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function a(b){function c(a,b,c,d,e){a.func=b,a.name=c,a.code=d,"string"==typeof e?a.message=e:(a.message=e.message,void 0!==e.errors&&(a.detail=e.errors))}function d(a,b,d){c(this,a,"UnsupportedError",F.msg.unsupported|b,d)}function e(a,b,d){c(this,a,"WrongPasswordError",F.msg.wrongPasswd|b,d)}function f(a,b,d){c(this,a,"RevokedError",F.msg.revoked|b,d)}function g(a,b,d){c(this,a,"ExpiredError",F.msg.expired|b,d)}function h(a,b,d){c(this,a,"VidNotExistError",F.msg.vidNotExist|b,d)}function j(a,b,d){c(this,a,"NotValidRecpError",F.msg.notValidRecp|b,d)}function k(a,b,d){c(this,a,"EncryptError",F.op.encrypt|b,d)}function l(a,b,d){c(this,a,"DecryptError",F.op.decrypt|b,d)}function m(a,b,d){c(this,a,"SignError",F.op.sign|b,d)}function n(a,b,d){c(this,a,"VerifyError",F.op.verify|b,d)}function o(a,b,d){c(this,a,"GenerateError",F.op.generate|b,d)}function p(a,b,d){c(this,a,"ProcessError",F.op.process|b,d)}function q(a,b,d){c(this,a,"EncodeError",F.op.encode|b,d)}function r(a,b,d){c(this,a,"DecodeError",F.op.decode|b,d)}function s(a,b,d){c(this,a,"LicenseError",F.op.decode|b,d)}function t(a,b,d){c(this,a,"InvalidInputError",F.msg.invalidInput|b,d)}function u(a,b,c,i){var j=dreamsecurity.err;switch(void 0!==i.type&&(a=i.type),a){case j.unsupported:throw new d(b,c,i);case j.wrongPasswd:throw new e(b,c,i);case j.revoked:throw new f(b,c,i);case j.expired:throw new g(b,c,i);case j.encrypt:throw new k(b,c,i);case j.decrypt:throw new l(b,c,i);case j.sign:throw new m(b,c,i);case j.verify:throw new n(b,c,i);case j.generate:throw new o(b,c,i);case j.process:throw new p(b,c,i);case j.encode:throw new q(b,c,i);case j.decode:throw new r(b,c,i);case j.license:throw new s(b,c,i);case j.invalidInput:throw new t(b,c,i);case j.vidNotExist:throw new h(b,c,i);default:throw i}}function v(a){var c=null;if(a){if("string"==typeof a)return a;if("data"in a&&"string"==typeof a.data&&"read"in a&&"number"==typeof a.read)return a.data.slice(a.read)}else c=new Error("The input is null.");throw c||(c=new Error("The input is invalid type.")),c.type=dreamsecurity.err.invalidInput,c.code=b.err.msg.invalidInput,c}function w(a,b){var c=a.toLowerCase();if("sha256"==c||"sha1"==c)return c;throw new d(b,F.alg.md,'Unknown hash algorithm "'+c+'"')}function x(a,b){var c=void 0,d=void 0;return a?a.scheme&&"RSAES-PKCS1-V1_5"===a.scheme.toUpperCase()?d="RSAES-PKCS1-V1_5":!a.scheme&&a.md||a.scheme&&"RSA-OAEP"===a.scheme.toUpperCase()?(d="RSA-OAEP",c={},a.md?c.md=dreamsecurity.md.algorithms[a.md.toLowerCase()].create():b?c.md=b:c.md=dreamsecurity.md.algorithms.sha1.create()):d="RSAES-PKCS1-V1_5":d="RSAES-PKCS1-V1_5",{scheme:d,schemeOpts:c}}function y(a,b){if(!a)return"RSASSA-PKCS1-V1_5";if(a.scheme&&"RSASSA-PKCS1-V1_5"===a.scheme.toUpperCase())return"RSASSA-PKCS1-V1_5";if(!a.scheme&&a.md||a.scheme&&"RSA-PSS"===a.scheme.toUpperCase()){var c=20,d="sha1";b?d=b.toLowerCase():a.md&&(d=a.md.toLowerCase());var e=dreamsecurity.md.algorithms[d].create();return c=a.saltLength?a.saltLength:e.digestLength,dreamsecurity.pss.create({md:e,mgf:dreamsecurity.mgf.mgf1.create(dreamsecurity.md.algorithms[d].create()),saltLength:c})}return"RSASSA-PKCS1-V1_5"}function z(a){var b=null;switch(a.signAlg.name){case"sha1WithRSAEncryption":b=dreamsecurity.md.algorithms.sha1.create();break;case"sha256WithRSAEncryption":case"RSASSA-PSS":b=dreamsecurity.md.algorithms.sha256.create();break;default:b=dreamsecurity.md.algorithms.sha256.create()}return b}function A(a){var b="";for(i=a.attributes.length-1;i>=0;i--)i!=a.attributes.length-1&&(b+=","),b+=a.attributes[i].shortName+"="+dreamsecurity.util.decodeUtf8(a.attributes[i].value);return b}function B(a){var b={};if(b.id={oid:a.id,name:a.name},b.critical=a.critical,a.id===dreamsecurity.pki.oids.authorityKeyIdentifier)b.aki={},void 0!==a.keyIdentifier&&(b.aki.keyIdentifier=dreamsecurity.util.createBuffer(a.keyIdentifier)),void 0!==a.authorityCertIssuer&&(b.aki.authorityCertIssuer=A(a.authorityCertIssuer)),void 0!==a.authorityCertSerialNumber&&(b.aki.authorityCertSerialNumber=dreamsecurity.util.createBuffer(a.authorityCertSerialNumber).toHex());else if(a.id===dreamsecurity.pki.oids.subjectKeyIdentifier)b.ski=dreamsecurity.util.createBuffer(dreamsecurity.util.hexToBytes(a.subjectKeyIdentifier));else if(a.id===dreamsecurity.pki.oids.keyUsage)b.keyUsage={},b.keyUsage.cRLSign=a.cRLSign,b.keyUsage.dataEncipherment=a.dataEncipherment,b.keyUsage.decipherOnly=a.decipherOnly,b.keyUsage.digitalSignature=a.digitalSignature,b.keyUsage.encipherOnly=a.encipherOnly,b.keyUsage.keyAgreement=a.keyAgreement,b.keyUsage.keyCertSign=a.keyCertSign,b.keyUsage.keyEncipherment=a.keyEncipherment,b.keyUsage.nonRepudiation=a.nonRepudiation;else if(a.id===dreamsecurity.pki.oids.certificatePolicies){b.certPolicies=[];for(var c=0;c<a.certificatePolicies.length;c++)b.certPolicies.push(a.certificatePolicies[c])}else if(a.id===dreamsecurity.pki.oids.issuerAltName){b.issuerAltName=[];for(var c=0;c<a.altNames.length;c++)b.issuerAltName.push(a.altNames[c])}else if(a.id===dreamsecurity.pki.oids.subjectAltName){b.subjectAltName=[];for(var c=0;c<a.altNames.length;c++)b.subjectAltName.push(a.altNames[c])}else a.id===dreamsecurity.pki.oids.basicConstraints?(b.basicConsts={},b.basicConsts.cA=a.cA,b.basicConsts.pathLenConstraint=a.pathLenConstraint):a.id===dreamsecurity.pki.oids.policyConstraints?b.policyConsts=a.policyConstraints:a.id===dreamsecurity.pki.oids.cRLDistributionPoints?b.crlDPs=a.cRLDistributionPoints:a.id===dreamsecurity.pki.oids.authorityInfoAccess&&(b.aia=a.authorityInfoAccess);return b}function C(a){var b={};b.userCert=a.userCertificate,b.revocationDate=a.revocationDate,b.extensions=[];for(var c=0;c<a.exts.length;c++)b.extensions.push(D(a.exts[c]));return b}function D(a){var b={};if(b.id={oid:a.id,name:a.name},b.critical=a.critical,a.id===dreamsecurity.pki.oids.authorityKeyIdentifier)b.aki={},void 0!==a.keyIdentifier&&(b.aki.keyIdentifier=dreamsecurity.util.createBuffer(a.keyIdentifier)),void 0!==a.authorityCertIssuer&&(b.aki.authorityCertIssuer=A(a.authorityCertIssuer)),void 0!==a.authorityCertSerialNumber&&(b.aki.authorityCertSerialNumber=dreamsecurity.util.createBuffer(a.authorityCertSerialNumber).toHex());else if(a.id===dreamsecurity.pki.oids.issuerAltName){b.issuerAltName=[];for(var c=0;c<a.altNames.length;c++)b.issuerAltName.push(a.altNames[c])}else a.id===dreamsecurity.pki.oids.cRLNumber?b.cRLNumber=a.cRLNumber:a.id===dreamsecurity.pki.oids.issuingDistributionPoint?(b.issuingDistributionPoint={},b.issuingDistributionPoint.distributionPoint=a.distributionPoint,b.issuingDistributionPoint.onlyContainsUserCerts=a.onlyContainsUserCerts,b.issuingDistributionPoint.onlyContainsCACerts=a.onlyContainsCACerts,b.issuingDistributionPoint.indirectCRL=a.indirectCRL,b.issuingDistributionPoint.onlyContainsAttributeCerts=a.onlyContainsAttributeCerts):a.id===dreamsecurity.pki.oids.cRLReason?b.cRLReason=a.cRLReason:a.id===dreamsecurity.pki.oids.invalidityDate&&(b.invalidityDate=a.invalidityDate);return b}function E(a){return a.key.read=0,a.parameter.read=0,{algorithm:dreamsecurity.pki.oids[a.algorithm],key:a.key,iv:a.parameter.copy()}}if(void 0==b){if(dreamsecurity.chkIntegrity)return void("function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"magicjs"));throw new Error("The MagicJS is not initialized!!")}b.version="1.0.4.1",b.md=b.md||{},b.hmac=b.hmac||{},b.cipher=b.cipher||{},b.pubKey=b.pubKey||{},b.priKey=b.priKey||{},b.pkcs5=b.pkcs5||{},b.x509Cert=b.x509Cert||{},b.x509Crl=b.x509Crl||{},b.pkcs7=b.pkcs7||{},b.pkcs7.signedData=b.pkcs7.signedData||{},b.pkcs7.envelopedData=b.pkcs7.envelopedData||{},b.pkcs7.signedAndEnvData=b.pkcs7.signedAndEnvData||{},b.pkcs10=b.pkcs10||{},b.pkcs12=b.pkcs12||{},b.tsp=b.tsp||{},b.tsp.token=b.tsp.token||{},b.arcCert=b.arcCert||{},b.arcCert.response=b.arcCert.response||{},b.pem=b.pem||{},b.base64=b.base64||{},b.hex=b.hex||{},b.utf8=b.utf8||{},b.err=b.err||{},b.ByteStringBuffer=b.ByteStringBuffer||{};var F={};F.data={keyPair:16777216,secretKey:33554432,x509Cert:50331648,x509Crl:67108864,pubKey:83886080,priKey:100663296,encPriKey:117440512,signedData:134217728,envelopedData:150994944,pkcs10Csr:167772160,pkcs12Pfx:184549376,signedAndEnvData:201326592,tsp:218103808,arcCert:234881024,bitMask:251658240},F.encoding={der:1048576,base64:2097152,pem:3145728,hex:4194304,utf8:5242880,bitMask:15728640},F.alg={md:65536,symmetric:131072,asymmetric:196608,sign:262144,hmac:327680,rand:393216,bitMask:983040},F.op={encrypt:4096,decrypt:8192,sign:12288,verify:16384,generate:20480,process:24576,encode:28672,decode:32768,bitMask:61440},F.step={init:256,udpate:512,finish:768,bitMask:3840},F.msg={unsupported:1,wrongPasswd:2,revoked:3,expired:4,vidNotExist:5,notValidRecp:6,invalidInput:7,bitMask:15},b.err=F||b.err,d.prototype=Error.prototype,e.prototype=Error.prototype,f.prototype=Error.prototype,g.prototype=Error.prototype,h.prototype=Error.prototype,k.prototype=Error.prototype,l.prototype=Error.prototype,m.prototype=Error.prototype,n.prototype=Error.prototype,o.prototype=Error.prototype,p.prototype=Error.prototype,q.prototype=Error.prototype,r.prototype=Error.prototype,t.prototype=Error.prototype,b.init=function(a){"gf"==a?dreamsecurity.vi.gf=!0:(dreamsecurity.vi.s=a,dreamsecurity.vi.gf=!1)},b.md.create=function(b){var c="ds.md.create",e=b.toLowerCase(),f={algorithm:e};if(!(e in dreamsecurity.md.algorithms))throw new d(c,F.alg.hmac,'Unknown message digest algorithm "'+e+'"');try{a(),f.engine=dreamsecurity.md.algorithms[e].create()}catch(g){u(dreamsecurity.err.generate,c,F.alg.md|F.step.init,g)}return f.update=function(b,c){try{a(),f.engine.update(v(b),c)}catch(d){u(dreamsecurity.err.generate,"ds.md.udpate",F.alg.md|F.step.update,d)}},f.digest=function(){try{return a(),f.engine.digest()}catch(b){u(dreamsecurity.err.generate,"ds.md.digest",F.alg.md|F.step.finish,b)}},f},b.hmac.create=function(b){var c=b.toLowerCase(),e={algorithm:c};if(!(c in dreamsecurity.md.algorithms))throw new d("ds.hamc.create",F.alg.hmac,'Unknown mac algorithm "'+c+'"');try{a(),e.engine=dreamsecurity.hmac.create()}catch(f){u(dreamsecurity.err.generate,"ds.hamc.create",F.alg.hamc|F.step.init,f)}return e.init=function(b){try{a(),e.engine.start(e.algorithm,b)}catch(c){u(dreamsecurity.err.generate,"ds.hmac.init",F.alg.hmac|F.step.init,c)}},e.update=function(b){try{a(),e.engine.update(v(b))}catch(c){u(dreamsecurity.err.generate,"ds.hmac.udpate",F.alg.hmac|F.step.update,c)}},e.generate=function(){try{return a(),e.engine.digest()}catch(b){u(dreamsecurity.err.generate,"ds.hmac.generate",F.alg.hmac|F.step.finish,b)}},e.verify=function(b){try{a();var c=e.generate();return c.toHex()==dreamsecurity.util.bytesToHex(v(b))}catch(d){u(dreamsecurity.err.generate,"ds.hmac.verify",F.alg.hmac|F.step.finish,d)}},e},b.cipher.create=function(b,c,e){var f={algorithm:c.toUpperCase(),encrypt:b};try{a();var g=0,h=f.algorithm;if(0==h.indexOf("SEED")||-1!=h.indexOf("128"))g=16;else if(0==h.indexOf("3DES")||-1!=h.indexOf("192"))g=24;else if(-1!=h.indexOf("256"))g=32;else{if(0!=h.indexOf("DES"))throw new d("ds.cipher.create",F.alg.symmetric,'Unknown cipher algorithm "'+h+'"');g=8}var i=v(e);g!=i.length&&u(f.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.create",F.alg.symmetric,"The "+i.length+" bytes key length is not valid for "+h+" algorithm."),0==h.indexOf("AES")?h="AES-CBC":0==h.indexOf("ARIA")&&(h="ARIA-CBC"),1==b?f.engine=dreamsecurity.cipher.createCipher(h,i):f.engine=dreamsecurity.cipher.createDecipher(h,i)}catch(j){u(f.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.create",F.alg.symmetric,j)}return f.init=function(b){try{a(),f.engine.start({iv:v(b)})}catch(c){u(f.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.init",F.alg.symmetric|F.step.init,c)}},f.update=function(b){try{a(),f.engine.update(dreamsecurity.util.createBuffer(b))}catch(c){u(f.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.update",F.alg.symmetric|F.step.update,c)}},f.finish=function(b){if(void 0!=b&&"pkcs5padding"!=b.toLowerCase())throw new d("ds.cipher.finish",F.alg.symmetric|F.step.finish,'Unknown padding : "'+b+'"');
try{a(),f.engine.finish()||u(f.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.finish",F.alg.symmetric|F.step.finish,"The Operation failed.")}catch(c){u(f.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.finish",F.alg.symmetric|F.step.finish,c)}return f.output=f.engine.output,f.output},f},b.generateRandomBytes=function(a){try{return dreamsecurity.util.createBuffer(dreamsecurity.random.getBytesSync(a))}catch(b){u(dreamsecurity.err.generate,"ds.generateRandomBytes",F.alg.rand,b)}},b.generateKey=function(a,c){var e=a.toUpperCase(),f=0;if(-1!=e.indexOf("SEED")?f=16:-1!=e.indexOf("AES")||-1!=e.indexOf("ARIA")?void 0!=c&&void 0!=c.bits&&null!=c&&null!=c.bits?f=c.bits/8:-1!=e.indexOf("128")?f=16:-1!=e.indexOf("192")?f=24:-1!=e.indexOf("256")&&(f=32):-1!=e.indexOf("3DES")?f=24:-1!=e.indexOf("DES")&&(f=8),0==f)throw new d("ds.generateKey",F.alg.symmetric,'Unknown algorithm : "'+a+'"');try{return b.generateRandomBytes(f)}catch(g){throw g.func="ds.generateRandomBytes",g}},b.generateKeyPair=function(c,e){var f={},g=null,h=c.toLowerCase();if("rsa"!=h)throw new d("ds.generateKeyPair",F.alg.asymmetric,'Unknown algorithm : "'+c+'"');g=dreamsecurity.pki.rsa;try{a(),f=g.generateKeyPair(e),f.privateKey.algName=h,f.publicKey.algName=h,f.privateKey=b.priKey.create(f.privateKey),f.publicKey=b.pubKey.create(f.publicKey)}catch(i){if(void 0!==i.func)throw i.func="ds.generateKeyPair",i;u(dreamsecurity.err.generate,"ds.generateKeyPair",F.alg.asymmetric,i)}return f},b.pubKey.create=function(c){var e={algorithm:"",keyLength:0},f=0;try{if(a(),"string"==typeof c){var g=null;0===c.lastIndexOf("-----",0)?(f=F.encoding.pem,g=dreamsecurity.pem.decode(c)[0],g=g.body):(f=F.encoding.base64,g=b.base64.decode(c)),f=F.encoding.der,e.engine=dreamsecurity.pki.publicKeyFromAsn1(dreamsecurity.asn1.fromDer(g))}else e.engine=c}catch(h){throw new r("ds.pubKey.create",F.data.pubKey|f,h)}if(e.algorithm=e.engine.algName,null!=e.engine.n)e.keyLength=e.engine.n.bitLength();else{if(null==e.engine.p)throw new d("ds.pubKey.create",F.data.pubKey,"The publicKey is not for RSA or KCDSA.");e.keyLength=e.engine.p.bitLength()}return e.toDer=function(){var b=null;try{a(),b=dreamsecurity.pki.publicKeyToSubjectPublicKeyInfo(e.engine)}catch(c){throw new q("ds.pubKey.toDer",F.data.pubKey|F.encoding.der,c)}return dreamsecurity.asn1.toDer(b).copy()},e.toPem=function(){try{return a(),b.pem.encode(e,"PUBLIC KEY")}catch(c){throw new q("ds.pubKey.toPem",F.data.pubKey|F.encoding.pem,c)}},e.verify=function(b,c,d){if("rsa"!=e.algorithm)throw new n("ds.pubKey.verify",F.data.pubKey,"Wrong usage. This verify method works when public key is for RSA.");try{a();var f=y(d);return e.engine.verify(b.engine.digest().getBytes(),v(c),f)}catch(g){u(dreamsecurity.err.verify,"ds.pubKey.verify",F.data.pubKey,g)}},e.verifySignature=function(b,c,d,f){try{var g="ds.pubKey.verifySignature";a();var h=w(c,g);if("rsa"==e.algorithm){var i=dreamsecurity.md.algorithms[h].create();i.update(v(b));var j=y(f);return e.engine.verify(i.digest().getBytes(),v(d),j)}return e.engine.verify(v(b),h,v(d))}catch(k){u(dreamsecurity.err.verify,g,F.data.pubKey,k)}},e.encrypt=function(b,c){var d="ds.pubKey.encrypt";try{a();var f=x(c);return e.engine.encrypt(v(b),f.scheme,f.schemeOpts)}catch(g){u(dreamsecurity.err.encrypt,d,F.data.pubKey,g)}},e.decrypt=function(b){try{a();x(null);return dreamsecurity.pki.rsa.decrypt(v(b),e.engine,!0,!0)}catch(c){throw new l("ds.pubKey.decrypt",F.data.pubKey,c)}},e},b.priKey.create=function(c){var e={algorithm:"",keyLength:0},f=0;try{if(a(),"string"==typeof c){if(0===c.lastIndexOf("-----",0))f=F.encoding.pem,e.engine=dreamsecurity.pki.privateKeyFromPem(c);else{f=F.encoding.base64;var g=b.base64.decode(c);f=F.encoding.der,e.engine=dreamsecurity.pki.privateKeyFromAsn1(dreamsecurity.asn1.fromDer(g))}}else e.engine=c}catch(i){throw new r("ds.priKey.create",F.data.priKey|f,i)}if(e.algorithm=e.engine.algName,null!=e.engine.n)e.keyLength=e.engine.n.bitLength();else{if(null==e.engine.p)throw new d("ds.priKey.create",F.data.priKey,"The priKey is not supported algorithm.");e.keyLength=e.engine.p.bitLength()}return e.getRandomNum=function(){if(a(),void 0!=e.engine.randomNum)return e.engine.randomNum;throw new h("ds.priKey.getRandomNum",F.data.priKey,"The priKey does not have a random number for VID.")},e.toDer=function(){var b=null;try{a(),b=dreamsecurity.pki.priKeyToPriKeyInfo(e.engine)}catch(c){throw new q("ds.priKey.toDer",F.data.priKey|F.encoding.der,c)}return dreamsecurity.asn1.toDer(b).copy()},e.toPem=function(){try{return a(),b.pem.encode(e,"PRIVATE KEY")}catch(c){throw new q("ds.priKey.toPem",F.encoding.pem,c)}},e.sign=function(b,c){if(a(),"rsa"!=e.algorithm)throw new m("ds.priKey.sign",F.data.priKey,"Wrong usage. This sign method works when private key is for RSA.");var d=y(c);return e.engine.sign(b.engine,d)},e.generateSignature=function(b,c,d){try{var f="ds.priKey.generateSignature";a();var g=w(c,f);if("rsa"==e.algorithm){var h=dreamsecurity.md.algorithms[g].create();h.update(v(b));var i=y(d);return e.engine.sign(h,i)}if("kcdsa"==e.algorithm){if(void 0==d||void 0==d.pubKey||null==d.pubKey)throw new m(f,F.data.priKey,"The publicKey is requred to KCDSA sign.");return e.engine.sign(v(b),g,d.pubKey.engine.y)}throw new m(f,F.data.priKey,"The "+e.algorithm+" sign is not supported.")}catch(j){u(dreamsecurity.err.sign,f,F.data.priKey,j)}},e.decrypt=function(b,c){try{a();var d=x(c);return e.engine.decrypt(v(b),d.scheme,d.schemeOpts)}catch(f){u(dreamsecurity.err.decrypt,"ds.priKey.decrypt",F.data.priKey,f)}},e.encrypt=function(b){try{return a(),dreamsecurity.pki.rsa.encrypt(v(b),e.engine,1)}catch(c){u(dreamsecurity.err.encrypt,"ds.priKey.encrypt",F.data.priKey,c)}},e},b.x509Cert.create=function(c){var d={},e=null,f=0;try{if(a(),"string"==typeof c)if(0===c.lastIndexOf("-----",0))f=F.encoding.pem,e=dreamsecurity.pki.certificateFromPem(c);else{f=F.encoding.base64;var g=b.base64.decode(c);f=F.encoding.der,e=dreamsecurity.pki.certificateFromAsn1(dreamsecurity.asn1.fromDer(g))}else e=c}catch(h){throw new r("ds.x509Cert.create",F.data.x509Cert|f,h)}d.engine=e,d.version=e.version+1,d.serialNum=e.serialNumber,d.issuer=A(e.issuer),d.signAlg={oid:e.signatureOid,name:dreamsecurity.pki.oids[e.signatureOid]},d.validity={notBefore:e.validity.notBefore,notAfter:e.validity.notAfter},d.subject=A(e.subject),d.pubKey=b.pubKey.create(e.publicKey),d.signature=dreamsecurity.util.createBuffer(),d.signature.putBytes(e.signature),d.extensions=[];for(var i=0;i<e.extensions.length;i++)d.extensions.push(B(e.extensions[i]));return d.toPem=function(){try{return a(),dreamsecurity.pki.certificateToPem(d.engine)}catch(b){throw new q("ds.x509Cert.toPem",F.data.x509Cert|F.encoding.pem,b)}},d.toDer=function(){try{return a(),dreamsecurity.asn1.toDer(dreamsecurity.pki.certificateToAsn1(d.engine))}catch(b){throw new q("ds.x509Cert.toDer",F.data.x509Cert|F.encoding.der,b)}},d.verifyVID=function(a,b){return d.makeVID(a,b,2,!0)},d.makeVID=function(b,c,e,f){var g=!1;void 0!=f&&null!=f&&(g=f);var h="ds.x509Cert."+(g?"verifyVID":"makeVirtualID");try{a();var i=0,j=!1;for(i=0;i<d.extensions.length;i++)if(null!=d.extensions[i].subjectAltName){j=!0;break}if(!j)throw new Error("VidNotExist");for(altName=d.extensions[i].subjectAltName,i=0;i<altName.length;i++)if(null!=altName[i].otherName){if(null==altName[i].otherName.vid)throw new Error("VidNotExist");var k=dreamsecurity.asn1,l=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.PRINTABLESTRING,!1,v(c)),k.create(k.Class.UNIVERSAL,k.Type.BITSTRING,!1,String.fromCharCode(0)+v(b))]),m=k.toDer(l).getBytes(),n=w(altName[i].otherName.vid.hashAlg,h),o=dreamsecurity.md.algorithms[n].create();o.update(m);var p=o.digest();if(void 0!=e&&null!=e&&2==e){var q=dreamsecurity.md.algorithms[n].create();if(q.update(p.getBytes()),p=q.digest(),g)return p.toHex()==altName[i].otherName.vid.value.toHex()}return p}throw new Error("VidNotExist")}catch(r){r.message&&"VidNotExist"==r.message&&(r.message="The certificate does not have a vid information.",r.type=dreamsecurity.err.vidNotExist),u(dreamsecurity.err.encode,h,F.data.x509Cert|F.encoding.der,r)}},d},b.x509Cert.verify=function(b,c){try{a();var d=[];d[0]=b.engine;for(var e=dreamsecurity.pki.createCaStore(null),f=0;f<c.length;f++)e.addCertificate(c[f].engine);dreamsecurity.pki.verifyCertificateChain(e,d)}catch(g){u(dreamsecurity.err.verify,"ds.x509Cert.verify",F.data.x509Cert,g)}},b.x509Crl.create=function(c,d){var e={},f=null,g=0,h=0;try{if(a(),"string"==typeof c)if(0===c.lastIndexOf("-----",0))h=F.encoding.pem,f=dreamsecurity.pki.certificateRevocationListFromPem(c);else{h=F.encoding.base64;var i=b.base64.decode(c);h=F.encoding.der,f=dreamsecurity.pki.certificateRevocationListFromAsn1(dreamsecurity.asn1.fromDer(i))}else f=c}catch(j){throw new r("ds.x509Crl.create",F.data.x509Crl|h,j)}try{if(e.engine=f,e.version=f.version+1,e.issuer=A(f.issuer),e.signAlg={oid:f.signatureOid,name:dreamsecurity.pki.oids[f.signatureOid]},e.thisUpdate=f.thisUpdate,e.nextUpdate=f.nextUpdate,e.signature=dreamsecurity.util.createBuffer(),e.signature.putBytes(f.signature),e.revokedCerts=[],d)for(f.revokedCerts=dreamsecurity.pki.revokedCertificatesFromAsn1(f.revokedCertsAsn1),g=0;g<f.revokedCerts.length;g++)e.revokedCerts.push(C(f.revokedCerts[g]));for(e.extensions=[],g=0;g<f.extensions.length;g++)e.extensions.push(D(f.extensions[g]))}catch(j){throw new p("ds.x509Crl.create",F.data.x509Crl,j)}return e.toPem=function(){try{return b.pem.encode(e,b.pem.type.crl)}catch(a){throw new q("ds.x509Crl.toPem",F.data.x509Crl|F.encoding.pem,a)}},e.toDer=function(){try{return a(),dreamsecurity.asn1.toDer(e.engine.toAsn1())}catch(b){throw new q("ds.x509Crl.toDer",F.data.x509Crl|F.encoding.der,b)}},e.verify=function(b){try{return a(),e.engine.verify(b.engine)}catch(c){u(dreamsecurity.err.verify,"ds.x509Crl.verify",F.data.x509Crl,c)}},e.isRevoked=function(b){try{return a(),e.engine.isRevoked(b)}catch(c){throw new p("ds.x509Crl.isRevoked",F.data.x509Crl,c)}},e},b.pkcs5.encrypt=function(b,c,e){if("rsa"!==b.algorithm&&"kcdsa"!==b.algorithm)throw new d("ds.pkcs5.encrypt",F.data.priKey,"Unknown privateKey algorithm : "+b.algorithm);try{a();var f=dreamsecurity.pki.priKeyToPriKeyInfo(b.engine),g=dreamsecurity.pki.encryptPrivateKey(f,v(c),e)}catch(h){throw new k("ds.pkcs5.encrypt",F.data.priKey,h)}return g},b.pkcs5.decrypt=function(a,c,d){var e=null,f=0;d=d||!1;try{if("string"==typeof a){var g=null;0===a.lastIndexOf("-----",0)?(f=F.encoding.pem,e=b.pem.decode(a),g=e.body):(f=F.encoding.base64,g=b.base64.decode(a)),f=F.encoding.der,e=dreamsecurity.asn1.fromDer(g)}}catch(h){throw new r("ds.pkcs5.decrypt",F.data.encPriKey|f,h)}var i=null,j=null;try{i=dreamsecurity.pki.decryptPrivateKeyInfo(e,v(c),d)}catch(h){var k=F.data.encPriKey;void 0!==h.type&&h.type===dreamsecurity.err.decode&&(k|=F.encoding.der),u(dreamsecurity.err.decrypt,"ds.pkcs5.decrypt",k,h)}try{if(j=d?i.privateKey:i,null==j)throw new Error("Confirm privateKey password.");return j=b.priKey.create(dreamsecurity.pki.privateKeyFromAsn1(j)),d?{algorithm:i.pbeAlg,version:i.pkcs5Version,fixedIv:i.fixedIv,priKey:j}:j}catch(h){void 0===h.type&&(h.message="Confirm privateKey password."),u(dreamsecurity.err.wrongPasswd,"ds.pkcs5.decrypt",F.data.encPriKey,h)}},b.pkcs5.changePassword=function(a,c,d){try{var e=b.pkcs5.decrypt(a,c,!0),f=e.algorithm.toLowerCase(),g=f.indexOf("-cbc");g>0&&(f=f.substr(0,g));var h={};h.algorithm=f,h.version=e.version,h.fixedIv=e.fixedIv;var i=dreamsecurity.pki.priKeyToPriKeyInfo(e.priKey.engine);return dreamsecurity.pki.encryptPrivateKey(i,v(d),h)}catch(j){throw new p("ds.pkcs5.changePassword",j.code,j)}},b.pkcs7.signedData.format={},b.pkcs7.signedData.format.none=0,b.pkcs7.signedData.format.useContentInfo=1,b.pkcs7.signedData.format.noContent=2,b.pkcs7.signedData.format.signGateFormat=4,b.pkcs7.signedData.format.hashedContent=18,b.pkcs7.signedData.create=function(c){var d={},e=0;try{if(a(),null!=c)if(0===c.lastIndexOf("-----",0))e=F.encoding.pem,d.engine=dreamsecurity.pkcs7.messageFromPem(c);else{e=F.encoding.base64;var f=b.base64.decode(c);e=F.encoding.der,d.engine=dreamsecurity.pkcs7.messageFromAsn1(dreamsecurity.asn1.fromDer(f))}else d.engine=dreamsecurity.pkcs7.createSignedData()}catch(g){throw new r("ds.pkcs7.signedData.create",F.data.signedData|e,g)}return d.content=null,d.signerInfos=[],d.certificates=[],d.addSign=function(a,b,c){try{if(!d.verify())throw new p("ds.pkcs7.signedData.addSign",F.data.signedData,"There is a signature can't verify.");d.sign(a,b,c)}catch(e){throw e.func="ds.pkcs7.signedData.addSign",e}},d.sign=function(b,c,e){var f=null,g=null,h=null,i="ds.pkcs7.signedData.sign";try{if(a(),e){if(e.md){var j=w(e.md,i);f=dreamsecurity.md.algorithms[j].create()}e.format&&(h=e.format)}f||(f=z(b)),g=y(e,f.algorithm),d.engine.content=v(d.content);var k=0;for(k=0;k<d.certificates.length;k++)d.engine.addCertificate(d.certificates[k].engine);d.engine.sign(b.engine,c.engine,f,g,h)}catch(l){throw new o(i,F.data.signedData,l)}},d.toDer=function(){try{return a(),dreamsecurity.asn1.toDer(d.engine.toAsn1())}catch(b){throw new q("ds.pkcs7.signedData.toDer",F.data.signedData|F.encoding.der,b)}},d.toPem=function(){try{return b.pem.encode(d,b.pem.type.pkcs7)}catch(a){throw new q("ds.pkcs7.signedData.toPem",F.data.signedData|F.encoding.pem,a)}},d.verify=function(){if(null==d.engine.content){if(null==d.content)throw new p("ds.pkcs7.signedData.verify",F.data.signedData,"The content is required. The SignedData does not have a content.");d.engine.content=v(d.content)}try{if(a(),!d.engine.verify())return!1;d.content=d.engine.content,d.signerInfos=[],d.certificates=[];var c=0,e=[];for(c=0;c<d.engine.certificates.length;c++)e.push(!1);var f=d.engine.getSignerInfos();for(c=0;c<f.length;c++)e[f[c].certIndex]=!0,d.signerInfos.push({cert:b.x509Cert.create(d.engine.certificates[f[c].certIndex]),signingTime:f[c].signingTime});for(c=0;c<e.length;c++)e[c]||d.certificates.push(b.x509Cert.create(d.engine.certificates[c]));return!0}catch(g){throw new p("ds.pkcs7.signedData.verify",F.data.signedData,g)}},d},b.pkcs7.envelopedData.create=function(c){var e={},f=0;try{if(a(),null!=c)if(0===c.lastIndexOf("-----",0))f=F.encoding.pem,e.engine=dreamsecurity.pkcs7.messageFromPem(c);else{f=F.encoding.base64;var g=b.base64.decode(c);f=F.encoding.der,e.engine=dreamsecurity.pkcs7.messageFromAsn1(dreamsecurity.asn1.fromDer(g))}else e.engine=dreamsecurity.pkcs7.createEnvelopedData()}catch(h){throw new r("ds.pkcs7.envelopedData.create",F.data.envelopedData|f,h)}return e.content=null,e.contentEncInfo={},e.addRecipient=function(b,c){var d=null,f=null,g="ds.pkcs7.envelopedData.addRecipient";try{a(),c&&c.scheme&&"RSA-OAEP"==c.scheme.toUpperCase()&&(void 0!=c.md&&null!=c.md||(f=z(b))),d=x(c,f),e.engine.addRecipient(b.engine,d.scheme,d.schemeOpts)}catch(h){throw new o(g,F.data.envelopedData,h)}},e.encrypt=function(b,c){var f=b.split("-"),g="ds.pkcs7.envelopedData.encrypt";if(f.length<2)throw new d(g,F.alg.symmetric,'Invalid cipher algorithm form. (ex. "SEED-CBC") : '+b);var h=1,i=f[0].toLowerCase();if(3===f.length&&(i+="-"+f[1].toUpperCase(),h=2),"seed"===i)algName="seed";else if("3des"===i||"des-EDE3"===i)algName="des-EDE3-";else if("aes"===i||"aes128"===i)algName="aes128-";else if("aes192"===i)algName="aes192-";else if("aes256"===i)algName="aes256-";else if("aria"===i||"aria128"===i)algName="aria";else if("aria192"===i)algName="aria192-";else{if("aria256"!==i)throw new d(g,F.alg.symmetric,"Unknown cipher algorithm  : "+b);algName="aria256-"}if(algName+=f[h].toUpperCase(),void 0===dreamsecurity.pki.oids[algName])throw new d(g,F.alg.symmetric,"Unknown cipher algorithm  : "+b);try{a(),e.engine.content=new dreamsecurity.util.ByteBuffer(e.content),e.engine.encrypt(c,dreamsecurity.pki.oids[algName]),e.contentEncInfo=E(e.engine.encryptedContent)}catch(j){throw new o(g,F.data.envelopedData,j)}},e.toDer=function(){try{return a(),dreamsecurity.asn1.toDer(e.engine.toAsn1())}catch(b){throw new q("ds.pkcs7.envelopedData.toDer",F.data.envelopedData|F.encoding.der,b)}},e.toPem=function(){try{return b.pem.encode(e,b.pem.type.pkcs7)}catch(a){throw new q("ds.pkcs7.envelopedData.toPem",F.data.envelopedData|F.encoding.pem,a)}},e.decrypt=function(b,c){var d=null,f="ds.pkcs7.envelopedData.decrypt";try{if(a(),null==(d=e.engine.findRecipient(b.engine)))throw new j(f,F.data.envelopedData,"The certificiate is not a valid recipient.");e.engine.decrypt(d,c.engine),e.content=e.engine.content.getBytes(),e.contentEncInfo=E(e.engine.encryptedContent)}catch(g){throw new p(f,F.data.envelopedData,g)}},e},b.pkcs7.signedAndEnvData.create=function(c){var e={},f=0;try{if(a(),null!=c)if(0===c.lastIndexOf("-----",0))f=F.encoding.pem,e.engine=dreamsecurity.pkcs7.messageFromPem(c);else{f=F.encoding.base64;var g=b.base64.decode(c);f=F.encoding.der,e.engine=dreamsecurity.pkcs7.messageFromAsn1(dreamsecurity.asn1.fromDer(g))}else e.engine=dreamsecurity.pkcs7.createSignedAndEnvelopedData()}catch(h){throw new r("ds.pkcs7.signedAndEnvData.create",F.data.signedAndEnvData|f,h)}return e.content=null,e.signerInfos=[],e.certificates=[],e.contentEncInfo={},e.signAndEnv=function(b,c,f,g){var h=null,i=null,j=null,k="ds.pkcs7.signedAndEnvData.signAndEnv";try{if(a(),g&&g.md){var l=w(g.md,k);h=dreamsecurity.md.algorithms[l].create()}h||(h=z(b)),i=y(g,h.algorithm);var m=f.split("-");if(m.length<2)throw new d(k,F.alg.symmetric,'Invalid cipher algorithm form. (ex. "SEED-CBC") : '+f);var n=1,p=m[0].toLowerCase();if(3===m.length&&(p+="-"+m[1].toUpperCase(),n=2),"seed"===p)algName="seed";else if("3des"===p||"des-EDE3"===p)algName="des-EDE3-";else if("aes"===p||"aes128"===p)algName="aes128-";else if("aes192"===p)algName="aes192-";else if("aes256"===p)algName="aes256-";else if("aria"===p||"aria128"===p)algName="aria";else if("aria192"===p)algName="aria192-";else{if("aria256"!==p)throw new d(k,F.alg.symmetric,"Unknown cipher algorithm  : "+f);algName="aria256-"}if(algName+=m[n].toUpperCase(),void 0===dreamsecurity.pki.oids[algName])throw new d(k,F.alg.symmetric,"Unknown cipher algorithm  : "+f);e.engine.content=new dreamsecurity.util.ByteBuffer(e.content);var q=0;for(q=0;q<e.certificates.length;q++)e.engine.addCertificate(e.certificates[q].engine);e.engine.signAndEnv(b.engine,c.engine,h,i,j,g?g.key:null,dreamsecurity.pki.oids[algName]),e.contentEncInfo=E(e.engine.encryptedContent)}catch(r){throw new o(k,F.data.signedAndEnvData,r)}},e.toDer=function(){try{return a(),dreamsecurity.asn1.toDer(e.engine.toAsn1())}catch(b){throw new q("ds.pkcs7.signedAndEnvData.toDer",F.data.signedAndEnvData|F.encoding.der,b)}},e.toPem=function(){try{return b.pem.encode(e,b.pem.type.pkcs7)}catch(a){throw new q("ds.pkcs7.signedAndEnvData.toPem",F.data.signedAndEnvData|F.encoding.pem,a)}},e.verifyAndDec=function(c,d){try{a();var f=null,g="ds.pkcs7.signedAndEnvData.verifyAndDec";if(null==(f=e.engine.findRecipient(c.engine)))throw new j(g,F.data.signedAndEnvData,"The certificiate is not a valid recipient.");if(!e.engine.verifyAndDec(f,d.engine))return!1;e.content=e.engine.content.getBytes(),e.signerInfos=[],e.certificates=[];var h=0,i=[];for(h=0;h<e.engine.certificates.length;h++)i.push(!1);var k=e.engine.getSignerInfos();for(h=0;h<k.length;h++)i[k[h].certIndex]=!0,e.signerInfos.push({cert:b.x509Cert.create(e.engine.certificates[k[h].certIndex])});return e.contentEncInfo=E(e.engine.encryptedContent),!0}catch(l){throw new p(g,F.data.signedAndEnvData,l)}},e.addRecipient=function(b,c){var d=null,f=null,g="ds.pkcs7.signedAndEnvData.addRecipient";try{a(),c&&c.scheme&&"RSA-OAEP"==c.scheme.toUpperCase()&&(c.md||(f=z(b))),d=x(c,f),e.engine.addRecipient(b.engine,d.scheme,d.schemeOpts)}catch(h){throw new o(g,F.data.signedAndEnvData,h)}},e},b.pkcs10.create=function(){var c={};try{a(),c.engine=dreamsecurity.pki.createCertificationRequest()}catch(d){throw new o("ds.pkcs10.create",F.data.pkcs10Csr,d)}return c.keyPair={},c.setSubject=function(b){var d=[],e=b.split(","),f={};f.cn="2.5.4.3",f.c="2.5.4.6",f.o="2.5.4.10",f.ou="2.5.4.11";var g=0;for(g=0;g<e.length;g++){var h=e[g].split("=");if(2!=h.length)throw new o("ds.pkcs10.create",F.data.pkcs10Csr,"The dn is wrong format. : "+b);d.push({type:f[h[0]],value:h[1]})}try{a(),c.engine.setSubject(d)}catch(i){throw new o("ds.pkcs10.create",F.data.pkcs10Csr,i)}},c.sign=function(d,e){var f=null,g="ds.pkcs10.sign";if(void 0==d)f=dreamsecurity.md.algorithms.sha256.create();else if("string"==typeof d){var h=w(d,g);f=dreamsecurity.md.algorithms[h].create()}else f=d.engine;try{if(a(),void 0==c.keyPair.privateKey||void 0==c.keyPair.publicKey){var i="",j=0;void 0!=e?(i=void 0==e.algorithm?"rsa":e.algorithm.toLowerCase(),j=void 0==e.bits?2048:e.bits):(i="rsa",j=2048),c.keyPair=b.generateKeyPair(i,{bits:j})}c.engine.version=0,c.engine.publicKey=c.keyPair.publicKey.engine,c.engine.sign(c.keyPair.privateKey.engine,f)}catch(k){u(dreamsecurity.err.generate,g,F.data.pkcs10Csr,k)}},c.toPem=function(){try{return b.pem.encode(c,b.pem.type.pkcs10)}catch(a){throw new q("ds.pkcs10.toPem",F.data.pkcs10Csr|F.encoding.pem,a)}},c.toDer=function(){try{return a(),dreamsecurity.asn1.toDer(dreamsecurity.pki.certificationRequestToAsn1(c.engine))}catch(b){throw new q("ds.pkcs10.toDer",F.data.pkcs10Csr|F.encoding.der,b)}},c},b.pkcs12.format={},b.pkcs12.format.encPriKey=1,b.pkcs12.format.noEncCert=2,b.pkcs12.create=function(c){var d={};return void 0!=c?d.engine=c:d.engine=null,d.safeContents=[],d.certificates=[],d.exportPfx=function(c,e){if(0===d.safeContents.length)throw new o("ds.pkcs12.exportPfx",F.data.pkcs12Pfx,"A certificate and priKey pair is not setted.");try{a();var f=0,g=[],h=[];for(f=0;f<d.safeContents.length;f++){var i=null;if(e&&e.format&&e.format&b.pkcs12.format.encPriKey)if(0===d.safeContents[f].priKey.lastIndexOf("-----",0)){var j=b.pem.decode(d.safeContents[f].priKey);i=j.body}else i=b.base64.decode(d.safeContents[f].priKey);null==i&&(i=d.safeContents[f].priKey.engine),g.push({cert:d.safeContents[f].cert.engine,priKey:i,keyId:String.fromCharCode(4)+String.fromCharCode(4)+String.fromCharCode(f+1)+String.fromCharCode(0)+String.fromCharCode(0)+String.fromCharCode(0)})}for(f=0;f<d.certificates.length;f++)h.push(d.certificates[f].engine);d.pfx=dreamsecurity.pkcs12.toPkcs12Asn1(g,h,v(c),e)}catch(k){throw new o("ds.pkcs12.exportPfx",F.data.pkcs12Pfx,k)}},d.toDer=function(){try{return a(),dreamsecurity.asn1.toDer(d.pfx)}catch(b){throw new q("ds.pkcs12.toDer",F.data.pkcs12Pfx|F.encoding.der,b)}},d.importPfx=function(c,e){var f=0;try{a(),f=F.encoding.base64;var g=dreamsecurity.util.decode64(d.engine);g=dreamsecurity.asn1.fromDer(g),d.engine=dreamsecurity.pkcs12.pkcs12FromAsn1(g,!0,v(c),e)}catch(h){if(h.type!=dreamsecurity.err.wrongPasswd)throw new p("ds.pkcs12.importPfx",F.data.pkcs12Pfx,h);u(dreamsecurity.err.wrongPasswd,"ds.pkcs12.importPfx",F.data.pkcs12Pfx,h)}var i=0,j=0,k=[],l=[],m=[];try{for(i=0;i<d.engine.safeContents.length;i++){var n=0,o=d.engine.safeContents[i];for(n=0;n<o.safeBags.length;n++)if(void 0!=o.safeBags[n].attributes.localKeyId)if(0==i){var q=-1;for(j=0;j<k.length;j++)if(k[j]===o.safeBags[n].attributes.localKeyId[0]){q=j;break}-1==q&&k.push(o.safeBags[n].attributes.localKeyId[0]),void 0!=o.safeBags[n].key?-1==q?(m.push(o.safeBags[n].key),l.push(null)):m[j]=o.safeBags[n].key:-1==q?(m.push(null),l.push(o.safeBags[n].cert)):l[j]=o.safeBags[n].cert}else for(j=0;j<k.length;j++)k[j]===o.safeBags[n].attributes.localKeyId[0]&&(void 0!=o.safeBags[n].key?m[j]=o.safeBags[n].key:l[j]=o.safeBags[n].cert);else d.certificates.push(b.x509Cert.create(o.safeBags[n].cert))}for(i=0;i<k.length;i++)e&&e.format&&e.format&b.pkcs12.format.encPriKey?d.safeContents.push({cert:b.x509Cert.create(l[i]),priKey:dreamsecurity.asn1.toDer(m[i])}):d.safeContents.push({cert:b.x509Cert.create(l[i]),priKey:b.priKey.create(m[i])})}catch(h){throw new p("ds.pkcs12.importPfx",F.data.pkcs12Pfx,h)}},d},b.tsp.token.create=function(c){var d={};if(d.signerCert=null,!c)throw new t("ds.tsp.token.create",F.data.tsp,"The input data is empty.");try{a(),d.token=b.pkcs7.signedData.create(c)}catch(e){throw new r("ds.tsp.token.create",F.data.tsp|F.encoding.der,e)}if(d.token.engine.contentType!==dreamsecurity.oids.tstInfo)throw new t("ds.tsp.token.create",F.data.tsp,"The input data is not a timeStampToken.");try{d.info=dreamsecurity.tsp.tstInfoFromAsn1(dreamsecurity.asn1.fromDer(d.token.engine.content))}catch(e){throw new r("ds.tsp.token.create",F.data.tsp|F.encoding.der,e)}return d.info.tsa=A(d.info.tsa.dn),d.verify=function(a,b){if(!d.token.verify())throw new n("ds.tsp.token.verify",F.data.tsp|F.alg.sign,"Verification of a signature in timeStampToken is failed.");try{var c=d.info.msgImprint,e=dreamsecurity.oids[c.hashAlg],f=dreamsecurity.md.algorithms[e].create();f.update(v(a,b));var g=f.digest()}catch(h){throw new n("ds.tsp.token.verify",F.data.tsp,"Verification of a messageImprint in timeStampToken is failed. ("+h.message+")")}if(g.toHex()!=dreamsecurity.util.bytesToHex(v(c.hashedMessage)))throw new n("ds.tsp.token.verify",F.data.tsp|F.alg.md,"The msg is not for this timeStampToken (The messageImprint is different).");if(1!=d.token.signerInfos.length)throw new n("ds.tsp.token.verify",F.data.tsp,"The count of signer is not 1.");d.signerCert=d.token.signerInfos[0].cert},d},b.arcCert.response.create=function(c){var e="ds.arcCert.response.create",f={};if(f.signerCert=null,!c)throw new t(e,F.data.arccert,"The input data is empty.");try{a(),f.response=b.pkcs7.signedData.create(c)}catch(g){throw new r(e,F.data.arccert|F.encoding.der,g)}if(f.response.engine.contentType!==dreamsecurity.oids.arcCertRes)throw new t(e,F.data.arccert,"The input data is not a arcCertResponse.");try{f.info=dreamsecurity.arcCert.arcCertResFromAsn1(dreamsecurity.asn1.fromDer(f.response.engine.content))}catch(g){throw new r(e,F.data.arccert|F.encoding.der,g)}return f.verify=function(a,b){var c="ds.arcCert.response.verify";if(!f.response.verify())throw new n(c,F.data.arcCert|F.alg.sign,"Verification of a signature in ArcCert is failed.");try{var e=f.info.target;if("dataHash"!=e.choice)throw new d(c,F.data.arcCert,e.choice+" in Target is not supported");var g=dreamsecurity.md.algorithms[e.hashAlg].create();g.update(v(a,b));var h=g.digest();if(h.toHex()!=dreamsecurity.util.bytesToHex(v(e.hashedData)))throw new n(c,F.data.arcCert|F.alg.md,"The msg is not for this ArcCert (The dataHash is different).")}catch(i){throw new n(c,F.data.arcCert,"Verification of a dataHash in ArcCert is failed. ("+i.message+")")}if(1!=f.response.signerInfos.length)throw new n(c,F.data.arcCert,"The count of signer is not 1.");f.signerCert=f.response.signerInfos[0].cert},f},b.pem.type={},b.pem.type.publicKey="PUBLIC KEY",b.pem.type.privateKey="PRIVATE KEY",b.pem.type.rsaPubKey="RSA PUBLIC KEY",b.pem.type.rsaPriKey="RSA PRIVATE KEY",b.pem.type.cert="CERTIFICATE",b.pem.type.crl="X509 CRL",b.pem.type.pkcs7="PKCS7",b.pem.type.pkcs10="CERTIFICATE REQUEST",b.pem.type.encPriKey="ENCRYPTED PRIVATE KEY",b.pem.encode=function(b,c){var d={};try{return a(),d.type=c,"toDer"in b?d.body=b.toDer().getBytes():d.body=v(b),dreamsecurity.pem.encode(d)}catch(e){u(dreamsecurity.err.encode,"ds.pem.encode",F.encoding.pem,e.type&&e.message?e.message:"The "+c+" pem encoding failed.")}},b.pem.decode=function(b){try{return a(),dreamsecurity.pem.decode(v(b))[0]}catch(c){u(dreamsecurity.err.decode,"ds.pem.decode",F.encoding.pem,c.type&&c.message?c.message:"The pem decoding failed.")}},b.base64.encode=function(b){try{return a(),dreamsecurity.util.encode64(v(b))}catch(c){u(dreamsecurity.err.encode,"ds.base64.encode",F.encoding.base64,c.type&&c.message?c.message:"The Base64 encoding failed.")}},b.base64.decode=function(b){try{return a(),dreamsecurity.util.decode64(v(b))}catch(c){u(dreamsecurity.err.decode,"ds.base64.decode",F.encoding.base64,c.type&&c.message?c.message:"The Base64 decoding failed.")}},b.hex.encode=function(b){try{return a(),dreamsecurity.util.bytesToHex(v(b))}catch(c){u(dreamsecurity.err.encode,"ds.hex.encode",F.encoding.hex,c.type&&c.message?c.message:"The Hex encoding failed.")}},b.hex.decode=function(b){try{return a(),dreamsecurity.util.hexToBytes(v(b))}catch(c){u(dreamsecurity.err.decode,"ds.hex.decode",F.encoding.hex,c.type&&c.message?c.message:"The Hex decoding failed.")}},b.utf8.encode=function(b){try{return a(),dreamsecurity.util.encodeUtf8(v(b))}catch(c){u(dreamsecurity.err.encode,"ds.utf8.encode",F.encoding.utf8,c.type&&c.message?c:"The UTF8 encoding failed.")}},b.utf8.decode=function(b){try{return a(),dreamsecurity.util.decodeUtf8(v(b))}catch(c){u(dreamsecurity.err.decode,F.encoding.utf8,c.type&&c.message?c.message:"The UTF8 decoding failed.")}},b.ByteStringBuffer.create=function(b){a();var c={};return c=dreamsecurity.util.createBuffer(b)},"function"==typeof Object.freeze&&Object.freeze(b)}return"undefined"==typeof magicjs&&(magicjs={}),a(magicjs)}();